

<!DOCTYPE html>

<html lang="en-US">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge">

  

  <link rel="shortcut icon" href="/v0.48/favicon.ico" type="image/x-icon">

  <link rel="stylesheet" href="/v0.48/assets/css/just-the-docs-default.css">

  

  
    <script type="text/javascript" src="/v0.48/assets/js/vendor/lunr.min.js"></script>
  
  <script type="text/javascript" src="/v0.48/assets/js/just-the-docs.js"></script>

  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Glue / Hive metastore | lakeFS</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="Glue / Hive metastore" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Query data from lakeFS branches in services backed by Glue/Hive Metastore." />
<meta property="og:description" content="Query data from lakeFS branches in services backed by Glue/Hive Metastore." />
<meta property="og:site_name" content="lakeFS" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Glue / Hive metastore" />
<script type="application/ld+json">
{"description":"Query data from lakeFS branches in services backed by Glue/Hive Metastore.","@type":"WebPage","url":"/v0.48/integrations/glue_hive_metastore.html","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"/v0.48/assets/logo.svg"}},"headline":"Glue / Hive metastore","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


  <!-- Google Tag Manager Head -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
            new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KTZBZW9');</script>
<!-- End Google Tag Manager Head -->
<meta name="robots" content="noindex">
<meta property="og:image" content="/v0.48/assets/img/shared-image.png">
<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/js/fontawesome.min.js" integrity="sha512-i3N2a3sMtKOQHXCJF3qEpce5twcGN9mRsWQe6PUTf9WS/eG5XkivI97uxit7B2nRGz5XuoszBaqndSqxdeVfag==" crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />
<script src="https://code.jquery.com/jquery-3.5.1.min.js"
        integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
        crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css">
<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
<script src="/v0.48/assets/js/copy-code.js"></script>
<script>
    $(function () {
        $(".tabs").tabs();
    });
</script>


</head>

<body>
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KTZBZW9"
                  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
    <symbol id="svg-link" viewBox="0 0 24 24">
        <title>Link</title>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
             stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
             class="feather feather-link">
            <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
            <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
        </svg>
    </symbol>
    <symbol id="svg-search" viewBox="0 0 24 24">
        <title>Search</title>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
             stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
             class="feather feather-search">
            <circle cx="11" cy="11" r="8"></circle>
            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
        </svg>
    </symbol>
    <symbol id="svg-menu" viewBox="0 0 24 24">
        <title>Menu</title>
        <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="16px" viewBox="0 0 20 16" version="1.1"
             class="feather feather-menu">
            <g id="Symbols" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                <g id="header-/-mobile" transform="translate(-30.000000, -32.000000)" fill="#279890">
                    <g id="Group" transform="translate(30.000000, 32.000000)">
                        <path
                                d="M20,14 L20,16 L0,16 L0,14 L20,14 Z M20,7 L20,9 L0,9 L0,7 L20,7 Z M20,0 L20,2 L0,2 L0,0 L20,0 Z"
                                id="mobile-menu" />
                    </g>
                </g>
            </g>
        </svg>
    </symbol>
    <symbol id="svg-arrow-right" viewBox="0 0 24 24">
        <title>Expand</title>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
             stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
             class="feather feather-chevron-right">
            <polyline points="9 18 15 12 9 6"></polyline>
        </svg>
    </symbol>
    <symbol id="svg-doc" viewBox="0 0 24 24">
        <title>Document</title>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
             stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
             class="feather feather-file">
            <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path>
            <polyline points="13 2 13 9 20 9"></polyline>
        </svg>
    </symbol>
</svg>
<div class="body-wrapper">
    <div class="side-bar">
        <div class="site-header">
            <a href="https://lakefs.io" class="site-title lh-tight">
  <div class="site-logo"></div>

</a>
            <a href="#" id="menu-button" class="site-button">
                <svg viewBox="0 0 24 24" class="icon">
                    <use xlink:href="#svg-menu"></use>
                </svg>
            </a>
        </div>
        <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav">
            
            <div class="search">
                <div class="search-input-wrap">
                    <input type="text" id="search-input" class="search-input" tabindex="0"
                           placeholder="Search lakeFS" aria-label="Search lakeFS"
                           autocomplete="off">
                    <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon">
                            <use xlink:href="#svg-search"></use>
                        </svg></label>
                </div>
                <div id="search-results" class="search-results"></div>
            </div>
            

            <div class="nav-category nav-version">
                <label for="selectversion">Version:</label>
                <select id="selectversion" name="version" onchange="javascript:location.href = '/' + this.value;">
                    <option value="" selected>Latest</option>
                </select>
            </div>
            <script async>
                window.addEventListener("load",  async () => {
                    const pathFirstLevel = location.pathname.split('/')[1];
                    const selectedVersion = pathFirstLevel.startsWith('v') && pathFirstLevel || '';
                    const selectVersionElmFirst = document.getElementById('selectversion').firstElementChild;
                    const response = await fetch('/versions.json');
                    if (!response.ok) {
                        return
                    }
                    const versions = await response.json();
                    versions.reverse();
                    for (let versionObj of versions) {
                        const el = document.createElement("option");
                        el.value = versionObj.version;
                        el.textContent = versionObj.title;
                        if (versionObj.version === selectedVersion) {
                            el.selected = true;
                        }
                        selectVersionElmFirst.after(el);
                    }
                });
            </script>

            <ul class="nav-list"><li
            class="nav-list-item"><a href="/v0.48/"
           class="nav-list-link">What is lakeFS</a></li><li
            class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24">
                <use xlink:href="#svg-arrow-right"></use>
            </svg></a><a href="/v0.48/quickstart/"
           class="nav-list-link">Quickstart</a><ul class="nav-list "><li class="nav-list-item "><a href="/v0.48/quickstart/installing.html"
                   class="nav-list-link">Install lakeFS</a></li><li class="nav-list-item "><a href="/v0.48/quickstart/repository.html"
                   class="nav-list-link">Create a Repository</a></li><li class="nav-list-item "><a href="/v0.48/quickstart/aws_cli.html"
                   class="nav-list-link">Add Data</a></li><li class="nav-list-item "><a href="/v0.48/quickstart/lakefs_cli.html"
                   class="nav-list-link">Install lakeFS CLI</a></li><li class="nav-list-item "><a href="/v0.48/quickstart/more_quickstart_options.html"
                   class="nav-list-link">More Quickstart Options</a></li><li class="nav-list-item "><a href="/v0.48/quickstart/try.html"
                   class="nav-list-link">Try without installing</a></li></ul></li><li
            class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24">
                <use xlink:href="#svg-arrow-right"></use>
            </svg></a><a href="/v0.48/deploy/"
           class="nav-list-link">Deploy lakeFS</a><ul class="nav-list "><li class="nav-list-item "><a href="/v0.48/deploy/aws.html"
                   class="nav-list-link">On AWS</a></li><li class="nav-list-item "><a href="/v0.48/deploy/azure.html"
                   class="nav-list-link">On Azure</a></li><li class="nav-list-item "><a href="/v0.48/deploy/gcp.html"
                   class="nav-list-link">On GCP</a></li><li class="nav-list-item "><a href="/v0.48/deploy/k8s.html"
                   class="nav-list-link">With Kubernetes</a></li><li class="nav-list-item "><a href="/v0.48/deploy/docker.html"
                   class="nav-list-link">With Docker</a></li></ul></li><li
            class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24">
                <use xlink:href="#svg-arrow-right"></use>
            </svg></a><a href="/v0.48/setup/"
           class="nav-list-link">Setup lakeFS</a><ul class="nav-list "><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24">
                        <use xlink:href="#svg-arrow-right"></use>
                    </svg></a><a href="/v0.48/setup/storage/"
                   class="nav-list-link">Prepare Your Storage</a><ul class="nav-list"><li class="nav-list-item ">
                        <a href="/v0.48/setup/storage/s3.html"
                           class="nav-list-link">AWS S3</a>
                    </li><li class="nav-list-item ">
                        <a href="/v0.48/setup/storage/gcs.html"
                           class="nav-list-link">Google Cloud Storage</a>
                    </li><li class="nav-list-item ">
                        <a href="/v0.48/setup/storage/blob.html"
                           class="nav-list-link">Azure Blob Storage</a>
                    </li></ul></li><li class="nav-list-item "><a href="/v0.48/setup/create-repo.html"
                   class="nav-list-link">Create a Repository</a></li><li class="nav-list-item "><a href="/v0.48/setup/import.html"
                   class="nav-list-link">Import data into lakeFS</a></li><li class="nav-list-item "><a href="/v0.48/setup/hooks.html"
                   class="nav-list-link">Hooks</a></li><li class="nav-list-item "><a href="/v0.48/setup/virtual-host-addressing.html"
                   class="nav-list-link">S3 Virtual-host addressing (advanced)</a></li></ul></li><li
            class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24">
                <use xlink:href="#svg-arrow-right"></use>
            </svg></a><a href="/v0.48/usecases/"
           class="nav-list-link">Using lakeFS</a><ul class="nav-list "><li class="nav-list-item "><a href="/v0.48/usecases/data-devenv.html"
                   class="nav-list-link">In Development</a></li><li class="nav-list-item "><a href="/v0.48/usecases/ci.html"
                   class="nav-list-link">During Deployment</a></li><li class="nav-list-item "><a href="/v0.48/usecases/production.html"
                   class="nav-list-link">In Production</a></li></ul></li><li
            class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24">
                <use xlink:href="#svg-arrow-right"></use>
            </svg></a><a href="/v0.48/reference/"
           class="nav-list-link">Reference</a><ul class="nav-list "><li class="nav-list-item "><a href="/v0.48/reference/api.html"
                   class="nav-list-link">API Reference</a></li><li class="nav-list-item "><a href="/v0.48/reference/s3.html"
                   class="nav-list-link">S3 Supported API</a></li><li class="nav-list-item "><a href="/v0.48/reference/configuration.html"
                   class="nav-list-link">Configuration Reference</a></li><li class="nav-list-item "><a href="/v0.48/reference/commands.html"
                   class="nav-list-link">Command (CLI) Reference</a></li><li class="nav-list-item "><a href="/v0.48/reference/export.html"
                   class="nav-list-link">Exporting Data</a></li><li class="nav-list-item "><a href="/v0.48/reference/garbage-collection.html"
                   class="nav-list-link">Garbage Collection</a></li><li class="nav-list-item "><a href="/v0.48/reference/monitor.html"
                   class="nav-list-link">Monitoring using Prometheus</a></li><li class="nav-list-item "><a href="/v0.48/reference/offboarding.html"
                   class="nav-list-link">Migrating away from lakeFS</a></li><li class="nav-list-item "><a href="/v0.48/reference/upgrade.html"
                   class="nav-list-link">Upgrade lakeFS</a></li><li class="nav-list-item "><a href="/v0.48/reference/authorization.html"
                   class="nav-list-link">Authentication & Authorization</a></li><li class="nav-list-item "><a href="/v0.48/reference/object-model.html"
                   class="nav-list-link">Object Model</a></li></ul></li><li
            class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24">
                <use xlink:href="#svg-arrow-right"></use>
            </svg></a><a href="/v0.48/integrations/"
           class="nav-list-link">Integrations</a><ul class="nav-list "><li class="nav-list-item "><a href="/v0.48/integrations/distcp.html"
                   class="nav-list-link">Copying Data with DistCp</a></li><li class="nav-list-item "><a href="/v0.48/integrations/rclone.html"
                   class="nav-list-link">Copying data with Rclone</a></li><li class="nav-list-item "><a href="/v0.48/integrations/aws_cli.html"
                   class="nav-list-link">AWS CLI</a></li><li class="nav-list-item "><a href="/v0.48/integrations/spark.html"
                   class="nav-list-link">Spark</a></li><li class="nav-list-item "><a href="/v0.48/integrations/hive.html"
                   class="nav-list-link">Hive</a></li><li class="nav-list-item "><a href="/v0.48/integrations/python.html"
                   class="nav-list-link">Python</a></li><li class="nav-list-item "><a href="/v0.48/integrations/emr.html"
                   class="nav-list-link">EMR</a></li><li class="nav-list-item "><a href="/v0.48/integrations/presto_trino.html"
                   class="nav-list-link">Presto/Trino</a></li><li class="nav-list-item "><a href="/v0.48/integrations/boto.html"
                   class="nav-list-link">Boto (Python)</a></li><li class="nav-list-item "><a href="/v0.48/integrations/minio.html"
                   class="nav-list-link">MinIO</a></li><li class="nav-list-item "><a href="/v0.48/integrations/athena.html"
                   class="nav-list-link">Amazon Athena</a></li><li class="nav-list-item "><a href="/v0.48/integrations/airflow.html"
                   class="nav-list-link">Airflow</a></li><li class="nav-list-item "><a href="/v0.48/integrations/kubeflow.html"
                   class="nav-list-link">Kubeflow</a></li><li class="nav-list-item "><a href="/v0.48/integrations/airbyte.html"
                   class="nav-list-link">Airbyte</a></li><li class="nav-list-item "><a href="/v0.48/integrations/databricks.html"
                   class="nav-list-link">Databricks</a></li><li class="nav-list-item "><a href="/v0.48/integrations/delta.html"
                   class="nav-list-link">Delta Lake</a></li><li class="nav-list-item  active"><a href="/v0.48/integrations/glue_hive_metastore.html"
                   class="nav-list-link active">Glue / Hive metastore</a></li><li class="nav-list-item "><a href="/v0.48/integrations/glue_etl.html"
                   class="nav-list-link">Glue ETL</a></li><li class="nav-list-item "><a href="/v0.48/integrations/kakfa.html"
                   class="nav-list-link">Kafka</a></li><li class="nav-list-item "><a href="/v0.48/integrations/mapreduce.html"
                   class="nav-list-link">MapReduce</a></li><li class="nav-list-item "><a href="/v0.48/integrations/sagemaker.html"
                   class="nav-list-link">SageMaker</a></li><li class="nav-list-item "><a href="/v0.48/integrations/dremio.html"
                   class="nav-list-link">Dremio</a></li></ul></li><li
            class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24">
                <use xlink:href="#svg-arrow-right"></use>
            </svg></a><a href="/v0.48/understand/"
           class="nav-list-link">Understanding lakeFS</a><ul class="nav-list "><li class="nav-list-item "><a href="/v0.48/understand/architecture.html"
                   class="nav-list-link">Architecture</a></li><li class="nav-list-item "><a href="/v0.48/understand/data-model.html"
                   class="nav-list-link">Data Model</a></li><li class="nav-list-item "><a href="/v0.48/understand/branching-model.html"
                   class="nav-list-link">Branching Model</a></li><li class="nav-list-item "><a href="/v0.48/understand/sizing-guide.html"
                   class="nav-list-link">Sizing Guide</a></li><li class="nav-list-item "><a href="/v0.48/understand/roadmap.html"
                   class="nav-list-link">Roadmap</a></li><li class="nav-list-item "><a href="/v0.48/understand/licensing.html"
                   class="nav-list-link">Licensing</a></li></ul></li><li
            class="nav-list-item"><a href="/v0.48/contributing.html"
           class="nav-list-link">Contributing</a></li><li
            class="nav-list-item"><a href="/v0.48/faq.html"
           class="nav-list-link">FAQ</a></li></ul>
            <div class="mobile-menu">
                
<nav aria-label="Auxiliary" class="aux-nav">
    <ul class="aux-nav-list">
        
        
        <li class="aux-nav-list-item">
            <a href="https://docs.lakefs.io/" class="site-button"  target="_blank"
               rel="noopener noreferrer" >
                Docs
            </a>
        </li>
        
        <li class="aux-nav-list-item">
            <a href="https://github.com/treeverse/lakeFS" class="site-button"  target="_blank"
               rel="noopener noreferrer" >
                GitHub
            </a>
        </li>
        
        <li class="aux-nav-list-item">
            <a href="https://lakefs.io/blog/" class="site-button"  target="_blank"
               rel="noopener noreferrer" >
                Blog
            </a>
        </li>
        
        
        
        
        <li class="aux-nav-list-item button">
            <a href="https://docs.lakefs.io/" class="site-button"  target="_blank"
               rel="noopener noreferrer" >
                Get Started
            </a>
        </li>
        
        
    </ul>
</nav>

            </div>
        </nav>

    </div>
    <div class="main" id="top">
        <div id="main-header" class="main-header">
            
<nav aria-label="Auxiliary" class="aux-nav">
    <ul class="aux-nav-list">
        
        
        <li class="aux-nav-list-item">
            <a href="https://docs.lakefs.io/" class="site-button"  target="_blank"
               rel="noopener noreferrer" >
                Docs
            </a>
        </li>
        
        <li class="aux-nav-list-item">
            <a href="https://github.com/treeverse/lakeFS" class="site-button"  target="_blank"
               rel="noopener noreferrer" >
                GitHub
            </a>
        </li>
        
        <li class="aux-nav-list-item">
            <a href="https://lakefs.io/blog/" class="site-button"  target="_blank"
               rel="noopener noreferrer" >
                Blog
            </a>
        </li>
        
        
        
        
        <li class="aux-nav-list-item button">
            <a href="https://docs.lakefs.io/" class="site-button"  target="_blank"
               rel="noopener noreferrer" >
                Get Started
            </a>
        </li>
        
        
    </ul>
</nav>

        </div>
        <div id="main-content-wrap" class="main-content-wrap">
            
            
            <nav aria-label="Breadcrumb" class="breadcrumb-nav">
                <ol class="breadcrumb-nav-list">
                    
                    <li class="breadcrumb-nav-list-item"><a href="/v0.48/integrations/">Integrations</a>
                    </li>
                    
                    <li class="breadcrumb-nav-list-item"><span>Glue / Hive metastore</span></li>
                </ol>
            </nav>
            
            
            <div id="main-content" class="main-content" role="main">
                
                <div class="toc-block">
      <h2 class="no_toc text-delta" id="table-of-contents">
        
        
          <a href="#table-of-contents" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Table of contents
        
        
      </h2>
    

<ol id="markdown-toc">
  <li><a href="#glue--hive-metastore-intro" id="markdown-toc-glue--hive-metastore-intro">Glue / Hive Metastore Intro</a></li>
  <li><a href="#managing-tables-with-lakefs-branches" id="markdown-toc-managing-tables-with-lakefs-branches">Managing Tables With lakeFS Branches</a>    <ol>
      <li><a href="#motivation" id="markdown-toc-motivation">Motivation</a></li>
      <li><a href="#configurations" id="markdown-toc-configurations">Configurations</a></li>
      <li><a href="#suggested-model" id="markdown-toc-suggested-model">Suggested Model</a></li>
      <li><a href="#commands" id="markdown-toc-commands">Commands</a>        <ol>
          <li><a href="#copy" id="markdown-toc-copy">Copy</a></li>
          <li><a href="#diff" id="markdown-toc-diff">Diff</a></li>
        </ol>
      </li>
      <li><a href="#athena-with-lakefs-branches" id="markdown-toc-athena-with-lakefs-branches">Athena with lakeFS branches</a></li>
    </ol>
  </li>
</ol>

</div>
      <h1 id="glue--hive-metastore-intro">
        
        
          <a href="#glue--hive-metastore-intro" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Glue / Hive Metastore Intro
        
        
      </h1>
    
<p>This part contains a brief explanation about how Glue/Hive metastore work with lakeFS</p>

<p>Glue and Hive Metastore stores metadata related to Hive and other services (such as Spark and Trino).
They contain metadata such as the location of the table, information about columns, partitions and many more.</p>
      <h2 class="no_toc" id="without-lakefs">
        
        
          <a href="#without-lakefs" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Without lakeFS
        
        
      </h2>
    
<p>In order to query the table <code class="language-plaintext highlighter-rouge">my_table</code>, Spark will:</p>
<ul>
  <li>Request the metadata from Hive metastore (steps 1,2)</li>
  <li>Use the location from the metadata to access the data in S3 (steps 3,4).
<img src="/v0.48/assets/img/metastore-S3.svg" alt="metastore with S3" /></li>
</ul>

<p><br /><br /></p>
      <h2 class="no_toc" id="with-lakefs">
        
        
          <a href="#with-lakefs" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> With lakeFS
        
        
      </h2>
    
<p>When using lakeFS, the flow stays exactly the same. Note that the location of the table <code class="language-plaintext highlighter-rouge">my_table</code> now contains the branch <code class="language-plaintext highlighter-rouge">s3://example/main/path/to/table</code>
<img src="/v0.48/assets/img/metastore-lakefs.svg" alt="metastore with S3" /></p>

<p><br /><br /><br /></p>
      <h1 id="managing-tables-with-lakefs-branches">
        
        
          <a href="#managing-tables-with-lakefs-branches" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Managing Tables With lakeFS Branches
        
        
      </h1>
    
      <h2 id="motivation">
        
        
          <a href="#motivation" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Motivation
        
        
      </h2>
    
<p>When creating a table in Glue/Hive metastore (using a client such as Spark, Hive, Presto), we specify the table location.
Consider the table <code class="language-plaintext highlighter-rouge">my_table</code> which was created with the location <code class="language-plaintext highlighter-rouge">s3://example/main/path/to/table</code>.</p>

<p>Assume we created a new branch called <code class="language-plaintext highlighter-rouge">DEV</code> with <code class="language-plaintext highlighter-rouge">main</code> as the source branch.
The data from <code class="language-plaintext highlighter-rouge">s3://example/main/path/to/table</code> is now accessible in <code class="language-plaintext highlighter-rouge">s3://example/DEV/path/to/table</code>.
The metadata is not managed in lakeFS, meaning we don’t have any table pointing to <code class="language-plaintext highlighter-rouge">s3://example/DEV/path/to/table</code>.</p>

<p>To address this, lakeFS introduces <code class="language-plaintext highlighter-rouge">lakectl metastore</code> commands. The case above could be handled using the copy command: it can create a copy of <code class="language-plaintext highlighter-rouge">my_table</code> with data located in <code class="language-plaintext highlighter-rouge">s3://example/DEV/path/to/table</code>. Note that this is a fast, metadata-only operation.</p>
      <h2 id="configurations">
        
        
          <a href="#configurations" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Configurations
        
        
      </h2>
    
<p>The <code class="language-plaintext highlighter-rouge">lakectl metastore</code> commands could run on Glue or Hive metastore.<br />
Add the following to the lakectl configuration file (by default <code class="language-plaintext highlighter-rouge">~/.lakectl.yaml</code>):</p>
      <h3 class="no_toc" id="hive">
        
        
          <a href="#hive" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Hive
        
        
      </h3>
    

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">metastore</span><span class="pi">:</span>
  <span class="na">type</span><span class="pi">:</span> <span class="s">hive</span>
  <span class="na">hive</span><span class="pi">:</span>
    <span class="na">uri</span><span class="pi">:</span> <span class="s">thrift://hive-metastore:9083</span>
</code></pre></div></div>
      <h3 class="no_toc" id="glue">
        
        
          <a href="#glue" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Glue
        
        
      </h3>
    

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">metastore</span><span class="pi">:</span>
  <span class="na">type</span><span class="pi">:</span> <span class="s">glue</span>
  <span class="na">glue</span><span class="pi">:</span>
    <span class="na">catalog-id</span><span class="pi">:</span> <span class="m">123456789012</span>
    <span class="na">region</span><span class="pi">:</span> <span class="s">us-east-1</span>
    <span class="na">profile</span><span class="pi">:</span> <span class="s">default</span> <span class="c1"># optional, implies using a credentials file</span>
    <span class="na">credentials</span><span class="pi">:</span>
      <span class="na">access_key_id</span><span class="pi">:</span> <span class="s">AKIAIOSFODNN7EXAMPLE</span>
      <span class="na">secret_access_key</span><span class="pi">:</span> <span class="s">wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY</span>
</code></pre></div></div>

<p class="note pb-3"><strong>Notice:</strong> It’s recommended to set type and catalog-id/metastore-uri in the lakectl configuration file.</p>
      <h2 id="suggested-model">
        
        
          <a href="#suggested-model" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Suggested Model
        
        
      </h2>
    

<p>For simplicity, we recommend creating a schema for each branch, this way you can use the same table name across different schemas.</p>

<p>For example:
after creating branch <code class="language-plaintext highlighter-rouge">example_branch</code> also create a schema named <code class="language-plaintext highlighter-rouge">example_branch</code>.
For a table named <code class="language-plaintext highlighter-rouge">my_table</code> under the schema <code class="language-plaintext highlighter-rouge">main</code>, create a new table by the same name under the schema <code class="language-plaintext highlighter-rouge">example_branch</code>. You now have two <code class="language-plaintext highlighter-rouge">my_table</code>s, one in the main schema and one, in the branch schema.</p>
      <h2 id="commands">
        
        
          <a href="#commands" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Commands
        
        
      </h2>
    

<p>Metastore tools support three commands: <code class="language-plaintext highlighter-rouge">copy</code>, <code class="language-plaintext highlighter-rouge">diff</code> and <code class="language-plaintext highlighter-rouge">create-symlink</code>.
copy and diff could work both on Glue and on Hive.
create-symlink works only on Glue.</p>

<p class="note pb-3"><strong>Notice:</strong> If <code class="language-plaintext highlighter-rouge">to-schema</code> or <code class="language-plaintext highlighter-rouge">to-table</code> are not specified, the destination branch and source table names will be used as per the <a href="#suggested-model">suggested model</a>.</p>

<p class="note pb-3"><strong>Notice:</strong> Metastore commands can only run on tables located in lakeFS, you should not use tables that are not located in lakeFS.</p>
      <h3 id="copy">
        
        
          <a href="#copy" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Copy
        
        
      </h3>
    

<p>The <code class="language-plaintext highlighter-rouge">copy</code> command creates a copy of a table pointing to the defined branch.
In case the destination table already exists, the command will only merge the changes.</p>

<p>Example:</p>

<p>Suppose we created the table <code class="language-plaintext highlighter-rouge">inventory</code> on branch <code class="language-plaintext highlighter-rouge">main</code> on schema <code class="language-plaintext highlighter-rouge">default</code>.</p>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">EXTERNAL</span> <span class="k">TABLE</span> <span class="nv">`inventory`</span><span class="p">(</span>
        <span class="nv">`inv_item_sk`</span> <span class="nb">int</span><span class="p">,</span>
        <span class="nv">`inv_warehouse_sk`</span> <span class="nb">int</span><span class="p">,</span>
        <span class="nv">`inv_quantity_on_hand`</span> <span class="nb">int</span><span class="p">)</span>
    <span class="n">PARTITIONED</span> <span class="k">BY</span> <span class="p">(</span>
        <span class="nv">`inv_date_sk`</span> <span class="nb">int</span><span class="p">)</span> <span class="n">STORED</span> <span class="k">AS</span> <span class="n">ORC</span>
    <span class="k">LOCATION</span>
        <span class="s1">'s3a://my_repo/main/path/to/table'</span><span class="p">;</span>
</code></pre></div></div>

<p>We create a new lakeFS branch <code class="language-plaintext highlighter-rouge">example_branch</code>:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>lakectl branch create lakefs://my_repo/example_branch <span class="nt">--source</span> lakefs://my_repo/main
</code></pre></div></div>

<p>The data from <code class="language-plaintext highlighter-rouge">s3://my_repo/main/path/to/table</code> is now accessible in <code class="language-plaintext highlighter-rouge">s3://my_repo/DEV/path/to/table</code>.
In order to query the data in <code class="language-plaintext highlighter-rouge">s3://my_repo/DEV/path/to/table</code>
we would like to create a copy of the table <code class="language-plaintext highlighter-rouge">inventory</code> in schema <code class="language-plaintext highlighter-rouge">example_branch</code> pointing to the new branch.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>lakectl metastore copy <span class="nt">--from-schema</span> default <span class="nt">--from-table</span> inventory <span class="nt">--to-schema</span> example_branch <span class="nt">--to-table</span> inventory <span class="nt">--to-branch</span> example_branch
</code></pre></div></div>

<p>After running this command, query the table <code class="language-plaintext highlighter-rouge">example_branch.inventory</code> to get the data from <code class="language-plaintext highlighter-rouge">s3://my_repo/DEV/path/to/table</code></p>
      <h4 class="no_toc" id="copy-partition">
        
        
          <a href="#copy-partition" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Copy Partition
        
        
      </h4>
    

<p>After adding a partition to the branch table, we may want to copy the partition to the main table.
For example, for the new partition <code class="language-plaintext highlighter-rouge">2020-08-01</code>, run the following in order to copy the partition to the main table:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>lakectl metastore copy <span class="nt">--type</span> hive <span class="nt">--from-schema</span> example_branch <span class="nt">--from-table</span> inventory <span class="nt">--to-schema</span> default <span class="nt">--to-table</span> inventory <span class="nt">--to-branch</span> main <span class="nt">-p</span> 2020-08-01
</code></pre></div></div>

<p>For a table partitioned by more than one column, specify the partition flag for every column. For example for the partition <code class="language-plaintext highlighter-rouge">(year='2020',month='08',day='01')</code>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>lakectl metastore copy <span class="nt">--from-schema</span> example_branch <span class="nt">--from-table</span> branch_inventory <span class="nt">--to-schema</span> default <span class="nt">--to-branch</span> main <span class="nt">-p</span> 2020 <span class="nt">-p</span> 08 <span class="nt">-p</span> 01
</code></pre></div></div>
      <h3 id="diff">
        
        
          <a href="#diff" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Diff
        
        
      </h3>
    

<p>Provides a 2-way diff between two tables.
Shows added<code class="language-plaintext highlighter-rouge">+</code> , removed<code class="language-plaintext highlighter-rouge">-</code> and changed<code class="language-plaintext highlighter-rouge">~</code> partitions and columns.</p>

<p>Example:</p>

<p>Suppose that we made some changes on the copied table <code class="language-plaintext highlighter-rouge">inventory</code> on schema <code class="language-plaintext highlighter-rouge">example_branch</code> and we want to view the changes before merging back to <code class="language-plaintext highlighter-rouge">inventory</code> on schema <code class="language-plaintext highlighter-rouge">default</code>.</p>

<p>Hive:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>lakectl metastore diff <span class="nt">--type</span> hive <span class="nt">--address</span> thrift://hive-metastore:9083 <span class="nt">--from-schema</span> example_branch <span class="nt">--from-table</span> branch <span class="nt">--to-schema</span> default <span class="nt">--to-table</span> inventory
</code></pre></div></div>

<p>The output will be something like:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Columns are identical
Partitions
- 2020-07-04
+ 2020-07-05
+ 2020-07-06
~ 2020-07-08
</code></pre></div></div>
      <h2 id="athena-with-lakefs-branches">
        
        
          <a href="#athena-with-lakefs-branches" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Athena with lakeFS branches
        
        
      </h2>
    
<p>Athena doesn’t support configuring the endpoint-uri. to use S3-compatible services like lakeFS.
Hence, Athena can’t access lakeFS, and can only be used with AWS S3 as the storage.</p>

<p>In order to enable accessing partitioned data we could use the <code class="language-plaintext highlighter-rouge">create-symlink</code> command.
create-symlink receives a source table, destination table and the location of the table and does two actions:</p>
<ol>
  <li>Creates partitioned directories with symlink files in the underlying S3 bucket.</li>
  <li>Creates a table in Glue catalog with symlink format type and location pointing to the created symlinks.</li>
</ol>

<p class="note pb-3"><strong>Notice:</strong> create-symlink source table must point to a location in lakeFS.</p>

<p>Example:</p>

<p>Let’s assume we have the table <code class="language-plaintext highlighter-rouge">inventory</code> in Glue.
The table is pointing to repo <code class="language-plaintext highlighter-rouge">example-repo</code> branch <code class="language-plaintext highlighter-rouge">main</code> and the data is located at <code class="language-plaintext highlighter-rouge">path/to/table/in/lakeFS</code></p>

<p>We want to query the table using Athena.
To do this, we run the command:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>lakectl metastore create-symlink <span class="nt">--address</span> 123456789012 <span class="nt">--branch</span> main <span class="nt">--from-schema</span> default <span class="nt">--from-table</span> branch_inventory <span class="nt">--to-schema</span> default <span class="nt">--to-table</span> sym_inventory <span class="nt">--repo</span> example-repository <span class="nt">--path</span> path/to/table/in/lakeFS
</code></pre></div></div>

<p>We can now use Amazon Athena to query the created table <code class="language-plaintext highlighter-rouge">sym_inventory</code>.</p>

                

                


            </div>
        </div>

        
        

        <div class="search-overlay"></div>
        
    </div>
</div>

<footer>
    <div class="footer-sidebar"></div>
    <div class="footer-main">
        <div class="row">
            <a href="https://lakefs.io" class="site-title lh-tight">
                <div class="site-logo"></div>
            </a>
        </div>
        <div class="row">
            <div class="left">
                <ul class="footer-links">
                    
                    
                    <li class="aux-nav-list-item">
                        <a href="https://docs.lakefs.io/" class="site-button"  target="_blank"
                            rel="noopener noreferrer" >
                            Docs
                        </a>
                    </li>
                    
                    <li class="aux-nav-list-item">
                        <a href="https://github.com/treeverse/lakeFS" class="site-button"  target="_blank"
                            rel="noopener noreferrer" >
                            GitHub
                        </a>
                    </li>
                    
                    <li class="aux-nav-list-item">
                        <a href="https://lakefs.io/blog/" class="site-button"  target="_blank"
                            rel="noopener noreferrer" >
                            Blog
                        </a>
                    </li>
                    
                    <li class="aux-nav-list-item">
                        <a href="https://lakefs.io/contact-us/" class="site-button"  target="_blank"
                            rel="noopener noreferrer" >
                            Contact
                        </a>
                    </li>
                    
                    
                </ul>
            </div>
            <div class="right">
                <ul class="footer-social">
                    
                    
                    <li class="aux-nav-list-item">
                        <a href="https://www.linkedin.com/company/treeverse" class="site-button"  target="_blank"
                            rel="noopener noreferrer" >
                            <img src="/v0.48/assets/icons/linkedin.svg" class="no-hover" />
                            <img src="/v0.48/assets/icons/linkedin-hover.svg" class="hover" />
                        </a>
                    </li>
                    
                    <li class="aux-nav-list-item">
                        <a href="https://github.com/treeverse/lakeFS" class="site-button"  target="_blank"
                            rel="noopener noreferrer" >
                            <img src="/v0.48/assets/icons/github.svg" class="no-hover" />
                            <img src="/v0.48/assets/icons/github-hover.svg" class="hover" />
                        </a>
                    </li>
                    
                    <li class="aux-nav-list-item">
                        <a href="https://twitter.com/lakeFS" class="site-button"  target="_blank"
                            rel="noopener noreferrer" >
                            <img src="/v0.48/assets/icons/twitter.svg" class="no-hover" />
                            <img src="/v0.48/assets/icons/twitter-hover.svg" class="hover" />
                        </a>
                    </li>
                    
                    <li class="aux-nav-list-item">
                        <a href="https://lakefs.io/slack" class="site-button"  target="_blank"
                            rel="noopener noreferrer" >
                            <img src="/v0.48/assets/icons/slack.svg" class="no-hover" />
                            <img src="/v0.48/assets/icons/slack-hover.svg" class="hover" />
                        </a>
                    </li>
                    
                    
                </ul>
            </div>
        </div>
        <div class="row top-border">
            <div class="left"><a href="/v0.48https://www.treeverse.io/">
                    <div class="other-logo"><img src="/v0.48/assets/by-treeverse.png" /></div>
                </a></div>
            <div class="right">
                <ul class="bottom-footer-links">
                    
                    
                    <li class="aux-nav-list-item">
                        <a href="https://lakefs.io/terms-of-use/" class="site-button"  target="_blank"
                            rel="noopener noreferrer" >
                            Terms of use
                        </a>
                    </li>
                    
                    <li class="aux-nav-list-item">
                        <a href="https://lakefs.io/privacy-policy/" class="site-button"  target="_blank"
                            rel="noopener noreferrer" >
                            Privacy Policy
                        </a>
                    </li>
                    
                    
                </ul>
            </div>
        </div>
    </div>
</footer>


</body>

</html>

