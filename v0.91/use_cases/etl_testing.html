

<!DOCTYPE html>

<html lang="en-US">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge">

  <link rel="stylesheet" href="/v0.91/assets/css/just-the-docs-default.css">

  

  
    <script src="/v0.91/assets/js/vendor/lunr.min.js"></script>
  

  

  <script src="/v0.91/assets/js/just-the-docs.js"></script>

  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  
  
    <link rel="icon" href="/v0.91/favicon.ico" type="image/x-icon">
  

  <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>ETL Testing Environment | lakeFS</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="ETL Testing Environment" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="In this tutorial, we will explore how to safely run ETL testing using lakeFS to create isolated dev/test data environments to run data pipelines." />
<meta property="og:description" content="In this tutorial, we will explore how to safely run ETL testing using lakeFS to create isolated dev/test data environments to run data pipelines." />
<meta property="og:site_name" content="lakeFS" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="ETL Testing Environment" />
<script type="application/ld+json">
{"description":"In this tutorial, we will explore how to safely run ETL testing using lakeFS to create isolated dev/test data environments to run data pipelines.","@type":"WebPage","headline":"ETL Testing Environment","url":"/v0.91/use_cases/etl_testing.html","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"/v0.91/assets/logo.svg"}},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


  <!-- Google Tag Manager Head -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
            new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KTZBZW9');</script>
<!-- End Google Tag Manager Head -->
<meta property="og:image" content="/v0.91/assets/img/shared-image.png">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/fontawesome.min.css" integrity="sha512-giQeaPns4lQTBMRpOOHsYnGw1tGVzbAIHUyHRgn7+6FmiEgGGjaG0T2LZJmAPMzRCl+Cug0ItQ2xDZpTmEc+CQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" integrity="sha512-MV7K8+y+gLIBoVD59lQIYicR65iaqukzvf/nwasF0nqhPay5w/9lJmVM2hMDcnK1OnMGCdVK+iQrJ7lzPJQd1w==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js" crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.13.2/themes/smoothness/jquery-ui.css">
<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.13.2/jquery-ui.min.js"></script>
<script src="/v0.91/assets/js/copy-code.js"></script>
<script>
    $(function () {
        $(".tabs").tabs();
    });
</script>
<script src="/v0.91/assets/js/feedback.js"></script>


</head>

<body>
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KTZBZW9"
                  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
    <symbol id="svg-link" viewBox="0 0 24 24">
        <title>Link</title>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
             stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
             class="feather feather-link">
            <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
            <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
        </svg>
    </symbol>
    <symbol id="svg-search" viewBox="0 0 24 24">
        <title>Search</title>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
             stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
             class="feather feather-search">
            <circle cx="11" cy="11" r="8"></circle>
            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
        </svg>
    </symbol>
    <symbol id="svg-menu" viewBox="0 0 24 24">
        <title>Menu</title>
        <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="16px" viewBox="0 0 20 16" version="1.1"
             class="feather feather-menu">
            <g id="Symbols" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                <g id="header-/-mobile" transform="translate(-30.000000, -32.000000)" fill="#279890">
                    <g id="Group" transform="translate(30.000000, 32.000000)">
                        <path
                                d="M20,14 L20,16 L0,16 L0,14 L20,14 Z M20,7 L20,9 L0,9 L0,7 L20,7 Z M20,0 L20,2 L0,2 L0,0 L20,0 Z"
                                id="mobile-menu" />
                    </g>
                </g>
            </g>
        </svg>
    </symbol>
    <symbol id="svg-arrow-right" viewBox="0 0 24 24">
        <title>Expand</title>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
             stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
             class="feather feather-chevron-right">
            <polyline points="9 18 15 12 9 6"></polyline>
        </svg>
    </symbol>
    <symbol id="svg-doc" viewBox="0 0 24 24">
        <title>Document</title>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
             stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
             class="feather feather-file">
            <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path>
            <polyline points="13 2 13 9 20 9"></polyline>
        </svg>
    </symbol>
</svg>
<div class="body-wrapper">
    <div class="side-bar">
        <div class="site-header">
            <a href="https://lakefs.io" class="site-title lh-tight">
  <div class="site-logo"></div>

</a>
            <a href="#" id="menu-button" class="site-button">
                <svg viewBox="0 0 24 24" class="icon">
                    <use xlink:href="#svg-menu"></use>
                </svg>
            </a>
        </div>
        <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav">
            
            <div class="search">
                <div class="search-input-wrap">
                    <input type="text" id="search-input" class="search-input" tabindex="0"
                           placeholder="Search lakeFS" aria-label="Search lakeFS"
                           autocomplete="off">
                    <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon">
                            <use xlink:href="#svg-search"></use>
                        </svg></label>
                </div>
                <div id="search-results" class="search-results"></div>
            </div>
            

            <div class="nav-category nav-version">
                <label for="selectversion">Version:</label>
                <select id="selectversion" name="version" onchange="javascript:location.href = '/' + encodeURI(this.value);">
                    <option value="" selected>Latest</option>
                </select>
            </div>
            <script async>
                window.addEventListener("load",  async () => {
                    const pathFirstLevel = location.pathname.split('/')[1];
                    const selectedVersion = pathFirstLevel.startsWith('v') && pathFirstLevel || '';
                    const selectVersionElmFirst = document.getElementById('selectversion').firstElementChild;
                    const response = await fetch('/versions.json');
                    if (!response.ok) {
                        return
                    }
                    const versions = await response.json();
                    for (let [key, value] of Object.entries(versions)) {
                        const el = document.createElement("option");
                        el.value = key;
                        el.textContent = value;
                        if (key === selectedVersion) {
                            el.selected = true;
                        }
                        selectVersionElmFirst.after(el);
                    }
                });
            </script>

            <ul class="nav-list"><li
            class="nav-list-item"><a href="/v0.91/"
           class="nav-list-link">What is lakeFS</a></li><li
            class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24">
                <use xlink:href="#svg-arrow-right"></use>
            </svg></a><a href="/v0.91/quickstart/"
           class="nav-list-link">Quickstart</a><ul class="nav-list "><li class="nav-list-item "><a href="/v0.91/quickstart/run.html"
                   class="nav-list-link">Run lakeFS</a></li><li class="nav-list-item "><a href="/v0.91/quickstart/repository.html"
                   class="nav-list-link">Create a Repository</a></li><li class="nav-list-item "><a href="/v0.91/quickstart/add_data.html"
                   class="nav-list-link">Add Data</a></li><li class="nav-list-item "><a href="/v0.91/quickstart/first_commit.html"
                   class="nav-list-link">Commit the Changes</a></li><li class="nav-list-item "><a href="/v0.91/quickstart/more_quickstart_options.html"
                   class="nav-list-link">More Quickstart Options</a></li></ul></li><li
            class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24">
                <use xlink:href="#svg-arrow-right"></use>
            </svg></a><a href="/v0.91/deploy/"
           class="nav-list-link">Deploy and Setup lakeFS</a><ul class="nav-list "><li class="nav-list-item "><a href="/v0.91/deploy/aws.html"
                   class="nav-list-link">AWS</a></li><li class="nav-list-item "><a href="/v0.91/deploy/azure.html"
                   class="nav-list-link">Azure</a></li><li class="nav-list-item "><a href="/v0.91/deploy/gcp.html"
                   class="nav-list-link">GCP</a></li><li class="nav-list-item "><a href="/v0.91/deploy/onprem.html"
                   class="nav-list-link">On-Prem</a></li></ul></li><li
            class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24">
                <use xlink:href="#svg-arrow-right"></use>
            </svg></a><a href="/v0.91/integrations/"
           class="nav-list-link">Integrations</a><ul class="nav-list "><li class="nav-list-item "><a href="/v0.91/integrations/spark.html"
                   class="nav-list-link">Spark</a></li><li class="nav-list-item "><a href="/v0.91/integrations/delta.html"
                   class="nav-list-link">Delta Lake</a></li><li class="nav-list-item "><a href="/v0.91/integrations/aws_cli.html"
                   class="nav-list-link">AWS CLI</a></li><li class="nav-list-item "><a href="/v0.91/integrations/airflow.html"
                   class="nav-list-link">Airflow</a></li><li class="nav-list-item "><a href="/v0.91/integrations/python.html"
                   class="nav-list-link">Python</a></li><li class="nav-list-item "><a href="/v0.91/integrations/duckdb.html"
                   class="nav-list-link">DuckDB</a></li><li class="nav-list-item "><a href="/v0.91/integrations/glue_hive_metastore.html"
                   class="nav-list-link">Glue / Hive metastore</a></li><li class="nav-list-item "><a href="/v0.91/integrations/presto_trino.html"
                   class="nav-list-link">Presto/Trino</a></li><li class="nav-list-item "><a href="/v0.91/integrations/athena.html"
                   class="nav-list-link">Amazon Athena</a></li><li class="nav-list-item "><a href="/v0.91/integrations/kubeflow.html"
                   class="nav-list-link">Kubeflow</a></li><li class="nav-list-item "><a href="/v0.91/integrations/airbyte.html"
                   class="nav-list-link">Airbyte</a></li><li class="nav-list-item "><a href="/v0.91/integrations/dbt.html"
                   class="nav-list-link">dbt</a></li><li class="nav-list-item "><a href="/v0.91/integrations/kakfa.html"
                   class="nav-list-link">Kafka</a></li><li class="nav-list-item "><a href="/v0.91/integrations/sagemaker.html"
                   class="nav-list-link">SageMaker</a></li><li class="nav-list-item "><a href="/v0.91/integrations/hive.html"
                   class="nav-list-link">Hive</a></li><li class="nav-list-item "><a href="/v0.91/integrations/dremio.html"
                   class="nav-list-link">Dremio</a></li><li class="nav-list-item "><a href="/v0.91/integrations/iceberg.html"
                   class="nav-list-link">Iceberg</a></li></ul></li><li
            class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24">
                <use xlink:href="#svg-arrow-right"></use>
            </svg></a><a href="/v0.91/hooks/"
           class="nav-list-link">Hooks</a><ul class="nav-list "><li class="nav-list-item "><a href="/v0.91/hooks/overview.html"
                   class="nav-list-link">Overview</a></li><li class="nav-list-item "><a href="/v0.91/hooks/lua.html"
                   class="nav-list-link">Lua</a></li><li class="nav-list-item "><a href="/v0.91/hooks/webhooks.html"
                   class="nav-list-link">Webhooks</a></li><li class="nav-list-item "><a href="/v0.91/hooks/airflow.html"
                   class="nav-list-link">Airflow</a></li></ul></li><li
            class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24">
                <use xlink:href="#svg-arrow-right"></use>
            </svg></a><a href="/v0.91/use_cases/"
           class="nav-list-link">Use Cases</a><ul class="nav-list "><li class="nav-list-item  active"><a href="/v0.91/use_cases/etl_testing.html"
                   class="nav-list-link active">ETL Testing Environment</a></li><li class="nav-list-item "><a href="/v0.91/use_cases/rollback.html"
                   class="nav-list-link">Rollback</a></li><li class="nav-list-item "><a href="/v0.91/use_cases/reproducibility.html"
                   class="nav-list-link">Reproducibility</a></li><li class="nav-list-item "><a href="/v0.91/use_cases/cicd_for_data.html"
                   class="nav-list-link">CI/CD for data lakes</a></li></ul></li><li
            class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24">
                <use xlink:href="#svg-arrow-right"></use>
            </svg></a><a href="/v0.91/howto/"
           class="nav-list-link">How-To</a><ul class="nav-list "><li class="nav-list-item "><a href="/v0.91/howto/import.html"
                   class="nav-list-link">Import data into lakeFS</a></li><li class="nav-list-item "><a href="/v0.91/howto/garbage-collection.html"
                   class="nav-list-link">Garbage Collection</a></li><li class="nav-list-item "><a href="/v0.91/howto/upgrade.html"
                   class="nav-list-link">Upgrade lakeFS</a></li><li class="nav-list-item "><a href="/v0.91/howto/export.html"
                   class="nav-list-link">Exporting Data</a></li><li class="nav-list-item "><a href="/v0.91/howto/copying.html"
                   class="nav-list-link">Copying data to/from lakeFS</a></li><li class="nav-list-item "><a href="/v0.91/howto/protect-branches.html"
                   class="nav-list-link">Protect Branches</a></li><li class="nav-list-item "><a href="/v0.91/howto/migrate-away.html"
                   class="nav-list-link">Migrating away from lakeFS</a></li><li class="nav-list-item "><a href="/v0.91/howto/sizing-guide.html"
                   class="nav-list-link">Sizing Guide</a></li></ul></li><li
            class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24">
                <use xlink:href="#svg-arrow-right"></use>
            </svg></a><a href="/v0.91/reference/"
           class="nav-list-link">Reference</a><ul class="nav-list "><li class="nav-list-item "><a href="/v0.91/reference/configuration.html"
                   class="nav-list-link">Configuration</a></li><li class="nav-list-item "><a href="/v0.91/reference/cli.html"
                   class="nav-list-link">CLI (lakectl)</a></li><li class="nav-list-item "><a href="/v0.91/reference/api.html"
                   class="nav-list-link">API Reference</a></li><li class="nav-list-item "><a href="/v0.91/reference/spark-client.html"
                   class="nav-list-link">Spark Client</a></li><li class="nav-list-item "><a href="/v0.91/reference/s3.html"
                   class="nav-list-link">S3 Supported API</a></li><li class="nav-list-item "><a href="/v0.91/reference/authentication.html"
                   class="nav-list-link">Authentication</a></li><li class="nav-list-item "><a href="/v0.91/reference/saml-authentication-integration.html"
                   class="nav-list-link">SAML Authentication Integration</a></li><li class="nav-list-item "><a href="/v0.91/reference/authorization.html"
                   class="nav-list-link">Authorization</a></li><li class="nav-list-item "><a href="/v0.91/reference/monitor.html"
                   class="nav-list-link">Monitoring using Prometheus</a></li></ul></li><li
            class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24">
                <use xlink:href="#svg-arrow-right"></use>
            </svg></a><a href="/v0.91/understand/"
           class="nav-list-link">Understanding lakeFS</a><ul class="nav-list "><li class="nav-list-item "><a href="/v0.91/understand/architecture.html"
                   class="nav-list-link">Architecture</a></li><li class="nav-list-item "><a href="/v0.91/understand/model.html"
                   class="nav-list-link">Model</a></li><li class="nav-list-item "><a href="/v0.91/understand/performance-best-practices.html"
                   class="nav-list-link">Performance Best Practices</a></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24">
                        <use xlink:href="#svg-arrow-right"></use>
                    </svg></a><a href="/v0.91/understand/how/"
                   class="nav-list-link">How it Works</a><ul class="nav-list"><li class="nav-list-item ">
                        <a href="/v0.91/understand/how/versioning-internals.html"
                           class="nav-list-link">Versioning Internals</a>
                    </li><li class="nav-list-item ">
                        <a href="/v0.91/understand/how/kv.html"
                           class="nav-list-link">Internal database structure</a>
                    </li><li class="nav-list-item ">
                        <a href="/v0.91/understand/how/merge.html"
                           class="nav-list-link">Merge</a>
                    </li></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24">
                        <use xlink:href="#svg-arrow-right"></use>
                    </svg></a><a href="/v0.91/understand/data_lifecycle_management/"
                   class="nav-list-link">Data Lifecycle Management</a><ul class="nav-list"><li class="nav-list-item ">
                        <a href="/v0.91/understand/data_lifecycle_management/data-devenv.html"
                           class="nav-list-link">In Test</a>
                    </li><li class="nav-list-item ">
                        <a href="/v0.91/understand/data_lifecycle_management/ci.html"
                           class="nav-list-link">During Deployment</a>
                    </li><li class="nav-list-item ">
                        <a href="/v0.91/understand/data_lifecycle_management/production.html"
                           class="nav-list-link">In Production</a>
                    </li></ul></li><li class="nav-list-item "><a href="/v0.91/understand/glossary.html"
                   class="nav-list-link">Glossary</a></li></ul></li><li
            class="nav-list-item"><a href="/v0.91/roadmap.html"
           class="nav-list-link">Roadmap</a></li><li
            class="nav-list-item"><a href="/v0.91/commitment.html"
           class="nav-list-link">Commitment to OSS</a></li><li
            class="nav-list-item"><a href="/v0.91/contributing.html"
           class="nav-list-link">Contributing</a></li><li
            class="nav-list-item"><a href="/v0.91/faq.html"
           class="nav-list-link">FAQ</a></li></ul>
            <div class="mobile-menu">
                
<nav aria-label="Auxiliary" class="aux-nav">
    <ul class="aux-nav-list">
        
        
        <li class="aux-nav-list-item">
            <a href="https://docs.lakefs.io/" class="site-button"  target="_blank"
               rel="noopener noreferrer" >
                Docs
            </a>
        </li>
        
        <li class="aux-nav-list-item">
            <a href="https://lakefs.io/blog/" class="site-button"  target="_blank"
               rel="noopener noreferrer" >
                Blog
            </a>
        </li>
        
        <li class="aux-nav-list-item">
            <a href="https://lakefs.io/community/" class="site-button"  target="_blank"
               rel="noopener noreferrer" >
                Community
            </a>
        </li>
        
        <li class="aux-nav-list-item">
            <a href="https://github.com/treeverse/lakeFS" class="site-button"  target="_blank"
               rel="noopener noreferrer" >
                GitHub
            </a>
        </li>
        
        
        
        
        <li class="aux-nav-list-item button">
            <a href="https://lakefs.io/cloud-registration/" class="site-button"  target="_blank"
               rel="noopener noreferrer" >
                lakeFS Cloud
            </a>
        </li>
        
        
    </ul>
</nav>

            </div>
        </nav>

    </div>
    <div class="main" id="top">
         <div class="feedback-container">
            <div id="is-helpful-ty">
                <div class="text-epsilon">Thank you for your feedback.</div>
                <div class="mt-2 text-epsilon">
                    <a href="https://lakefs.io/slack" target="_blank">Join the community</a> to get more help.
                </div>
            </div>
            <div class="feedback-buttons">
                <span class="tooltip">
                    <button class="page-helpful-btn far fa-lg fa-thumbs-up" id="page-helpful-yes"></button>
                    <span class="tooltiptext">
                        This page is <b>helpful</b>
                    </span>
                </span>
                <span class="tooltip">
                    <button class="page-helpful-btn far fa-lg fa-thumbs-down" id="page-helpful-no"></button>
                    <span class="tooltiptext">
                        This page is <b>not helpful</b>
                    </span>
                </span>
            </div>
        </div>
        <div id="main-header" class="main-header">
            
<nav aria-label="Auxiliary" class="aux-nav">
    <ul class="aux-nav-list">
        
        
        <li class="aux-nav-list-item">
            <a href="https://docs.lakefs.io/" class="site-button"  target="_blank"
               rel="noopener noreferrer" >
                Docs
            </a>
        </li>
        
        <li class="aux-nav-list-item">
            <a href="https://lakefs.io/blog/" class="site-button"  target="_blank"
               rel="noopener noreferrer" >
                Blog
            </a>
        </li>
        
        <li class="aux-nav-list-item">
            <a href="https://lakefs.io/community/" class="site-button"  target="_blank"
               rel="noopener noreferrer" >
                Community
            </a>
        </li>
        
        <li class="aux-nav-list-item">
            <a href="https://github.com/treeverse/lakeFS" class="site-button"  target="_blank"
               rel="noopener noreferrer" >
                GitHub
            </a>
        </li>
        
        
        
        
        <li class="aux-nav-list-item button">
            <a href="https://lakefs.io/cloud-registration/" class="site-button"  target="_blank"
               rel="noopener noreferrer" >
                lakeFS Cloud
            </a>
        </li>
        
        
    </ul>
</nav>

        </div>
        <div id="main-content-wrap" class="main-content-wrap">
            
            
            <nav aria-label="Breadcrumb" class="breadcrumb-nav">
                <ol class="breadcrumb-nav-list">
                    
                    <li class="breadcrumb-nav-list-item"><a href="/v0.91/use_cases/">Use Cases</a>
                    </li>
                    
                    <li class="breadcrumb-nav-list-item"><span>ETL Testing Environment</span></li>
                </ol>
            </nav>
            
            
            <div id="main-content" class="main-content" role="main">
                
                <h1 id="etl-testing-with-isolated-devtest-environment">
  
  
    <a href="#etl-testing-with-isolated-devtest-environment" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> ETL Testing with Isolated Dev/Test Environment
  
  
</h1>
    
<h2 id="why-do-i-need-multiple-environments">
  
  
    <a href="#why-do-i-need-multiple-environments" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Why do I need multiple environments?
  
  
</h2>
    

<p>When working with a data lake, it’s useful to have replicas of your production environment. These replicas allow you to test these ETLs and understand changes to your data without impacting the consumers of the production data.</p>

<p>Running ETL and transformation jobs directly in production without proper ETL Testing is a guaranteed way to have data issues flow into dashboards, ML models, and other consumers sooner or later. The most common approach to avoid making changes directly in production is to create and maintain multiple data environments and perform ETL testing on them. Dev environment to develop the data pipelines and test environment where pipeline changes are tested before pushing it to production.</p>

<p>The issue with this approach is that it’s time-consuming and costly to maintain these separate dev/test environments to enable thoruogh effective ETL testing. And for larger teams it forces multiple people to share these environments, requiring significant co-ordination.</p>
<h2 id="how-do-i-create-devtest-environments-with-lakefs">
  
  
    <a href="#how-do-i-create-devtest-environments-with-lakefs" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> How do I create dev/test environments with lakeFS?
  
  
</h2>
    

<p>lakeFS makes creating isolated dev/test environments for ETL testing instantaneous. This frees you from spending time on environment maintenance and makes it possible to create as many environments as needed.</p>

<p>In a lakeFS repository, data is always located on a <code class="language-plaintext highlighter-rouge">branch</code>. You can think of each <code class="language-plaintext highlighter-rouge">branch</code> in lakeFS as its own environment. This is because branches are isolated, meaning changes on one branch have no effect other branches.</p>

<p class="note">Objects that remain unchanged between two branches are not copied, but rather shared to both branches via metadata pointers that lakeFS manages. If you make a change on one branch and want it reflected on another, you can perform a <code class="language-plaintext highlighter-rouge">merge</code> operation to update one branch with the changes from another.</p>

<p>Let’s see an example of using multiple lakeFS branches for isolation.</p>
<h2 id="using-branches-as-development-and-testing-environments">
  
  
    <a href="#using-branches-as-development-and-testing-environments" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Using branches as development and testing environments
  
  
</h2>
    

<p>The key difference when using lakeFS for isolated data environments is that you can create them immediately before testing a change. And once new data is merged into production, you can delete the branch - effectively deleting the old environment.</p>

<p>This is different from creating a long-living test environment used as a staging area to test all the updates. With lakeFS, <strong>we create a new branch for each change to production</strong> that we want to make. One benefit of this is the ability to test multiple changes at one time.</p>

<p><img src="/v0.91/assets/img/iso_env_dev_test_branching.png" alt="dev/test branches as environments" /></p>
<h1 id="creating-devtest-environments-with-lakefs-for-etl-testing">
  
  
    <a href="#creating-devtest-environments-with-lakefs-for-etl-testing" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Creating Dev/Test Environments with lakeFS for ETL testing
  
  
</h1>
    

<p>lakeFS supports UI, CLI (<code class="language-plaintext highlighter-rouge">lakectl</code> commandline utility) and several client API <a href="../integrations">integrations</a> to run the Git-like operations. Let us explore how to create dev/test environments using each of these options below.</p>
<h2 id="using-lakefs-playground-ui">
  
  
    <a href="#using-lakefs-playground-ui" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Using lakeFS Playground UI
  
  
</h2>
    
<p>In this tutorial, we will use <a href="https://demo.lakefs.io/">lakeFS playground</a> to create dev/test data environments for ETL testing. Playground allows you to spin up a lakeFS instance in a click, create different data environments by simply branching out of your data repository and develop &amp; test data pipelines in these isolated branches.</p>

<p>First, let us spin up a <a href="https://demo.lakefs.io/">playground</a> instance. Once you have a live environment, login to your instance with access and secret keys. Then, you can work with the sample data repository <code class="language-plaintext highlighter-rouge">my-repo</code> that is created for you.</p>

<p><img src="/v0.91/assets/img/iso_env_myrepo.png" alt="sample repository" /></p>

<p>Click on <code class="language-plaintext highlighter-rouge">my-repo</code> and notice that by default, the repo has a <code class="language-plaintext highlighter-rouge">main</code> branch created and <code class="language-plaintext highlighter-rouge">sample_data</code> preloaded to work with.</p>

<p><img src="/v0.91/assets/img/iso_env_sampledata.png" alt="main branch" /></p>

<p>You can create a new branch (say, <code class="language-plaintext highlighter-rouge">test-env</code>) by going to the <em>Branches</em> tab and clicking <em>Create Branch</em>. Once it is successful, you will see two branches under the repo: <code class="language-plaintext highlighter-rouge">main</code> and <code class="language-plaintext highlighter-rouge">test-env</code>.</p>

<p><img src="/v0.91/assets/img/iso_env_testenv_branch.png" alt="test-env branch" /></p>

<p>Now you can add, modify or delete objects under the <code class="language-plaintext highlighter-rouge">test-env</code> branch without affecting the data in the main branch.</p>
<h2 id="using-lakefs-python-client-api-and-jupyter-notebook">
  
  
    <a href="#using-lakefs-python-client-api-and-jupyter-notebook" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Using lakeFS Python Client API and Jupyter notebook
  
  
</h2>
    

<p>This use case shows how to create dev/test data environments for ETL testing using lakeFS branches. The following tutorial will use an existing lakeFS environment (i.e., playground), a jupyter notebook, and python lakefs_client API to demonstrate integration of lakeFS with <a href="../integrations/spark">Spark</a>. You can run this tutorial on your local machine.</p>

<p>Follow the tutorial video below to get started with the playground and jupyter notebook, or follow the instructions on this page.</p>
<iframe width="420" height="315" src="https://www.youtube.com/embed/fprpDZ96JQo"></iframe>
<h3 id="prerequisites">
  
  
    <a href="#prerequisites" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Prerequisites
  
  
</h3>
    

<p>To instantly spin up a lakeFS environment and to work with sample data, use <a href="https://demo.lakefs.io/">lakeFS playground</a>. To use lakeFS with your own production data or to run it in your own machine, check out <a href="/v0.91/quickstart/">Quickstart</a> guide.</p>

<p>Before getting started, you will need <a href="https://docs.docker.com/engine/install/">docker</a> installed on your machine.</p>

<p class="note">Once you have docker installed and a lakeFS instance running, you can access the lakeFS demo notebooks by cloning the <a href="https://github.com/treeverse/lakeFS-samples">lakeFS-samples</a> git repo.</p>

<p>Follow along the steps below to create dev/test environment with lakeFS.</p>

<ul>
  <li>Start by cloning the lakeFS samples Git repository:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone https://github.com/treeverse/lakeFS-samples.git <span class="o">&amp;&amp;</span> <span class="nb">cd </span>03-apache-spark-python-demo
</code></pre></div>    </div>
  </li>
  <li>Run following commands to download and run Docker container which includes Python, Spark, Jupyter Notebook, JDK, Hadoop binaries, lakeFS Python client and Airflow (Docker image size is around 4.5GB):
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> docker build <span class="nt">-t</span> lakefs-spark-python-demo <span class="nb">.</span>

 docker run <span class="nt">-d</span> <span class="nt">-p</span> 8888:8888 <span class="nt">-p</span> 4040:4040 <span class="nt">-p</span> 8080:8080 <span class="nt">--user</span> root <span class="nt">-e</span> <span class="nv">GRANT_SUDO</span><span class="o">=</span><span class="nb">yes</span> <span class="nt">-v</span> <span class="nv">$PWD</span>:/home/jovyan <span class="nt">-v</span> <span class="nv">$PWD</span>/jupyter_notebook_config.py:/home/jovyan/.jupyter/jupyter_notebook_config.py <span class="nt">--name</span> lakefs-spark-python-demo lakefs-spark-python-demo
</code></pre></div>    </div>
  </li>
  <li>Open JupyterLab UI http://127.0.0.1:8888/ in your web browser.</li>
</ul>

<p>Once you have successfully completed setup then open “Spark Demo” notebook from JupyterLab UI and follow the instructions in the notebook.</p>
<h3 id="configuring-lakefs-python-client">
  
  
    <a href="#configuring-lakefs-python-client" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Configuring lakeFS python client
  
  
</h3>
    

<p>Setup lakeFS access credentials for the lakeFS instance running. If you are using lakeFS playground, use the access key, secret key and endpoint details you received in your email. If you are running lakeFS using everything bagel docker, these details are found in docker-compose.yaml file under <code class="language-plaintext highlighter-rouge">lakefs_setup</code> section.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>lakefsAccessKey <span class="o">=</span> <span class="s1">'&lt;lakeFS Access Key&gt;'</span>
lakefsSecretKey <span class="o">=</span> <span class="s1">'&lt;lakeFS Secret Key&gt;'</span>
lakefsEndPoint <span class="o">=</span> <span class="s1">'&lt;lakeFS Endpoint URL&gt;'</span> <span class="c"># e.g. 'https://expert-robin.lakefs-demo.io/'</span>
</code></pre></div></div>

<p>Next, setup the storage namespace to a location in the bucket you have configured. The storage namespace is a location in the underlying storage where data for this repository will be stored. If you are using the lakeFS playground, you can find the storage namespace under the repository name.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>storageNamespace <span class="o">=</span> <span class="s1">'s3://&lt;S3 Bucket Name&gt;/'</span> <span class="c"># e.g. "s3://treeverse-demo-lakefs-storage-production/user_expert-robin/my-repo"</span>
</code></pre></div></div>

<p>You can use lakeFS through the UI, API or <code class="language-plaintext highlighter-rouge">lakectl</code> commandline. For this use-case, we use python <code class="language-plaintext highlighter-rouge">lakefs_client</code> to run lakeFS core operations.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import lakefs_client
from lakefs_client import models
from lakefs_client.client import LakeFSClient

<span class="c"># lakeFS credentials and endpoint</span>
configuration <span class="o">=</span> lakefs_client.Configuration<span class="o">()</span>
configuration.username <span class="o">=</span> lakefsAccessKey
configuration.password <span class="o">=</span> lakefsSecretKey
configuration.host <span class="o">=</span> lakefsEndPoint

client <span class="o">=</span> LakeFSClient<span class="o">(</span>configuration<span class="o">)</span>
</code></pre></div></div>

<p>lakeFS can be configured to work with Spark in two ways:</p>
<ul>
  <li>Access lakeFS using the <a href="/v0.91/integrations/spark.html#use-the-s3-gateway">S3A gateway</a></li>
  <li>Access lakeFS using the <a href="/v0.91/integrations/spark.html#use-the-lakefs-hadoop-filesystem">lakeFS-specific Hadoop FileSystem</a></li>
</ul>
<h3 id="upload-the-sample-data-to-main-branch">
  
  
    <a href="#upload-the-sample-data-to-main-branch" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Upload the sample data to main branch
  
  
</h3>
    

<p>To upload an object to the <code class="language-plaintext highlighter-rouge">my-repo</code>, use the following command.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import os
contentToUpload <span class="o">=</span> open<span class="o">(</span>os.path.expanduser<span class="o">(</span><span class="s1">'~'</span><span class="o">)</span>+<span class="s1">'/lakefs_test.csv'</span>, <span class="s1">'rb'</span><span class="o">)</span>
client.objects.upload_object<span class="o">(</span>
    <span class="nv">repository</span><span class="o">=</span><span class="s2">"my-repo"</span>,
    <span class="nv">branch</span><span class="o">=</span><span class="s2">"main"</span>,
    <span class="nv">path</span><span class="o">=</span>fileName, <span class="nv">content</span><span class="o">=</span>contentToUpload<span class="o">)</span>
</code></pre></div></div>

<p>Once uploaded, commit the changes to the <code class="language-plaintext highlighter-rouge">main</code> branch and attach some metadata to the commit as well.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>client.commits.commit<span class="o">(</span>
    <span class="nv">repository</span><span class="o">=</span><span class="s2">"my-repo"</span>,
    <span class="nv">branch</span><span class="o">=</span><span class="s2">"main"</span>,
    <span class="nv">commit_creation</span><span class="o">=</span>models.CommitCreation<span class="o">(</span>
        <span class="nv">message</span><span class="o">=</span><span class="s1">'Added my first object!'</span>,
        <span class="nv">metadata</span><span class="o">={</span><span class="s1">'using'</span>: <span class="s1">'python_api'</span><span class="o">}))</span>
</code></pre></div></div>

<p>In this example, we use lakeFS S3A gateway to read data from the storage bucket.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dataPath <span class="o">=</span> f<span class="s2">"s3a://my-repo/main/lakefs_test.csv"</span>
<span class="nb">df</span> <span class="o">=</span> spark.read.csv<span class="o">(</span>dataPath<span class="o">)</span>
df.show<span class="o">()</span>
</code></pre></div></div>
<h3 id="create-a-test-branch">
  
  
    <a href="#create-a-test-branch" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Create a test branch
  
  
</h3>
    

<p>Let us start by creating a new branch <code class="language-plaintext highlighter-rouge">test-env</code> on the example repo <code class="language-plaintext highlighter-rouge">my-repo</code>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>client.branches.create_branch<span class="o">(</span>
    <span class="nv">repository</span><span class="o">=</span><span class="s2">"my-repo"</span>,
    <span class="nv">branch_creation</span><span class="o">=</span>models.BranchCreation<span class="o">(</span>
        <span class="nv">name</span><span class="o">=</span><span class="s2">"test-env"</span>,
        <span class="nb">source</span><span class="o">=</span><span class="s2">"main"</span><span class="o">))</span>
</code></pre></div></div>

<p>Now we can use Spark to write the csv file from <code class="language-plaintext highlighter-rouge">main</code> branch as a Parquet file to the <code class="language-plaintext highlighter-rouge">test-env</code> of our lakeFS repo. Suppose we accidentally write the dataframe back to “test-env” branch again, this time in append mode.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>df.write.mode<span class="o">(</span><span class="s1">'overwrite'</span><span class="o">)</span>.parquet<span class="o">(</span><span class="s1">'s3a://my-repo/test-env/'</span><span class="o">)</span>
df.write.mode<span class="o">(</span><span class="s1">'append'</span><span class="o">)</span>.parquet<span class="o">(</span><span class="s1">'s3a://my-repo/test-env/'</span><span class="o">)</span>
</code></pre></div></div>
<p>What happens if we re-read in the data on both branches and perform a count on the resulting DataFrames?
There will be twice as many rows in <code class="language-plaintext highlighter-rouge">test-env</code> branch. That is, we accidentally duplicated our data! Oh no!</p>

<p>Data duplication introduce errors into our data analytics, BI and machine learning efforts, hence we would like to avoid duplicating our data.</p>

<p>On the <code class="language-plaintext highlighter-rouge">main</code> branch however, there is still just the original data - untouched by our spark code. This shows the utility of branch-based isolated environments with lakeFS.</p>

<p>You can safely continue working with the data from main which is unharmed due to lakeFS isolation capabilities.</p>
<h2 id="case-study-enigma">
  
  
    <a href="#case-study-enigma" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Case Study: Enigma
  
  
</h2>
    
<p>Learn how Enigma increased Data Engineers efficiency using lakeFS’ branching to <a href="https://enigma.com/blog/post/improving-our-research-velocity-with-lakefs">achieve islated development and staging environments</a>.</p>
<h2 id="further-reading">
  
  
    <a href="#further-reading" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Further Reading
  
  
</h2>
    
<p>For further details on the best practices of ETL testing on data lakes with lakeFS go to the <a href="https://lakefs.io/blog/etl-testing/">lakeFS Blog</a></p>

                

                
                

            </div>
        </div>

        
        

        <div class="search-overlay"></div>
        
    </div>
</div>

<footer>
    <div class="footer-sidebar"></div>
    <div class="footer-main">
        <div class="row">
            <a href="https://lakefs.io" class="site-title lh-tight">
                <div class="site-logo"></div>
            </a>
        </div>
        <div class="row">
            <div class="left">
                <ul class="footer-links">
                    
                    
                    <li class="aux-nav-list-item">
                        <a href="https://docs.lakefs.io/" class="site-button"  target="_blank"
                            rel="noopener noreferrer" >
                            Docs
                        </a>
                    </li>
                    
                    <li class="aux-nav-list-item">
                        <a href="https://lakefs.io/blog/" class="site-button"  target="_blank"
                            rel="noopener noreferrer" >
                            Blog
                        </a>
                    </li>
                    
                    <li class="aux-nav-list-item">
                        <a href="https://github.com/treeverse/lakeFS" class="site-button"  target="_blank"
                            rel="noopener noreferrer" >
                            GitHub
                        </a>
                    </li>
                    
                    <li class="aux-nav-list-item">
                        <a href="https://lakefs.io/community/" class="site-button"  target="_blank"
                            rel="noopener noreferrer" >
                            Community
                        </a>
                    </li>
                    
                    <li class="aux-nav-list-item">
                        <a href="https://lakefs.io/cloud-registration/" class="site-button"  target="_blank"
                            rel="noopener noreferrer" >
                            lakeFS Cloud
                        </a>
                    </li>
                    
                    <li class="aux-nav-list-item">
                        <a href="https://lakefs.io/contact-us/" class="site-button"  target="_blank"
                            rel="noopener noreferrer" >
                            Contact
                        </a>
                    </li>
                    
                    
                </ul>
            </div>
            <div class="right">
                <ul class="footer-social">
                    
                    
                    <li class="aux-nav-list-item">
                        <a href="https://lakefs.io/youtube" class="site-button"  target="_blank"
                            rel="noopener noreferrer" >
                            <img src="/v0.91/assets/icons/youtube.svg" class="no-hover" />
                            <img src="/v0.91/assets/icons/youtube-hover.svg" class="hover" />
                        </a>
                    </li>
                    
                    <li class="aux-nav-list-item">
                        <a href="https://www.linkedin.com/company/treeverse" class="site-button"  target="_blank"
                            rel="noopener noreferrer" >
                            <img src="/v0.91/assets/icons/linkedin.svg" class="no-hover" />
                            <img src="/v0.91/assets/icons/linkedin-hover.svg" class="hover" />
                        </a>
                    </li>
                    
                    <li class="aux-nav-list-item">
                        <a href="https://github.com/treeverse/lakeFS" class="site-button"  target="_blank"
                            rel="noopener noreferrer" >
                            <img src="/v0.91/assets/icons/github.svg" class="no-hover" />
                            <img src="/v0.91/assets/icons/github-hover.svg" class="hover" />
                        </a>
                    </li>
                    
                    <li class="aux-nav-list-item">
                        <a href="https://twitter.com/lakeFS" class="site-button"  target="_blank"
                            rel="noopener noreferrer" >
                            <img src="/v0.91/assets/icons/twitter.svg" class="no-hover" />
                            <img src="/v0.91/assets/icons/twitter-hover.svg" class="hover" />
                        </a>
                    </li>
                    
                    <li class="aux-nav-list-item">
                        <a href="https://lakefs.io/slack" class="site-button"  target="_blank"
                            rel="noopener noreferrer" >
                            <img src="/v0.91/assets/icons/slack.svg" class="no-hover" />
                            <img src="/v0.91/assets/icons/slack-hover.svg" class="hover" />
                        </a>
                    </li>
                    
                    
                </ul>
            </div>
        </div>
        <div class="row top-border">
            <div class="left"><a href="/v0.91https://www.treeverse.io/">
                    <div class="other-logo"><img src="/v0.91/assets/by-treeverse.png" /></div>
                </a></div>
            <div class="right">
                <ul class="bottom-footer-links">
                    
                    
                    <li class="aux-nav-list-item">
                        <a href="https://lakefs.io/terms-of-use/" class="site-button"  target="_blank"
                            rel="noopener noreferrer" >
                            Terms of use
                        </a>
                    </li>
                    
                    <li class="aux-nav-list-item">
                        <a href="https://lakefs.io/privacy-policy/" class="site-button"  target="_blank"
                            rel="noopener noreferrer" >
                            Privacy Policy
                        </a>
                    </li>
                    
                    
                </ul>
            </div>
        </div>
    </div>
</footer>


</body>

</html>

