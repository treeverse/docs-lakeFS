

<!DOCTYPE html>

<html lang="en-US">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge">

  <link rel="stylesheet" href="/v1.17/assets/css/just-the-docs-default.css">
  
  <style type="text/css">
.site-nav > .nav-list:nth-child(1):not(.nav-category-list) > .nav-list-item:not(.external):nth-child(3) > .nav-list > .nav-list-item:nth-child(2) > .nav-list > .nav-list-item:nth-child(2) > .nav-list-link { display: block; font-weight: 600; text-decoration: none; background-image: linear-gradient(-90deg, #ebedf5 0%, rgba(235, 237, 245, 0.8) 80%, rgba(235, 237, 245, 0) 100%); }

.site-nav > .nav-list:nth-child(1):not(.nav-category-list) > .nav-list-item:not(.passive):nth-child(3) > .nav-list-expander svg, .site-nav > .nav-list:nth-child(1):not(.nav-category-list) > .nav-list-item:not(.passive):nth-child(3) > .nav-list > .nav-list-item:not(.passive):nth-child(2) > .nav-list-expander svg { transform: rotate(-90deg); }
.site-nav > .nav-list:nth-child(1):not(.nav-category-list) > .nav-list-item:not(.passive):nth-child(3) > .nav-list, .site-nav > .nav-list:nth-child(1):not(.nav-category-list) > .nav-list-item:not(.passive):nth-child(3) > .nav-list > .nav-list-item:not(.passive):nth-child(2) > .nav-list { display: block; }

.site-nav > .nav-category-list > .nav-list-item:not(.passive) > .nav-list-expander svg { transform: rotate(-90deg); }
.site-nav > .nav-category-list > .nav-list-item:not(.passive) > .nav-list { display: block; }

</style>


  

  
    <script src="/v1.17/assets/js/vendor/lunr.min.js"></script>
  

  <script src="/v1.17/assets/js/just-the-docs.js"></script>

  <meta name="viewport" content="width=device-width, initial-scale=1">

  

  <link rel="icon" href="/v1.17/favicon.ico" type="image/x-icon">



  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Lua Hooks | lakeFS Documentation</title>
<meta name="generator" content="Jekyll v3.9.3" />
<meta property="og:title" content="Lua Hooks" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Lua Hooks reference" />
<meta property="og:description" content="Lua Hooks reference" />
<meta property="og:site_name" content="lakeFS Documentation" />
<meta property="og:image" content="https://docs.lakefs.io/assets/img/docs_logo.png" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:image" content="https://docs.lakefs.io/assets/img/docs_logo.png" />
<meta property="twitter:title" content="Lua Hooks" />
<meta name="twitter:site" content="@lakeFS" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"Lua Hooks reference","headline":"Lua Hooks","image":"https://docs.lakefs.io/assets/img/docs_logo.png","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"/v1.17/assets/logo.svg"}},"url":"/v1.17/howto/hooks/lua.html"}</script>
<!-- End Jekyll SEO tag -->


  <!-- Google Tag Manager Head -->
<!-- type="text/plain" is intentional for cookie consent support -->
<script type="text/plain" data-category="analytics">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
            new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KTZBZW9');</script>
<!-- End Google Tag Manager Head -->
<meta name="robots" content="noindex">
<meta property="og:image" content="/v1.17/assets/img/lakefs-logo-with-text.png">
<link rel="preload" href="/assets/fonts/Rene Bieder - Galano Grotesque.otf" as="font" type="font/otf" crossorigin>
<link rel="preload" href="/assets/fonts/Rene Bieder - Galano Grotesque Medium.otf" as="font" type="font/otf" crossorigin>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/fontawesome.min.css" integrity="sha512-giQeaPns4lQTBMRpOOHsYnGw1tGVzbAIHUyHRgn7+6FmiEgGGjaG0T2LZJmAPMzRCl+Cug0ItQ2xDZpTmEc+CQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" integrity="sha512-MV7K8+y+gLIBoVD59lQIYicR65iaqukzvf/nwasF0nqhPay5w/9lJmVM2hMDcnK1OnMGCdVK+iQrJ7lzPJQd1w==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orestbida/cookieconsent@v3.0.0/dist/cookieconsent.css">
<link rel="stylesheet" href="/v1.17/assets/css/cookieconsent.css" />
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js" crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.13.2/themes/smoothness/jquery-ui.css">
<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.13.2/jquery-ui.min.js"></script>
<script type="module" src="/v1.17/assets/js/cookieconsent-init.js"></script>
<script src="/v1.17/assets/js/copy-code.js"></script>
<script>
    $(function () {
        $(".tabs").tabs();
    });
</script>
<script src="/v1.17/assets/js/feedback.js"></script>
<link href="https://data-folks.masto.host/@lakeFS" rel="me">

</head>

<script src="https://unpkg.com/mermaid@9.3.0/dist/mermaid.min.js"></script>
<script>
    $(document).ready(function () {
        mermaid.initialize({
            startOnLoad:true,
            theme: "default",
        });
        window.mermaid.init(undefined, document.querySelectorAll('.language-mermaid'));
    });
</script>
<body>
<img src="/assets/img/cookies.png" style="display: none;">
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KTZBZW9"
                  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
    <symbol id="svg-link" viewBox="0 0 24 24">
        <title>Link</title>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
             stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
             class="feather feather-link">
            <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
            <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
        </svg>
    </symbol>
    <symbol id="svg-search" viewBox="0 0 24 24">
        <title>Search</title>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
             stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
             class="feather feather-search">
            <circle cx="11" cy="11" r="8"></circle>
            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
        </svg>
    </symbol>
    <symbol id="svg-menu" viewBox="0 0 24 24">
        <title>Menu</title>
        <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="16px" viewBox="0 0 20 16" version="1.1"
             class="feather feather-menu">
            <g id="Symbols" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                <g id="header-/-mobile" transform="translate(-30.000000, -32.000000)" fill="#279890">
                    <g id="Group" transform="translate(30.000000, 32.000000)">
                        <path
                                d="M20,14 L20,16 L0,16 L0,14 L20,14 Z M20,7 L20,9 L0,9 L0,7 L20,7 Z M20,0 L20,2 L0,2 L0,0 L20,0 Z"
                                id="mobile-menu" />
                    </g>
                </g>
            </g>
        </svg>
    </symbol>
    <symbol id="svg-arrow-right" viewBox="0 0 24 24">
        <title>Expand</title>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
             stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
             class="feather feather-chevron-right">
            <polyline points="9 18 15 12 9 6"></polyline>
        </svg>
    </symbol>
    <symbol id="svg-doc" viewBox="0 0 24 24">
        <title>Document</title>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
             stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
             class="feather feather-file">
            <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path>
            <polyline points="13 2 13 9 20 9"></polyline>
        </svg>
    </symbol>
</svg>
<div class="body-wrapper">
    <div class="side-bar">
        <div class="site-header">
            <a href="https://lakefs.io" class="site-title lh-tight">
  <div class="site-logo" role="img" aria-label="lakeFS Documentation"></div>

</a>
            <a href="#" id="menu-button" class="site-button">
                <svg viewBox="0 0 24 24" class="icon">
                    <use xlink:href="#svg-menu"></use>
                </svg>
            </a>
        </div>
        <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav">
            
            <div class="search">
                <div class="search-input-wrap">
                    <input type="text" id="search-input" class="search-input" tabindex="0"
                           placeholder="Search lakeFS Documentation" aria-label="Search lakeFS Documentation"
                           autocomplete="off">
                    <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon">
                            <use xlink:href="#svg-search"></use>
                        </svg></label>
                </div>
                <div id="search-results" class="search-results"></div>
            </div>
            

            <div class="nav-category nav-version">
                <label for="selectversion">Version:</label>
                <select id="selectversion" name="version" onchange="javascript:location.href = '/' + encodeURI(this.value);">
                    <option value="" selected>Latest</option>
                </select>
            </div>
            <script async>
                window.addEventListener("load",  async () => {
                    const pathFirstLevel = location.pathname.split('/')[1];
                    const selectedVersion = pathFirstLevel.startsWith('v') && pathFirstLevel || '';
                    const selectVersionElmFirst = document.getElementById('selectversion').firstElementChild;
                    const response = await fetch('/versions.json');
                    if (!response.ok) {
                        return
                    }
                    const versions = await response.json();
                    for (let [key, value] of Object.entries(versions)) {
                        const el = document.createElement("option");
                        el.value = key;
                        el.textContent = value;
                        if (key === selectedVersion) {
                            el.selected = true;
                        }
                        selectVersionElmFirst.after(el);
                    }
                });
            </script>

            <ul class="nav-list"><li
            class="nav-list-item"><a href="/v1.17/"
           class="nav-list-link">Welcome to lakeFS</a></li><li
            class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24">
                <use xlink:href="#svg-arrow-right"></use>
            </svg></a><a href="/v1.17/quickstart/"
           class="nav-list-link">⭐ Quickstart</a><ul class="nav-list "><li class="nav-list-item "><a href="/v1.17/quickstart/launch.html"
                   class="nav-list-link">1️⃣ Run lakeFS</a></li><li class="nav-list-item "><a href="/v1.17/quickstart/query.html"
                   class="nav-list-link">2️⃣ Query the data</a></li><li class="nav-list-item "><a href="/v1.17/quickstart/branch.html"
                   class="nav-list-link">3️⃣ Create a branch</a></li><li class="nav-list-item "><a href="/v1.17/quickstart/commit-and-merge.html"
                   class="nav-list-link">4️⃣ Commit and Merge</a></li><li class="nav-list-item "><a href="/v1.17/quickstart/rollback.html"
                   class="nav-list-link">5️⃣ Roll back Changes</a></li><li class="nav-list-item "><a href="/v1.17/quickstart/actions-and-hooks.html"
                   class="nav-list-link">6️⃣ Using Actions and Hooks in lakeFS</a></li><li class="nav-list-item "><a href="/v1.17/quickstart/work-with-data-locally.html"
                   class="nav-list-link">7️⃣ Work with lakeFS data locally</a></li><li class="nav-list-item "><a href="/v1.17/quickstart/learning-more-lakefs.html"
                   class="nav-list-link">Learn more about lakeFS</a></li></ul></li><li
            class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24">
                <use xlink:href="#svg-arrow-right"></use>
            </svg></a><a href="/v1.17/howto/"
           class="nav-list-link">How-To</a><ul class="nav-list "><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24">
                        <use xlink:href="#svg-arrow-right"></use>
                    </svg></a><a href="/v1.17/howto/deploy/"
                   class="nav-list-link">Install lakeFS</a><ul class="nav-list"><li class="nav-list-item ">
                        <a href="/v1.17/howto/deploy/aws.html"
                           class="nav-list-link">AWS</a>
                    </li><li class="nav-list-item ">
                        <a href="/v1.17/howto/deploy/azure.html"
                           class="nav-list-link">Azure</a>
                    </li><li class="nav-list-item ">
                        <a href="/v1.17/howto/deploy/gcp.html"
                           class="nav-list-link">GCP</a>
                    </li><li class="nav-list-item ">
                        <a href="/v1.17/howto/deploy/onprem.html"
                           class="nav-list-link">On-Premises</a>
                    </li><li class="nav-list-item ">
                        <a href="/v1.17/howto/deploy/upgrade.html"
                           class="nav-list-link">Upgrade lakeFS</a>
                    </li></ul></li><li class="nav-list-item  active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24">
                        <use xlink:href="#svg-arrow-right"></use>
                    </svg></a><a href="/v1.17/howto/hooks/"
                   class="nav-list-link">Actions and Hooks</a><ul class="nav-list"><li class="nav-list-item ">
                        <a href="/v1.17/howto/hooks/airflow.html"
                           class="nav-list-link">Airflow Hooks</a>
                    </li><li class="nav-list-item  active">
                        <a href="/v1.17/howto/hooks/lua.html"
                           class="nav-list-link active">Lua Hooks</a>
                    </li><li class="nav-list-item ">
                        <a href="/v1.17/howto/hooks/webhooks.html"
                           class="nav-list-link">Webhooks</a>
                    </li></ul></li><li class="nav-list-item "><a href="/v1.17/howto/copying.html"
                   class="nav-list-link">Copying data to/from lakeFS</a></li><li class="nav-list-item "><a href="/v1.17/howto/catalog_exports.html"
                   class="nav-list-link">Data Catalogs Export</a></li><li class="nav-list-item "><a href="/v1.17/howto/export.html"
                   class="nav-list-link">Export Data</a></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24">
                        <use xlink:href="#svg-arrow-right"></use>
                    </svg></a><a href="/v1.17/howto/garbage-collection/"
                   class="nav-list-link">Garbage Collection</a><ul class="nav-list"><li class="nav-list-item ">
                        <a href="/v1.17/howto/garbage-collection/gc.html"
                           class="nav-list-link">Garbage Collection</a>
                    </li><li class="nav-list-item ">
                        <a href="/v1.17/howto/garbage-collection/managed-gc.html"
                           class="nav-list-link">Managed Garbage Collection</a>
                    </li></ul></li><li class="nav-list-item "><a href="/v1.17/howto/import.html"
                   class="nav-list-link">Import Data</a></li><li class="nav-list-item "><a href="/v1.17/howto/migrate-away.html"
                   class="nav-list-link">Migrating away from lakeFS</a></li><li class="nav-list-item "><a href="/v1.17/howto/mirroring.html"
                   class="nav-list-link">Mirroring</a></li><li class="nav-list-item "><a href="/v1.17/howto/private-link.html"
                   class="nav-list-link">Private Link</a></li><li class="nav-list-item "><a href="/v1.17/howto/protect-branches.html"
                   class="nav-list-link">Protect Branches</a></li><li class="nav-list-item "><a href="/v1.17/howto/sizing-guide.html"
                   class="nav-list-link">Sizing Guide</a></li><li class="nav-list-item "><a href="/v1.17/howto/scim.html"
                   class="nav-list-link">System for Cross-domain Identity Management (SCIM)</a></li><li class="nav-list-item "><a href="/v1.17/howto/local-checkouts.html"
                   class="nav-list-link">Work with lakeFS data locally</a></li></ul></li><li
            class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24">
                <use xlink:href="#svg-arrow-right"></use>
            </svg></a><a href="/v1.17/integrations/"
           class="nav-list-link">Integrations</a><ul class="nav-list "><li class="nav-list-item "><a href="/v1.17/integrations/aws_cli.html"
                   class="nav-list-link">AWS CLI</a></li><li class="nav-list-item "><a href="/v1.17/integrations/airbyte.html"
                   class="nav-list-link">Airbyte</a></li><li class="nav-list-item "><a href="/v1.17/integrations/athena.html"
                   class="nav-list-link">Amazon Athena</a></li><li class="nav-list-item "><a href="/v1.17/integrations/sagemaker.html"
                   class="nav-list-link">Amazon SageMaker</a></li><li class="nav-list-item "><a href="/v1.17/integrations/airflow.html"
                   class="nav-list-link">Apache Airflow</a></li><li class="nav-list-item "><a href="/v1.17/integrations/hive.html"
                   class="nav-list-link">Apache Hive</a></li><li class="nav-list-item "><a href="/v1.17/integrations/iceberg.html"
                   class="nav-list-link">Apache Iceberg</a></li><li class="nav-list-item "><a href="/v1.17/integrations/kafka.html"
                   class="nav-list-link">Apache Kafka</a></li><li class="nav-list-item "><a href="/v1.17/integrations/spark.html"
                   class="nav-list-link">Apache Spark</a></li><li class="nav-list-item "><a href="/v1.17/integrations/cloudera.html"
                   class="nav-list-link">Cloudera</a></li><li class="nav-list-item "><a href="/v1.17/integrations/delta.html"
                   class="nav-list-link">Delta Lake</a></li><li class="nav-list-item "><a href="/v1.17/integrations/dremio.html"
                   class="nav-list-link">Dremio</a></li><li class="nav-list-item "><a href="/v1.17/integrations/duckdb.html"
                   class="nav-list-link">DuckDB</a></li><li class="nav-list-item "><a href="/v1.17/integrations/git.html"
                   class="nav-list-link">Git</a></li><li class="nav-list-item "><a href="/v1.17/integrations/glue_hive_metastore.html"
                   class="nav-list-link">Glue / Hive metastore</a></li><li class="nav-list-item "><a href="/v1.17/integrations/glue_metastore.html"
                   class="nav-list-link">Glue Data Catalog</a></li><li class="nav-list-item "><a href="/v1.17/integrations/huggingface_datasets.html"
                   class="nav-list-link">HuggingFace Datasets</a></li><li class="nav-list-item "><a href="/v1.17/integrations/kubeflow.html"
                   class="nav-list-link">Kubeflow</a></li><li class="nav-list-item "><a href="/v1.17/integrations/presto_trino.html"
                   class="nav-list-link">Presto / Trino</a></li><li class="nav-list-item "><a href="/v1.17/integrations/python.html"
                   class="nav-list-link">Python</a></li><li class="nav-list-item "><a href="/v1.17/integrations/r.html"
                   class="nav-list-link">R</a></li><li class="nav-list-item "><a href="/v1.17/integrations/unity-catalog.html"
                   class="nav-list-link">Unity Catalog</a></li><li class="nav-list-item "><a href="/v1.17/integrations/vertex_ai.html"
                   class="nav-list-link">Vertex AI</a></li></ul></li><li
            class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24">
                <use xlink:href="#svg-arrow-right"></use>
            </svg></a><a href="/v1.17/understand/"
           class="nav-list-link">Understanding lakeFS</a><ul class="nav-list "><li class="nav-list-item "><a href="/v1.17/understand/architecture.html"
                   class="nav-list-link">Architecture</a></li><li class="nav-list-item "><a href="/v1.17/understand/model.html"
                   class="nav-list-link">Concepts and  Model</a></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24">
                        <use xlink:href="#svg-arrow-right"></use>
                    </svg></a><a href="/v1.17/understand/data_lifecycle_management/"
                   class="nav-list-link">Data Lifecycle Management</a><ul class="nav-list"><li class="nav-list-item ">
                        <a href="/v1.17/understand/data_lifecycle_management/ci.html"
                           class="nav-list-link">During Deployment</a>
                    </li><li class="nav-list-item ">
                        <a href="/v1.17/understand/data_lifecycle_management/production.html"
                           class="nav-list-link">In Production</a>
                    </li><li class="nav-list-item ">
                        <a href="/v1.17/understand/data_lifecycle_management/data-devenv.html"
                           class="nav-list-link">In Test</a>
                    </li></ul></li><li class="nav-list-item "><a href="/v1.17/understand/faq.html"
                   class="nav-list-link">FAQ</a></li><li class="nav-list-item "><a href="/v1.17/understand/glossary.html"
                   class="nav-list-link">Glossary</a></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24">
                        <use xlink:href="#svg-arrow-right"></use>
                    </svg></a><a href="/v1.17/understand/how/"
                   class="nav-list-link">How lakeFS Works</a><ul class="nav-list"><li class="nav-list-item ">
                        <a href="/v1.17/understand/how/kv.html"
                           class="nav-list-link">Internal database structure</a>
                    </li><li class="nav-list-item ">
                        <a href="/v1.17/understand/how/merge.html"
                           class="nav-list-link">Merge</a>
                    </li><li class="nav-list-item ">
                        <a href="/v1.17/understand/how/versioning-internals.html"
                           class="nav-list-link">Versioning Internals</a>
                    </li></ul></li><li class="nav-list-item "><a href="/v1.17/understand/performance-best-practices.html"
                   class="nav-list-link">Performance Best Practices</a></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24">
                        <use xlink:href="#svg-arrow-right"></use>
                    </svg></a><a href="/v1.17/understand/use_cases/"
                   class="nav-list-link">Use Cases</a><ul class="nav-list"><li class="nav-list-item ">
                        <a href="/v1.17/understand/use_cases/cicd_for_data.html"
                           class="nav-list-link">CI/CD for Data Lakes</a>
                    </li><li class="nav-list-item ">
                        <a href="/v1.17/understand/use_cases/etl_testing.html"
                           class="nav-list-link">ETL Testing Environment</a>
                    </li><li class="nav-list-item ">
                        <a href="/v1.17/understand/use_cases/reproducibility.html"
                           class="nav-list-link">Reproducibility</a>
                    </li><li class="nav-list-item ">
                        <a href="/v1.17/understand/use_cases/rollback.html"
                           class="nav-list-link">Rollback</a>
                    </li></ul></li><li class="nav-list-item "><a href="/v1.17/understand/lakefs-cloud.html"
                   class="nav-list-link">lakeFS Cloud</a></li><li class="nav-list-item "><a href="/v1.17/understand/lakefs-enterprise.html"
                   class="nav-list-link">lakeFS Enterprise</a></li></ul></li><li
            class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24">
                <use xlink:href="#svg-arrow-right"></use>
            </svg></a><a href="/v1.17/reference/"
           class="nav-list-link">Reference</a><ul class="nav-list "><li class="nav-list-item "><a href="/v1.17/reference/auditing.html"
                   class="nav-list-link">Auditing</a></li><li class="nav-list-item "><a href="/v1.17/reference/monitor.html"
                   class="nav-list-link">Monitoring using Prometheus</a></li><li class="nav-list-item "><a href="/v1.17/reference/s3.html"
                   class="nav-list-link">S3 Gateway API</a></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24">
                        <use xlink:href="#svg-arrow-right"></use>
                    </svg></a><a href="/v1.17/reference/security/"
                   class="nav-list-link">Security</a><ul class="nav-list"><li class="nav-list-item ">
                        <a href="/v1.17/reference/security/access-control-lists.html"
                           class="nav-list-link">Access Control Lists (ACLs)</a>
                    </li><li class="nav-list-item ">
                        <a href="/v1.17/reference/security/authentication.html"
                           class="nav-list-link">Authentication</a>
                    </li><li class="nav-list-item ">
                        <a href="/v1.17/reference/security/presigned-url.html"
                           class="nav-list-link">Presigned URL</a>
                    </li><li class="nav-list-item ">
                        <a href="/v1.17/reference/security/remote-authenticator.html"
                           class="nav-list-link">Remote Authenticator</a>
                    </li><li class="nav-list-item ">
                        <a href="/v1.17/reference/security/rbac.html"
                           class="nav-list-link">Role-Based Access Control (RBAC)</a>
                    </li><li class="nav-list-item ">
                        <a href="/v1.17/reference/security/sso.html"
                           class="nav-list-link">Single Sign On (SSO)</a>
                    </li></ul></li><li class="nav-list-item "><a href="/v1.17/reference/spark-client.html"
                   class="nav-list-link">Spark Client</a></li><li class="nav-list-item "><a href="/v1.17/reference/api.html"
                   class="nav-list-link">lakeFS API</a></li><li class="nav-list-item "><a href="/v1.17/reference/configuration.html"
                   class="nav-list-link">lakeFS Server Configuration</a></li><li class="nav-list-item "><a href="/v1.17/reference/cli.html"
                   class="nav-list-link">lakectl (lakeFS command-line tool)</a></li></ul></li><li
            class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24">
                <use xlink:href="#svg-arrow-right"></use>
            </svg></a><a href="/v1.17/project/"
           class="nav-list-link">The lakeFS Project</a><ul class="nav-list "><li class="nav-list-item "><a href="/v1.17/project/contributing.html"
                   class="nav-list-link">Contributing to lakeFS</a></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24">
                        <use xlink:href="#svg-arrow-right"></use>
                    </svg></a><a href="/v1.17/project/docs/"
                   class="nav-list-link">Documentation</a><ul class="nav-list"><li class="nav-list-item ">
                        <a href="/v1.17/project/docs/callouts.html"
                           class="nav-list-link">Callouts</a>
                    </li></ul></li><li class="nav-list-item "><a href="/v1.17/project/code-migrate-1.0-sdk.html"
                   class="nav-list-link">Migrating to 1.0</a></li></ul></li><li
            class="nav-list-item"><a href="/v1.17/posts/tdd-semver.html"
           class="nav-list-link">lakeFS SemVer + TDD</a></li></ul>
            <div class="mobile-menu">
                
<nav aria-label="Auxiliary" class="aux-nav">
    <ul class="aux-nav-list">
        
        
        <li class="aux-nav-list-item">
            <a href="https://docs.lakefs.io/" class="site-button" >
                Docs
            </a>
        </li>
        
        <li class="aux-nav-list-item">
            <a href="https://lakefs.io/blog/" class="site-button" >
                Blog
            </a>
        </li>
        
        <li class="aux-nav-list-item">
            <a href="https://lakefs.io/community/" class="site-button" >
                Community
            </a>
        </li>
        
        <li class="aux-nav-list-item">
            <a href="https://github.com/treeverse/lakeFS" class="site-button" >
                GitHub
            </a>
        </li>
        
        
        
        
        <li class="aux-nav-list-item button">
            <a href="https://lakefs.io/slack" class="site-button" >
                Join us on Slack
            </a>
        </li>
        
        
    </ul>
</nav>

            </div>
        </nav>

    </div>
    <div class="main" id="top">
         <div class="feedback-container">
            <div id="is-helpful-ty">
                <div class="text-epsilon">Thank you for your feedback.</div>
                <div class="mt-2 text-epsilon">
                    <a href="https://lakefs.io/slack" target="_blank">Join the community</a> to get more help.
                </div>
            </div>
            <div class="feedback-buttons">
                <span class="tooltip">
                    <button class="page-helpful-btn far fa-lg fa-thumbs-up" id="page-helpful-yes"></button>
                    <span class="tooltiptext">
                        This page is <b>helpful</b>
                    </span>
                </span>
                <span class="tooltip">
                    <button class="page-helpful-btn far fa-lg fa-thumbs-down" id="page-helpful-no"></button>
                    <span class="tooltiptext">
                        This page is <b>not helpful</b>
                    </span>
                </span>
            </div>
        </div>
        <div id="main-header" class="main-header">
            
<nav aria-label="Auxiliary" class="aux-nav">
    <ul class="aux-nav-list">
        
        
        <li class="aux-nav-list-item">
            <a href="https://docs.lakefs.io/" class="site-button" >
                Docs
            </a>
        </li>
        
        <li class="aux-nav-list-item">
            <a href="https://lakefs.io/blog/" class="site-button" >
                Blog
            </a>
        </li>
        
        <li class="aux-nav-list-item">
            <a href="https://lakefs.io/community/" class="site-button" >
                Community
            </a>
        </li>
        
        <li class="aux-nav-list-item">
            <a href="https://github.com/treeverse/lakeFS" class="site-button" >
                GitHub
            </a>
        </li>
        
        
        
        
        <li class="aux-nav-list-item button">
            <a href="https://lakefs.io/slack" class="site-button" >
                Join us on Slack
            </a>
        </li>
        
        
    </ul>
</nav>

        </div>
        <div id="main-content-wrap" class="main-content-wrap">
            
            
            <nav aria-label="Breadcrumb" class="breadcrumb-nav">
                <ol class="breadcrumb-nav-list">
                    
                    <li class="breadcrumb-nav-list-item"><a
                                href="/v1.17/howto/">How-To</a>
                    </li>
                    <li class="breadcrumb-nav-list-item"><a href="/v1.17/howto/hooks/">Actions and Hooks</a>
                    </li>
                    
                    <li class="breadcrumb-nav-list-item"><span>Lua Hooks</span></li>
                </ol>
            </nav>
            
            
            <div id="main-content" class="main-content" role="main">
                
                    <h1 id="lua-hooks">
  
  
    <a href="#lua-hooks" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Lua Hooks
  
  
</h1>
    

<p>lakeFS supports running hooks without relying on external components using an <a href="https://github.com/Shopify/go-lua">embedded Lua VM</a></p>

<p>Using Lua hooks, it is possible to pass a Lua script to be executed directly by the lakeFS server when an action occurs.</p>

<p>The Lua runtime embedded in lakeFS is limited for security reasons. It provides a narrow set of APIs and functions that by default do not allow:</p>

<ol>
  <li>Accessing any of the running lakeFS server’s environment</li>
  <li>Accessing the local filesystem available the lakeFS process</li>
</ol>

<div class="toc-block">
<h2 class="no_toc text-delta" id="table-of-contents">
  
  
    <a href="#table-of-contents" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Table of contents
  
  
</h2>
    

<ol id="markdown-toc">
  <li><a href="#action-file-lua-hook-properties" id="markdown-toc-action-file-lua-hook-properties">Action File Lua Hook Properties</a></li>
  <li><a href="#example-lua-hooks" id="markdown-toc-example-lua-hooks">Example Lua Hooks</a></li>
  <li><a href="#lua-library-reference" id="markdown-toc-lua-library-reference">Lua Library reference</a></li>
</ol>

</div>
<h2 id="action-file-lua-hook-properties">
  
  
    <a href="#action-file-lua-hook-properties" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Action File Lua Hook Properties
  
  
</h2>
    

<p><em>See the <a href="/v1.17/howto/hooks/#action-file">Action configuration</a> for overall configuration schema and details.</em></p>

<div class="table-wrapper"><table>
  <thead>
    <tr>
      <th>Property</th>
      <th>Description</th>
      <th>Data Type</th>
      <th>Required</th>
      <th>Default Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">args</code></td>
      <td>One or more arguments to pass to the hook</td>
      <td>Dictionary</td>
      <td>false</td>
      <td> </td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">script</code></td>
      <td>An inline Lua script</td>
      <td>String</td>
      <td>either this or <code class="language-plaintext highlighter-rouge">script_path</code> must be specified</td>
      <td> </td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">script_path</code></td>
      <td>The path in lakeFS to a Lua script</td>
      <td>String</td>
      <td>either this or <code class="language-plaintext highlighter-rouge">script</code> must be specified</td>
      <td> </td>
    </tr>
  </tbody>
</table></div>
<h2 id="example-lua-hooks">
  
  
    <a href="#example-lua-hooks" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Example Lua Hooks
  
  
</h2>
    

<p>For more examples and configuration samples, check out the <a href="https://github.com/treeverse/lakeFS/tree/master/examples/hooks">examples/hooks/</a> directory in the lakeFS repository. You’ll also find step-by-step examples of hooks in action in the <a href="https://github.com/treeverse/lakeFS-samples/">lakeFS samples repository</a>.</p>
<h3 id="display-information-about-an-event">
  
  
    <a href="#display-information-about-an-event" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Display information about an event
  
  
</h3>
    

<p>This example will print out a JSON representation of the event that occurred:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">name</span><span class="pi">:</span> <span class="s">dump_all</span>
<span class="na">on</span><span class="pi">:</span>
  <span class="na">post-commit</span><span class="pi">:</span>
  <span class="na">post-merge</span><span class="pi">:</span>
  <span class="na">post-create-tag</span><span class="pi">:</span>
  <span class="na">post-create-branch</span><span class="pi">:</span>
<span class="na">hooks</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">id</span><span class="pi">:</span> <span class="s">dump_event</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">lua</span>
    <span class="na">properties</span><span class="pi">:</span>
      <span class="na">script</span><span class="pi">:</span> <span class="pi">|</span>
        <span class="s">json = require("encoding/json")</span>
        <span class="s">print(json.marshal(action))</span>
</code></pre></div></div>
<h3 id="ensure-that-a-commit-includes-a-mandatory-metadata-field">
  
  
    <a href="#ensure-that-a-commit-includes-a-mandatory-metadata-field" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Ensure that a commit includes a mandatory metadata field
  
  
</h3>
    

<p>A more useful example: ensure every commit contains a required metadata field:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">name</span><span class="pi">:</span> <span class="s">pre commit metadata field check</span>
<span class="na">on</span><span class="pi">:</span>
<span class="na">pre-commit</span><span class="pi">:</span>
    <span class="na">branches</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">main</span>
    <span class="pi">-</span> <span class="s">dev</span>
<span class="na">hooks</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">id</span><span class="pi">:</span> <span class="s">ensure_commit_metadata</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">lua</span>
    <span class="na">properties</span><span class="pi">:</span>
      <span class="na">args</span><span class="pi">:</span>
        <span class="na">notebook_url</span><span class="pi">:</span> <span class="pi">{</span><span class="s2">"</span><span class="s">pattern"</span><span class="pi">:</span> <span class="s2">"</span><span class="s">my-jupyter.example.com/.*"</span><span class="pi">}</span>
        <span class="na">spark_version</span><span class="pi">:</span>  <span class="pi">{}</span>
      <span class="na">script_path</span><span class="pi">:</span> <span class="s">lua_hooks/ensure_metadata_field.lua</span>
</code></pre></div></div>

<p>Lua code at <code class="language-plaintext highlighter-rouge">lakefs://repo/main/lua_hooks/ensure_metadata_field.lua</code>:</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">regexp</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s2">"regexp"</span><span class="p">)</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">props</span> <span class="k">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="k">do</span>
  <span class="n">current_value</span> <span class="o">=</span> <span class="n">action</span><span class="p">.</span><span class="n">commit</span><span class="p">.</span><span class="n">metadata</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">current_value</span> <span class="o">==</span> <span class="kc">nil</span> <span class="k">then</span>
    <span class="nb">error</span><span class="p">(</span><span class="s2">"missing mandatory metadata field: "</span> <span class="o">..</span> <span class="n">k</span><span class="p">)</span>
  <span class="k">end</span>
  <span class="k">if</span> <span class="n">props</span><span class="p">.</span><span class="n">pattern</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">regexp</span><span class="p">.</span><span class="n">match</span><span class="p">(</span><span class="n">props</span><span class="p">.</span><span class="n">pattern</span><span class="p">,</span> <span class="n">current_value</span><span class="p">)</span> <span class="k">then</span>
    <span class="nb">error</span><span class="p">(</span><span class="s2">"current value for commit metadata field "</span> <span class="o">..</span> <span class="n">k</span> <span class="o">..</span> <span class="s2">" does not match pattern: "</span> <span class="o">..</span> <span class="n">props</span><span class="p">.</span><span class="n">pattern</span> <span class="o">..</span> <span class="s2">" - got: "</span> <span class="o">..</span> <span class="n">current_value</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>For more examples and configuration samples, check out the <a href="https://github.com/treeverse/lakeFS/tree/master/examples/hooks">examples/hooks/</a> directory in the lakeFS repository.</p>
<h2 id="lua-library-reference">
  
  
    <a href="#lua-library-reference" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Lua Library reference
  
  
</h2>
    

<p>The Lua runtime embedded in lakeFS is limited for security reasons. The provided APIs are shown below.</p>
<h3 id="arraytable">
  
  
    <a href="#arraytable" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">array(table)</code>
  
  
</h3>
    

<p>Helper function to mark a table object as an array for the runtime by setting <code class="language-plaintext highlighter-rouge">_is_array: true</code> metatable field.</p>
<h3 id="aws">
  
  
    <a href="#aws" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">aws</code>
  
  
</h3>
    
<h3 id="awss3_client">
  
  
    <a href="#awss3_client" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">aws/s3_client</code>
  
  
</h3>
    
<p>S3 client library.</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">local</span> <span class="n">aws</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s2">"aws"</span><span class="p">)</span>
<span class="c1">-- pass valid AWS credentials</span>
<span class="kd">local</span> <span class="n">client</span> <span class="o">=</span> <span class="n">aws</span><span class="p">.</span><span class="n">s3_client</span><span class="p">(</span><span class="s2">"ACCESS_KEY_ID"</span><span class="p">,</span> <span class="s2">"SECRET_ACCESS_KEY"</span><span class="p">,</span> <span class="s2">"REGION"</span><span class="p">)</span>
</code></pre></div></div>
<h3 id="awss3_clientget_objectbucket-key">
  
  
    <a href="#awss3_clientget_objectbucket-key" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">aws/s3_client.get_object(bucket, key)</code>
  
  
</h3>
    

<p>Returns the body (as a Lua string) of the requested object and a boolean value that is true if the requested object exists</p>
<h3 id="awss3_clientput_objectbucket-key-value">
  
  
    <a href="#awss3_clientput_objectbucket-key-value" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">aws/s3_client.put_object(bucket, key, value)</code>
  
  
</h3>
    

<p>Sets the object at the given bucket and key to the value of the supplied value string</p>
<h3 id="awss3_clientdelete_objectbucket--key">
  
  
    <a href="#awss3_clientdelete_objectbucket--key" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">aws/s3_client.delete_object(bucket [, key])</code>
  
  
</h3>
    

<p>Deletes the object at the given key</p>
<h3 id="awss3_clientlist_objectsbucket--prefix-continuation_token-delimiter">
  
  
    <a href="#awss3_clientlist_objectsbucket--prefix-continuation_token-delimiter" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">aws/s3_client.list_objects(bucket [, prefix, continuation_token, delimiter])</code>
  
  
</h3>
    

<p>Returns a table of results containing the following structure:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">is_truncated</code>: (boolean) whether there are more results to paginate through using the continuation token</li>
  <li><code class="language-plaintext highlighter-rouge">next_continuation_token</code>: (string) to pass in the next request to get the next page of results</li>
  <li><code class="language-plaintext highlighter-rouge">results</code> (table of tables) information about the objects (and prefixes if a delimiter is used)</li>
</ul>

<p>a result could in one of the following structures</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span>
   <span class="p">[</span><span class="s2">"key"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"a/common/prefix/"</span><span class="p">,</span>
   <span class="p">[</span><span class="s2">"type"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"prefix"</span>
<span class="p">}</span>
</code></pre></div></div>

<p>or:</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span>
   <span class="p">[</span><span class="s2">"key"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"path/to/object"</span><span class="p">,</span>
   <span class="p">[</span><span class="s2">"type"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"object"</span><span class="p">,</span>
   <span class="p">[</span><span class="s2">"etag"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"etagString"</span><span class="p">,</span>
   <span class="p">[</span><span class="s2">"size"</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1024</span><span class="p">,</span>
   <span class="p">[</span><span class="s2">"last_modified"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"2023-12-31T23:10:00Z"</span>
<span class="p">}</span>
</code></pre></div></div>
<h3 id="awss3_clientdelete_recursivebucket-prefix">
  
  
    <a href="#awss3_clientdelete_recursivebucket-prefix" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">aws/s3_client.delete_recursive(bucket, prefix)</code>
  
  
</h3>
    

<p>Deletes all objects under the given prefix</p>
<h3 id="awsglue">
  
  
    <a href="#awsglue" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">aws/glue</code>
  
  
</h3>
    

<p>Glue client library.</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">local</span> <span class="n">aws</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s2">"aws"</span><span class="p">)</span>
<span class="c1">-- pass valid AWS credentials</span>
<span class="kd">local</span> <span class="n">glue</span> <span class="o">=</span> <span class="n">aws</span><span class="p">.</span><span class="n">glue_client</span><span class="p">(</span><span class="s2">"ACCESS_KEY_ID"</span><span class="p">,</span> <span class="s2">"SECRET_ACCESS_KEY"</span><span class="p">,</span> <span class="s2">"REGION"</span><span class="p">)</span>
</code></pre></div></div>
<h3 id="awsglueget_tabledatabase-table--catalog_id">
  
  
    <a href="#awsglueget_tabledatabase-table--catalog_id" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">aws/glue.get_table(database, table [, catalog_id)</code>
  
  
</h3>
    

<p>Describe a table from the Glue catalog.</p>

<p>Example:</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">local</span> <span class="n">table</span><span class="p">,</span> <span class="n">exists</span> <span class="o">=</span> <span class="n">glue</span><span class="p">.</span><span class="n">get_table</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">table_name</span><span class="p">)</span>
<span class="k">if</span> <span class="n">exists</span> <span class="k">then</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="n">marshal</span><span class="p">(</span><span class="n">table</span><span class="p">))</span>
</code></pre></div></div>
<h3 id="awsgluecreate_tabledatabase-table_input--catalog_id">
  
  
    <a href="#awsgluecreate_tabledatabase-table_input--catalog_id" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">aws/glue.create_table(database, table_input, [, catalog_id])</code>
  
  
</h3>
    

<p>Create a new table in Glue Catalog.
The <code class="language-plaintext highlighter-rouge">table_input</code> argument is a JSON that is passed “as is” to AWS and is parallel to the AWS SDK <a href="https://docs.aws.amazon.com/glue/latest/webapi/API_CreateTable.html#API_CreateTable_RequestSyntax">TableInput</a></p>

<p>Example:</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">local</span> <span class="n">json</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s2">"encoding/json"</span><span class="p">)</span>
<span class="kd">local</span> <span class="n">input</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">Name</span> <span class="o">=</span> <span class="s2">"my-table"</span><span class="p">,</span>
    <span class="n">PartitionKeys</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">partitions</span><span class="p">),</span>
    <span class="c1">-- etc...</span>
<span class="p">}</span>
<span class="kd">local</span> <span class="n">json_input</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="n">marshal</span><span class="p">(</span><span class="n">input</span><span class="p">)</span>
<span class="n">glue</span><span class="p">.</span><span class="n">create_table</span><span class="p">(</span><span class="s2">"my-db"</span><span class="p">,</span> <span class="n">table_input</span><span class="p">)</span>
</code></pre></div></div>
<h3 id="awsglueupdate_tabledatabase-table_input--catalog_id-version_id-skip_archive">
  
  
    <a href="#awsglueupdate_tabledatabase-table_input--catalog_id-version_id-skip_archive" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">aws/glue.update_table(database, table_input, [, catalog_id, version_id, skip_archive])</code>
  
  
</h3>
    

<p>Update an existing Table in Glue Catalog.
The <code class="language-plaintext highlighter-rouge">table_input</code> is the same as the argument in <code class="language-plaintext highlighter-rouge">glue.create_table</code> function.</p>
<h3 id="awsgluedelete_tabledatabase-table_input--catalog_id">
  
  
    <a href="#awsgluedelete_tabledatabase-table_input--catalog_id" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">aws/glue.delete_table(database, table_input, [, catalog_id])</code>
  
  
</h3>
    

<p>Delete an existing Table in Glue Catalog.</p>
<h3 id="azure">
  
  
    <a href="#azure" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">azure</code>
  
  
</h3>
    
<h3 id="azureblob_client">
  
  
    <a href="#azureblob_client" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">azure/blob_client</code>
  
  
</h3>
    
<p>Azure blob client library.</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">local</span> <span class="n">azure</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s2">"azure"</span><span class="p">)</span>
<span class="c1">-- pass valid Azure credentials</span>
<span class="kd">local</span> <span class="n">client</span> <span class="o">=</span> <span class="n">azure</span><span class="p">.</span><span class="n">blob_client</span><span class="p">(</span><span class="s2">"AZURE_STORAGE_ACCOUNT"</span><span class="p">,</span> <span class="s2">"AZURE_ACCESS_KEY"</span><span class="p">)</span>
</code></pre></div></div>
<h3 id="azureblob_clientget_objectpath_uri">
  
  
    <a href="#azureblob_clientget_objectpath_uri" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">azure/blob_client.get_object(path_uri)</code>
  
  
</h3>
    

<p>Returns the body (as a Lua string) of the requested object and a boolean value that is true if the requested object exists<br />
<code class="language-plaintext highlighter-rouge">path_uri</code> - A valid Azure blob storage uri in the form of <code class="language-plaintext highlighter-rouge">https://myaccount.blob.core.windows.net/mycontainer/myblob</code></p>
<h3 id="azureblob_clientput_objectpath_uri-value">
  
  
    <a href="#azureblob_clientput_objectpath_uri-value" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">azure/blob_client.put_object(path_uri, value)</code>
  
  
</h3>
    

<p>Sets the object at the given bucket and key to the value of the supplied value string<br />
<code class="language-plaintext highlighter-rouge">path_uri</code> - A valid Azure blob storage uri in the form of <code class="language-plaintext highlighter-rouge">https://myaccount.blob.core.windows.net/mycontainer/myblob</code></p>
<h3 id="azureblob_clientdelete_objectpath_uri">
  
  
    <a href="#azureblob_clientdelete_objectpath_uri" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">azure/blob_client.delete_object(path_uri)</code>
  
  
</h3>
    

<p>Deletes the object at the given key<br />
<code class="language-plaintext highlighter-rouge">path_uri</code> - A valid Azure blob storage uri in the form of <code class="language-plaintext highlighter-rouge">https://myaccount.blob.core.windows.net/mycontainer/myblob</code></p>
<h3 id="azureabfss_transform_pathpath">
  
  
    <a href="#azureabfss_transform_pathpath" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">azure/abfss_transform_path(path)</code>
  
  
</h3>
    

<p>Transform an HTTPS Azure URL to a ABFSS scheme. Used by the delta_exporter function to support Azure Unity catalog use cases  <br />
<code class="language-plaintext highlighter-rouge">path</code> - A valid Azure blob storage URL in the form of <code class="language-plaintext highlighter-rouge">https://myaccount.blob.core.windows.net/mycontainer/myblob</code></p>
<h3 id="crypto">
  
  
    <a href="#crypto" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">crypto</code>
  
  
</h3>
    
<h3 id="cryptoaesencryptcbckey-plaintext">
  
  
    <a href="#cryptoaesencryptcbckey-plaintext" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">crypto/aes/encryptCBC(key, plaintext)</code>
  
  
</h3>
    

<p>Returns a ciphertext for the aes encrypted text</p>
<h3 id="cryptoaesdecryptcbckey-ciphertext">
  
  
    <a href="#cryptoaesdecryptcbckey-ciphertext" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">crypto/aes/decryptCBC(key, ciphertext)</code>
  
  
</h3>
    

<p>Returns the decrypted (plaintext) string for the encrypted ciphertext</p>
<h3 id="cryptohmacsign_sha256message-key">
  
  
    <a href="#cryptohmacsign_sha256message-key" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">crypto/hmac/sign_sha256(message, key)</code>
  
  
</h3>
    

<p>Returns a SHA256 hmac signature for the given message with the supplied key (using the SHA256 hashing algorithm)</p>
<h3 id="cryptohmacsign_sha1message-key">
  
  
    <a href="#cryptohmacsign_sha1message-key" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">crypto/hmac/sign_sha1(message, key)</code>
  
  
</h3>
    

<p>Returns a SHA1 hmac signature for the given message with the supplied key (using the SHA1 hashing algorithm)</p>
<h3 id="cryptomd5digestdata">
  
  
    <a href="#cryptomd5digestdata" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">crypto/md5/digest(data)</code>
  
  
</h3>
    

<p>Returns the MD5 digest (string) of the given data</p>
<h3 id="cryptosha256digestdata">
  
  
    <a href="#cryptosha256digestdata" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">crypto/sha256/digest(data)</code>
  
  
</h3>
    

<p>Returns the SHA256 digest (string) of the given data</p>
<h3 id="databricksclientdatabricks_host-databricks_service_principal_token">
  
  
    <a href="#databricksclientdatabricks_host-databricks_service_principal_token" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">databricks/client(databricks_host, databricks_service_principal_token)</code>
  
  
</h3>
    

<p>Returns a table representing a Databricks client with the <code class="language-plaintext highlighter-rouge">register_external_table</code> and <code class="language-plaintext highlighter-rouge">create_or_get_schema</code> methods.</p>
<h3 id="databricksclientcreate_schemaschema_name-catalog_name-get_if_exists">
  
  
    <a href="#databricksclientcreate_schemaschema_name-catalog_name-get_if_exists" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">databricks/client.create_schema(schema_name, catalog_name, get_if_exists)</code>
  
  
</h3>
    

<p>Creates a schema, or retrieves it if exists, in the configured Databricks host’s Unity catalog.
If a schema doesn’t exist, a new schema with the given <code class="language-plaintext highlighter-rouge">schema_name</code> will be created under the given <code class="language-plaintext highlighter-rouge">catalog_name</code>.
Returns the created/fetched schema name.</p>

<p>Parameters:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">schema_name(string)</code>: The required schema name</li>
  <li><code class="language-plaintext highlighter-rouge">catalog_name(string)</code>: The catalog name under which the schema will be created (or from which it will be fetched)</li>
  <li><code class="language-plaintext highlighter-rouge">get_if_exists(boolean)</code>: In case of failure due to an existing schema with the given <code class="language-plaintext highlighter-rouge">schema_name</code> in the given
<code class="language-plaintext highlighter-rouge">catalog_name</code>, return the schema.</li>
</ul>

<p>Example:</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">local</span> <span class="n">databricks</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s2">"databricks"</span><span class="p">)</span>
<span class="kd">local</span> <span class="n">client</span> <span class="o">=</span> <span class="n">databricks</span><span class="p">.</span><span class="n">client</span><span class="p">(</span><span class="s2">"https://my-host.cloud.databricks.com"</span><span class="p">,</span> <span class="s2">"my-service-principal-token"</span><span class="p">)</span>
<span class="kd">local</span> <span class="n">schema_name</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="n">create_schema</span><span class="p">(</span><span class="s2">"main"</span><span class="p">,</span> <span class="s2">"mycatalog"</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>
</code></pre></div></div>
<h3 id="databricksclientregister_external_tabletable_name-physical_path-warehouse_id-catalog_name-schema_name-metadata">
  
  
    <a href="#databricksclientregister_external_tabletable_name-physical_path-warehouse_id-catalog_name-schema_name-metadata" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">databricks/client.register_external_table(table_name, physical_path, warehouse_id, catalog_name, schema_name, metadata)</code>
  
  
</h3>
    

<p>Registers an external table under the provided warehouse ID, catalog name, and schema name.
In order for this method call to succeed, an external location should be configured in the catalog, with the 
<code class="language-plaintext highlighter-rouge">physical_path</code>’s root storage URI (for example: <code class="language-plaintext highlighter-rouge">s3://mybucket</code>).
Returns the table’s creation status.</p>

<p>Parameters:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">table_name(string)</code>: Table name.</li>
  <li><code class="language-plaintext highlighter-rouge">physical_path(string)</code>: A location to which the external table will refer, e.g. <code class="language-plaintext highlighter-rouge">s3://mybucket/the/path/to/mytable</code>.</li>
  <li><code class="language-plaintext highlighter-rouge">warehouse_id(string)</code>: The SQL warehouse ID used in Databricks to run the <code class="language-plaintext highlighter-rouge">CREATE TABLE</code> query (fetched from the SQL warehouse
<code class="language-plaintext highlighter-rouge">Connection Details</code>, or by running <code class="language-plaintext highlighter-rouge">databricks warehouses get</code>, choosing your SQL warehouse and fetching its ID).</li>
  <li><code class="language-plaintext highlighter-rouge">catalog_name(string)</code>: The name of the catalog under which a schema will be created (or fetched from).</li>
  <li><code class="language-plaintext highlighter-rouge">schema_name(string)</code>: The name of the schema under which the table will be created.</li>
  <li><code class="language-plaintext highlighter-rouge">metadata(table)</code>: A table of metadata to be added to the table’s registration. The metadata table should be of the form:
<code class="language-plaintext highlighter-rouge">{key1 = "value1", key2 = "value2", ...}</code>.</li>
</ul>

<p>Example:</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">local</span> <span class="n">databricks</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s2">"databricks"</span><span class="p">)</span>
<span class="kd">local</span> <span class="n">client</span> <span class="o">=</span> <span class="n">databricks</span><span class="p">.</span><span class="n">client</span><span class="p">(</span><span class="s2">"https://my-host.cloud.databricks.com"</span><span class="p">,</span> <span class="s2">"my-service-principal-token"</span><span class="p">)</span>
<span class="kd">local</span> <span class="n">status</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="n">register_external_table</span><span class="p">(</span><span class="s2">"mytable"</span><span class="p">,</span> <span class="s2">"s3://mybucket/the/path/to/mytable"</span><span class="p">,</span> <span class="s2">"examwarehouseple"</span><span class="p">,</span> <span class="s2">"my-catalog-name"</span><span class="p">,</span> <span class="s2">"myschema"</span><span class="p">)</span>
</code></pre></div></div>

<ul>
  <li>For the Databricks permissions needed to run this method, check out the <a href="/integrations/unity-catalog.html">Unity Catalog Exporter</a> docs.</li>
</ul>
<h3 id="encodingbase64encodedata">
  
  
    <a href="#encodingbase64encodedata" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">encoding/base64/encode(data)</code>
  
  
</h3>
    

<p>Encodes the given data to a base64 string</p>
<h3 id="encodingbase64decodedata">
  
  
    <a href="#encodingbase64decodedata" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">encoding/base64/decode(data)</code>
  
  
</h3>
    

<p>Decodes the given base64 encoded data and return it as a string</p>
<h3 id="encodingbase64url_encodedata">
  
  
    <a href="#encodingbase64url_encodedata" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">encoding/base64/url_encode(data)</code>
  
  
</h3>
    

<p>Encodes the given data to an unpadded alternate base64 encoding defined in RFC 4648.</p>
<h3 id="encodingbase64url_decodedata">
  
  
    <a href="#encodingbase64url_decodedata" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">encoding/base64/url_decode(data)</code>
  
  
</h3>
    

<p>Decodes the given unpadded alternate base64 encoding defined in RFC 4648 and return it as a string</p>
<h3 id="encodinghexencodevalue">
  
  
    <a href="#encodinghexencodevalue" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">encoding/hex/encode(value)</code>
  
  
</h3>
    

<p>Encode the given value string to hexadecimal values (string)</p>
<h3 id="encodinghexdecodevalue">
  
  
    <a href="#encodinghexdecodevalue" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">encoding/hex/decode(value)</code>
  
  
</h3>
    

<p>Decode the given hexadecimal string back to the string it represents (UTF-8)</p>
<h3 id="encodingjsonmarshaltable">
  
  
    <a href="#encodingjsonmarshaltable" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">encoding/json/marshal(table)</code>
  
  
</h3>
    

<p>Encodes the given table into a JSON string</p>
<h3 id="encodingjsonunmarshalstring">
  
  
    <a href="#encodingjsonunmarshalstring" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">encoding/json/unmarshal(string)</code>
  
  
</h3>
    

<p>Decodes the given string into the equivalent Lua structure</p>
<h3 id="encodingyamlmarshaltable">
  
  
    <a href="#encodingyamlmarshaltable" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">encoding/yaml/marshal(table)</code>
  
  
</h3>
    

<p>Encodes the given table into a YAML string</p>
<h3 id="encodingyamlunmarshalstring">
  
  
    <a href="#encodingyamlunmarshalstring" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">encoding/yaml/unmarshal(string)</code>
  
  
</h3>
    

<p>Decodes the given YAML encoded string into the equivalent Lua structure</p>
<h3 id="encodingparquetget_schemapayload">
  
  
    <a href="#encodingparquetget_schemapayload" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">encoding/parquet/get_schema(payload)</code>
  
  
</h3>
    

<p>Read the payload (string) as the contents of a Parquet file and return its schema in the following table structure:</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span>
  <span class="p">{</span> <span class="p">[</span><span class="s2">"name"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"column_a"</span><span class="p">,</span> <span class="p">[</span><span class="s2">"type"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"INT32"</span> <span class="p">},</span>
  <span class="p">{</span> <span class="p">[</span><span class="s2">"name"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"column_b"</span><span class="p">,</span> <span class="p">[</span><span class="s2">"type"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"BYTE_ARRAY"</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<h3 id="formats">
  
  
    <a href="#formats" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">formats</code>
  
  
</h3>
    
<h3 id="formatsdelta_clientkey-secret-region">
  
  
    <a href="#formatsdelta_clientkey-secret-region" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">formats/delta_client(key, secret, region)</code>
  
  
</h3>
    

<p>Creates a new Delta Lake client used to interact with the lakeFS server.</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">key</code>: lakeFS access key id</li>
  <li><code class="language-plaintext highlighter-rouge">secret</code>: lakeFS secret access key</li>
  <li><code class="language-plaintext highlighter-rouge">region</code>: The region in which your lakeFS server is configured at.</li>
</ul>
<h3 id="formatsdelta_clientget_tablerepository_id-reference_id-prefix">
  
  
    <a href="#formatsdelta_clientget_tablerepository_id-reference_id-prefix" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">formats/delta_client.get_table(repository_id, reference_id, prefix)</code>
  
  
</h3>
    

<p>Returns a representation of a Delta Lake table under the given repository, reference, and prefix.
The format of the response is two tables:</p>
<ol>
  <li>the first is a table of the format <code class="language-plaintext highlighter-rouge">{number, {string}}</code> where <code class="language-plaintext highlighter-rouge">number</code> is a version in the Delta Log, and the mapped <code class="language-plaintext highlighter-rouge">{string}</code> 
array contains JSON strings of the different Delta Lake log operations listed in the mapped version entry. e.g.:
    <div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span>
  <span class="mi">0</span> <span class="o">=</span> <span class="p">{</span>
 <span class="s2">"{\"</span><span class="n">commitInfo</span><span class="err">\</span><span class="s2">":...}"</span><span class="p">,</span>
 <span class="s2">"{\"</span><span class="n">add</span><span class="err">\</span><span class="s2">": ...}"</span><span class="p">,</span>
 <span class="s2">"{\"</span><span class="n">remove</span><span class="err">\</span><span class="s2">": ...}"</span>
  <span class="p">},</span>
  <span class="mi">1</span> <span class="o">=</span> <span class="p">{</span>
 <span class="s2">"{\"</span><span class="n">commitInfo</span><span class="err">\</span><span class="s2">":...}"</span><span class="p">,</span>
 <span class="s2">"{\"</span><span class="n">add</span><span class="err">\</span><span class="s2">": ...}"</span><span class="p">,</span>
 <span class="s2">"{\"</span><span class="n">remove</span><span class="err">\</span><span class="s2">": ...}"</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>the second is a table of the metadata of the current table snapshot. The metadata table can be used to initialize the Delta Lake table in an external Catalog.<br />
It consists of the following fields:
    <ul>
      <li><code class="language-plaintext highlighter-rouge">id</code>: The table’s ID</li>
      <li><code class="language-plaintext highlighter-rouge">name</code>: The table’s name</li>
      <li><code class="language-plaintext highlighter-rouge">description</code>: The table’s description</li>
      <li><code class="language-plaintext highlighter-rouge">schema_string</code>: The table’s schema string</li>
      <li><code class="language-plaintext highlighter-rouge">partition_columns</code>: The table’s partition columns</li>
      <li><code class="language-plaintext highlighter-rouge">configuration</code>: The table’s configuration</li>
      <li><code class="language-plaintext highlighter-rouge">created_time</code>: The table’s creation time</li>
    </ul>
  </li>
</ol>
<h3 id="gcloud">
  
  
    <a href="#gcloud" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">gcloud</code>
  
  
</h3>
    
<h3 id="gcloudgs_clientgcs_credentials_json_string">
  
  
    <a href="#gcloudgs_clientgcs_credentials_json_string" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">gcloud/gs_client(gcs_credentials_json_string)</code>
  
  
</h3>
    

<p>Create a new Google Cloud Storage client using a string that contains a valid <a href="https://developers.google.com/workspace/guides/create-credentials"><code class="language-plaintext highlighter-rouge">credentials.json</code></a> file content.</p>
<h3 id="gcloudgswrite_fuse_symlinksource-destination-mount_info">
  
  
    <a href="#gcloudgswrite_fuse_symlinksource-destination-mount_info" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">gcloud/gs.write_fuse_symlink(source, destination, mount_info)</code>
  
  
</h3>
    

<p>Will create a <a href="https://github.com/GoogleCloudPlatform/gcsfuse/blob/master/docs/semantics.md#symlink-inodes">gcsfuse symlink</a>
from the source (typically a lakeFS physical address for an object) to a given destination.</p>

<p><code class="language-plaintext highlighter-rouge">mount_info</code> is a Lua table with <code class="language-plaintext highlighter-rouge">"from"</code> and <code class="language-plaintext highlighter-rouge">"to"</code> keys - since symlinks don’t work for <code class="language-plaintext highlighter-rouge">gs://...</code> URIs, they need to point
to the mounted location instead. <code class="language-plaintext highlighter-rouge">from</code> will be removed from the beginning of <code class="language-plaintext highlighter-rouge">source</code>, and <code class="language-plaintext highlighter-rouge">destination</code> will be added instead.</p>

<p>Example:</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">source</span> <span class="o">=</span> <span class="s2">"gs://bucket/lakefs/data/abc/def"</span>
<span class="n">destination</span> <span class="o">=</span> <span class="s2">"gs://bucket/exported/path/to/object"</span>
<span class="n">mount_info</span> <span class="o">=</span> <span class="p">{</span>
    <span class="p">[</span><span class="s2">"from"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"gs://bucket"</span><span class="p">,</span>
    <span class="p">[</span><span class="s2">"to"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"/home/user/gcs-mount"</span>
<span class="p">}</span>
<span class="n">gs</span><span class="p">.</span><span class="n">write_fuse_symlink</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">destination</span><span class="p">,</span> <span class="n">mount_info</span><span class="p">)</span>
<span class="c1">-- Symlink: "/home/user/gcs-mount/exported/path/to/object" -&gt; "/home/user/gcs-mount/lakefs/data/abc/def"</span>
</code></pre></div></div>
<h3 id="lakefs">
  
  
    <a href="#lakefs" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">lakefs</code>
  
  
</h3>
    

<p>The Lua Hook library allows calling back to the lakeFS API using the identity of the user that triggered the action.
For example, if user A tries to commit and triggers a <code class="language-plaintext highlighter-rouge">pre-commit</code> hook - any call made inside that hook to the lakeFS
API, will automatically use user A’s identity for authorization and auditing purposes.</p>
<h3 id="lakefscreate_tagrepository_id-reference_id-tag_id">
  
  
    <a href="#lakefscreate_tagrepository_id-reference_id-tag_id" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">lakefs/create_tag(repository_id, reference_id, tag_id)</code>
  
  
</h3>
    

<p>Create a new tag for the given reference</p>
<h3 id="lakefsdiff_refsrepository_id-lef_reference_id-right_reference_id--after-prefix-delimiter-amount">
  
  
    <a href="#lakefsdiff_refsrepository_id-lef_reference_id-right_reference_id--after-prefix-delimiter-amount" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">lakefs/diff_refs(repository_id, lef_reference_id, right_reference_id [, after, prefix, delimiter, amount])</code>
  
  
</h3>
    

<p>Returns an object-wise diff between <code class="language-plaintext highlighter-rouge">left_reference_id</code> and <code class="language-plaintext highlighter-rouge">right_reference_id</code>.</p>
<h3 id="lakefslist_objectsrepository_id-reference_id--after-prefix-delimiter-amount">
  
  
    <a href="#lakefslist_objectsrepository_id-reference_id--after-prefix-delimiter-amount" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">lakefs/list_objects(repository_id, reference_id [, after, prefix, delimiter, amount])</code>
  
  
</h3>
    

<p>List objects in the specified repository and reference (branch, tag, commit ID, etc.).
If delimiter is empty, will default to a recursive listing. Otherwise, common prefixes up to <code class="language-plaintext highlighter-rouge">delimiter</code> will be shown as a single entry.</p>
<h3 id="lakefsget_objectrepository_id-reference_id-path">
  
  
    <a href="#lakefsget_objectrepository_id-reference_id-path" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">lakefs/get_object(repository_id, reference_id, path)</code>
  
  
</h3>
    

<p>Returns 2 values:</p>

<ol>
  <li>The HTTP status code returned by the lakeFS API</li>
  <li>The content of the specified object as a lua string</li>
</ol>
<h3 id="lakefsdiff_branchrepository_id-branch_id--after-amount-prefix-delimiter">
  
  
    <a href="#lakefsdiff_branchrepository_id-branch_id--after-amount-prefix-delimiter" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">lakefs/diff_branch(repository_id, branch_id [, after, amount, prefix, delimiter])</code>
  
  
</h3>
    

<p>Returns an object-wise diff of uncommitted changes on <code class="language-plaintext highlighter-rouge">branch_id</code>.</p>
<h3 id="lakefsstat_objectrepository_id-ref_id-path">
  
  
    <a href="#lakefsstat_objectrepository_id-ref_id-path" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">lakefs/stat_object(repository_id, ref_id, path)</code>
  
  
</h3>
    

<p>Returns a stat object for the given path under the given reference and repository.</p>
<h3 id="lakefscatalogexportglue_exporterget_full_table_namedescriptor-action_info">
  
  
    <a href="#lakefscatalogexportglue_exporterget_full_table_namedescriptor-action_info" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">lakefs/catalogexport/glue_exporter.get_full_table_name(descriptor, action_info)</code>
  
  
</h3>
    

<p>Generate glue table name.</p>

<p>Parameters:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">descriptor(Table)</code>: Object from (e.g. _lakefs_tables/my_table.yaml).</li>
  <li><code class="language-plaintext highlighter-rouge">action_info(Table)</code>: The global action object.</li>
</ul>
<h3 id="lakefscatalogexportdelta_exporter">
  
  
    <a href="#lakefscatalogexportdelta_exporter" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">lakefs/catalogexport/delta_exporter</code>
  
  
</h3>
    

<p>A package used to export Delta Lake tables from lakeFS to an external cloud storage.</p>
<h3 id="lakefscatalogexportdelta_exporterexport_delta_logaction-table_def_names-write_object-delta_client-table_descriptors_path-path_transformer">
  
  
    <a href="#lakefscatalogexportdelta_exporterexport_delta_logaction-table_def_names-write_object-delta_client-table_descriptors_path-path_transformer" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">lakefs/catalogexport/delta_exporter.export_delta_log(action, table_def_names, write_object, delta_client, table_descriptors_path, path_transformer)</code>
  
  
</h3>
    

<p>The function used to export Delta Lake tables.
The return value is a table with mapping of table names to external table location (from which it is possible to query the data) and latest Delta table version’s metadata.<br />
The response is of the form: 
<code class="language-plaintext highlighter-rouge">{&lt;table_name&gt; = {path = "s3://mybucket/mypath/mytable", metadata = {id = "table_id", name = "table_name", ...}}}</code>.</p>

<p>Parameters:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">action</code>: The global action object</li>
  <li><code class="language-plaintext highlighter-rouge">table_def_names</code>: Delta tables name list (e.g. <code class="language-plaintext highlighter-rouge">{"table1", "table2"}</code>)</li>
  <li><code class="language-plaintext highlighter-rouge">write_object</code>: A writer function with <code class="language-plaintext highlighter-rouge">function(bucket, key, data)</code> signature, used to write the exported Delta Log (e.g. <code class="language-plaintext highlighter-rouge">aws/s3_client.put_object</code> or <code class="language-plaintext highlighter-rouge">azure/blob_client.put_object</code>)</li>
  <li><code class="language-plaintext highlighter-rouge">delta_client</code>: A Delta Lake client that implements <code class="language-plaintext highlighter-rouge">get_table: function(repo, ref, prefix)</code></li>
  <li><code class="language-plaintext highlighter-rouge">table_descriptors_path</code>: The path under which the table descriptors of the provided <code class="language-plaintext highlighter-rouge">table_def_names</code> reside</li>
  <li><code class="language-plaintext highlighter-rouge">path_transformer</code>: (Optional) A function(path) used for transforming the path of the saved delta logs path fields as well as the saved table physical path (used to support Azure Unity catalog use cases)</li>
</ul>

<p>Delta export example for AWS S3:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">---</span>
<span class="na">name</span><span class="pi">:</span> <span class="s">delta_exporter</span>
<span class="na">on</span><span class="pi">:</span>
  <span class="na">post-commit</span><span class="pi">:</span> <span class="no">null</span>
<span class="na">hooks</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">id</span><span class="pi">:</span> <span class="s">delta_export</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">lua</span>
    <span class="na">properties</span><span class="pi">:</span>
      <span class="na">script</span><span class="pi">:</span> <span class="pi">|</span>
        <span class="s">local aws = require("aws")</span>
        <span class="s">local formats = require("formats")</span>
        <span class="s">local delta_exporter = require("lakefs/catalogexport/delta_exporter")</span>
        <span class="s">local json = require("encoding/json")</span>

        <span class="s">local table_descriptors_path = "_lakefs_tables"</span>
        <span class="s">local sc = aws.s3_client(args.aws.access_key_id, args.aws.secret_access_key, args.aws.region)</span>
        <span class="s">local delta_client = formats.delta_client(args.lakefs.access_key_id, args.lakefs.secret_access_key, args.aws.region)</span>
        <span class="s">local delta_table_details = delta_export.export_delta_log(action, args.table_defs, sc.put_object, delta_client, table_descriptors_path)</span>
        
        <span class="s">for t, details in pairs(delta_table_details) do</span>
          <span class="s">print("Delta Lake exported table \"" .. t .. "\"'s location: " .. details["path"] .. "\n")</span>
          <span class="s">print("Delta Lake exported table \"" .. t .. "\"'s metadata:\n")</span>
          <span class="s">for k, v in pairs(details["metadata"]) do</span>
            <span class="s">if type(v) == "table" then</span>
              <span class="s">print("\t" .. k .. " = " .. json.marshal(v) .. "\n")</span>
            <span class="s">else</span>
              <span class="s">print("\t" .. k .. " = " .. v .. "\n")</span>
            <span class="s">end</span>
          <span class="s">end</span>
        <span class="s">end</span>
      <span class="na">args</span><span class="pi">:</span>
        <span class="na">aws</span><span class="pi">:</span>
          <span class="na">access_key_id</span><span class="pi">:</span> <span class="s">&lt;AWS_ACCESS_KEY_ID&gt;</span>
          <span class="na">secret_access_key</span><span class="pi">:</span> <span class="s">&lt;AWS_SECRET_ACCESS_KEY&gt;</span>
          <span class="na">region</span><span class="pi">:</span> <span class="s">us-east-1</span>
        <span class="na">lakefs</span><span class="pi">:</span>
          <span class="na">access_key_id</span><span class="pi">:</span> <span class="s">&lt;LAKEFS_ACCESS_KEY_ID&gt;</span> 
          <span class="na">secret_access_key</span><span class="pi">:</span> <span class="s">&lt;LAKEFS_SECRET_ACCESS_KEY&gt;</span>
        <span class="na">table_defs</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="s">mytable</span>
</code></pre></div></div>

<p>For the table descriptor under the <code class="language-plaintext highlighter-rouge">_lakefs_tables/mytable.yaml</code>:</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">---</span>
<span class="na">name</span><span class="pi">:</span> <span class="s">myTableActualName</span>
<span class="na">type</span><span class="pi">:</span> <span class="s">delta</span>
<span class="na">path</span><span class="pi">:</span> <span class="s">a/path/to/my/delta/table</span>
</code></pre></div></div>

<p>Delta export example for Azure Blob Storage:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">name</span><span class="pi">:</span> <span class="s">Delta Exporter</span>
<span class="na">on</span><span class="pi">:</span>
  <span class="na">post-commit</span><span class="pi">:</span>
    <span class="na">branches</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">*"</span><span class="pi">]</span>
<span class="na">hooks</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">id</span><span class="pi">:</span> <span class="s">delta_exporter</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">lua</span>
    <span class="na">properties</span><span class="pi">:</span>
      <span class="na">script</span><span class="pi">:</span> <span class="pi">|</span>
        <span class="s">local azure = require("azure")</span>
        <span class="s">local formats = require("formats")</span>
        <span class="s">local delta_exporter = require("lakefs/catalogexport/delta_exporter")</span>

        <span class="s">local table_descriptors_path = "_lakefs_tables"</span>
        <span class="s">local sc = azure.blob_client(args.azure.storage_account, args.azure.access_key)</span>
        <span class="s">local function write_object(_, key, buf)</span>
          <span class="s">return sc.put_object(key,buf)</span>
        <span class="s">end</span>
        <span class="s">local delta_client = formats.delta_client(args.lakefs.access_key_id, args.lakefs.secret_access_key)</span>
        <span class="s">local delta_table_details = delta_export.export_delta_log(action, args.table_defs, sc.put_object, delta_client, table_descriptors_path)</span>
        
        <span class="s">for t, details in pairs(delta_table_details) do</span>
          <span class="s">print("Delta Lake exported table \"" .. t .. "\"'s location: " .. details["path"] .. "\n")</span>
          <span class="s">print("Delta Lake exported table \"" .. t .. "\"'s metadata:\n")</span>
          <span class="s">for k, v in pairs(details["metadata"]) do</span>
            <span class="s">if type(v) == "table" then</span>
              <span class="s">print("\t" .. k .. " = " .. json.marshal(v) .. "\n")</span>
            <span class="s">else</span>
              <span class="s">print("\t" .. k .. " = " .. v .. "\n")</span>
            <span class="s">end</span>
          <span class="s">end</span>
        <span class="s">end</span>
      <span class="na">args</span><span class="pi">:</span>
        <span class="na">azure</span><span class="pi">:</span>
          <span class="na">storage_account</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
          <span class="na">access_key</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
        <span class="na">lakefs</span><span class="pi">:</span> <span class="c1"># provide credentials of a user that has access to the script and Delta Table</span>
          <span class="na">access_key_id</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
          <span class="na">secret_access_key</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
        <span class="na">table_defs</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="s">mytable</span>

</code></pre></div></div>
<h3 id="lakefscatalogexporttable_extractor">
  
  
    <a href="#lakefscatalogexporttable_extractor" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">lakefs/catalogexport/table_extractor</code>
  
  
</h3>
    

<p>Utility package to parse <code class="language-plaintext highlighter-rouge">_lakefs_tables/</code> descriptors.</p>
<h3 id="lakefscatalogexporttable_extractorlist_table_descriptor_entriesclient-repo_id-commit_id">
  
  
    <a href="#lakefscatalogexporttable_extractorlist_table_descriptor_entriesclient-repo_id-commit_id" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">lakefs/catalogexport/table_extractor.list_table_descriptor_entries(client, repo_id, commit_id)</code>
  
  
</h3>
    

<p>List all YAML files under <code class="language-plaintext highlighter-rouge">_lakefs_tables/*</code> and return a list of type <code class="language-plaintext highlighter-rouge">[{physical_address, path}]</code>, ignores hidden files. 
The <code class="language-plaintext highlighter-rouge">client</code> is <code class="language-plaintext highlighter-rouge">lakefs</code> client.</p>
<h3 id="lakefscatalogexporttable_extractorget_table_descriptorclient-repo_id-commit_id-logical_path">
  
  
    <a href="#lakefscatalogexporttable_extractorget_table_descriptorclient-repo_id-commit_id-logical_path" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">lakefs/catalogexport/table_extractor.get_table_descriptor(client, repo_id, commit_id, logical_path)</code>
  
  
</h3>
    

<p>Read a table descriptor and parse YAML object. Will set <code class="language-plaintext highlighter-rouge">partition_columns</code> to <code class="language-plaintext highlighter-rouge">{}</code> if no partitions are defined.
The <code class="language-plaintext highlighter-rouge">client</code> is <code class="language-plaintext highlighter-rouge">lakefs</code> client.</p>
<h3 id="lakefscatalogexporthiveextract_partition_pagerclient-repo_id-commit_id-base_path-partition_cols-page_size">
  
  
    <a href="#lakefscatalogexporthiveextract_partition_pagerclient-repo_id-commit_id-base_path-partition_cols-page_size" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">lakefs/catalogexport/hive.extract_partition_pager(client, repo_id, commit_id, base_path, partition_cols, page_size)</code>
  
  
</h3>
    

<p>Hive format partition iterator each result set is a collection of files under the same partition in lakeFS.</p>

<p>Example:</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">local</span> <span class="n">lakefs</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s2">"lakefs"</span><span class="p">)</span>
<span class="kd">local</span> <span class="n">pager</span> <span class="o">=</span> <span class="n">hive</span><span class="p">.</span><span class="n">extract_partition_pager</span><span class="p">(</span><span class="n">lakefs</span><span class="p">,</span> <span class="n">repo_id</span><span class="p">,</span> <span class="n">commit_id</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">partitions</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="k">for</span> <span class="n">part_key</span><span class="p">,</span> <span class="n">entries</span> <span class="k">in</span> <span class="n">pager</span> <span class="k">do</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"partition: "</span> <span class="o">..</span> <span class="n">part_key</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">entry</span> <span class="k">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">entries</span><span class="p">)</span> <span class="k">do</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"path: "</span> <span class="o">..</span> <span class="n">entry</span><span class="p">.</span><span class="n">path</span> <span class="o">..</span> <span class="s2">" physical: "</span> <span class="o">..</span> <span class="n">entry</span><span class="p">.</span><span class="n">physical_address</span><span class="p">)</span>
    <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>
<h3 id="lakefscatalogexportsymlink_exporter">
  
  
    <a href="#lakefscatalogexportsymlink_exporter" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">lakefs/catalogexport/symlink_exporter</code>
  
  
</h3>
    

<p>Writes metadata for a table using Hive’s <a href="https://svn.apache.org/repos/infra/websites/production/hive/content/javadocs/r2.1.1/api/org/apache/hadoop/hive/ql/io/SymlinkTextInputFormat.html">SymlinkTextInputFormat</a>.
Currently only <code class="language-plaintext highlighter-rouge">S3</code> is supported.</p>

<p>The default export paths per commit:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>${storageNamespace}
_lakefs/
    exported/
        ${ref}/
            ${commitId}/
                ${tableName}/
                    p1=v1/symlink.txt
                    p1=v2/symlink.txt
                    p1=v3/symlink.txt
                    ...
</code></pre></div></div>
<h3 id="lakefscatalogexportsymlink_exporterexport_s3s3_client-table_src_path-action_info--options">
  
  
    <a href="#lakefscatalogexportsymlink_exporterexport_s3s3_client-table_src_path-action_info--options" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">lakefs/catalogexport/symlink_exporter.export_s3(s3_client, table_src_path, action_info [, options])</code>
  
  
</h3>
    

<p>Export Symlink files that represent a table to S3 location.</p>

<p>Parameters:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">s3_client</code>: Configured client.</li>
  <li><code class="language-plaintext highlighter-rouge">table_src_path(string)</code>: Path to the table spec YAML file in <code class="language-plaintext highlighter-rouge">_lakefs_tables</code> (e.g. _lakefs_tables/my_table.yaml).</li>
  <li><code class="language-plaintext highlighter-rouge">action_info(table)</code>: The global action object.</li>
  <li><code class="language-plaintext highlighter-rouge">options(table)</code>:
    <ul>
      <li><code class="language-plaintext highlighter-rouge">debug(boolean)</code>: Print extra info.</li>
      <li><code class="language-plaintext highlighter-rouge">export_base_uri(string)</code>: Override the prefix in S3 e.g. <code class="language-plaintext highlighter-rouge">s3://other-bucket/path/</code>.</li>
      <li><code class="language-plaintext highlighter-rouge">writer(function(bucket, key, data))</code>: If passed then will not use s3 client, helpful for debug.</li>
    </ul>
  </li>
</ul>

<p>Example:</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">local</span> <span class="n">exporter</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s2">"lakefs/catalogexport/symlink_exporter"</span><span class="p">)</span>
<span class="kd">local</span> <span class="n">aws</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s2">"aws"</span><span class="p">)</span>
<span class="c1">-- args are user inputs from a lakeFS action.</span>
<span class="kd">local</span> <span class="n">s3</span> <span class="o">=</span> <span class="n">aws</span><span class="p">.</span><span class="n">s3_client</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">aws</span><span class="p">.</span><span class="n">aws_access_key_id</span><span class="p">,</span> <span class="n">args</span><span class="p">.</span><span class="n">aws</span><span class="p">.</span><span class="n">aws_secret_access_key</span><span class="p">,</span> <span class="n">args</span><span class="p">.</span><span class="n">aws</span><span class="p">.</span><span class="n">aws_region</span><span class="p">)</span>
<span class="n">exporter</span><span class="p">.</span><span class="n">export_s3</span><span class="p">(</span><span class="n">s3</span><span class="p">,</span> <span class="n">args</span><span class="p">.</span><span class="n">table_descriptor_path</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="p">{</span><span class="n">debug</span><span class="o">=</span><span class="kc">true</span><span class="p">})</span>
</code></pre></div></div>
<h3 id="lakefscatalogexportglue_exporter">
  
  
    <a href="#lakefscatalogexportglue_exporter" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">lakefs/catalogexport/glue_exporter</code>
  
  
</h3>
    

<p>A Package for automating the export process from lakeFS stored tables into Glue catalog.</p>
<h3 id="lakefscatalogexportglue_exporterexport_glueglue-db-table_src_path-create_table_input-action_info-options">
  
  
    <a href="#lakefscatalogexportglue_exporterexport_glueglue-db-table_src_path-create_table_input-action_info-options" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">lakefs/catalogexport/glue_exporter.export_glue(glue, db, table_src_path, create_table_input, action_info, options)</code>
  
  
</h3>
    

<p>Represent lakeFS table in Glue Catalog. 
This function will create a table in Glue based on configuration. 
It assumes that there is a symlink location that is already created and only configures it by default for the same commit.</p>

<p>Parameters:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">glue</code>: AWS glue client</li>
  <li><code class="language-plaintext highlighter-rouge">db(string)</code>: glue database name</li>
  <li><code class="language-plaintext highlighter-rouge">table_src_path(string)</code>: path to table spec (e.g. _lakefs_tables/my_table.yaml)</li>
  <li><code class="language-plaintext highlighter-rouge">create_table_input(Table)</code>: Input equal mapping to <a href="https://docs.aws.amazon.com/glue/latest/webapi/API_CreateTable.html#API_CreateTable_RequestSyntax">table_input</a> in AWS, the same as we use for <code class="language-plaintext highlighter-rouge">glue.create_table</code>.
should contain inputs describing the data format (e.g. InputFormat, OutputFormat, SerdeInfo) since the exporter is agnostic to this. 
by default this function will configure table location and schema.</li>
  <li><code class="language-plaintext highlighter-rouge">action_info(Table)</code>: the global action object.</li>
  <li><code class="language-plaintext highlighter-rouge">options(Table)</code>:
    <ul>
      <li><code class="language-plaintext highlighter-rouge">table_name(string)</code>: Override default glue table name</li>
      <li><code class="language-plaintext highlighter-rouge">debug(boolean</code></li>
      <li><code class="language-plaintext highlighter-rouge">export_base_uri(string)</code>: Override the default prefix in S3 for symlink location e.g. s3://other-bucket/path/</li>
    </ul>
  </li>
</ul>

<p>When creating a glue table, the final table input will consist of the <code class="language-plaintext highlighter-rouge">create_table_input</code> input parameter and lakeFS computed defaults that will override it:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">Name</code> Gable table name <code class="language-plaintext highlighter-rouge">get_full_table_name(descriptor, action_info)</code>.</li>
  <li><code class="language-plaintext highlighter-rouge">PartitionKeys</code> Partition columns usually deduced from <code class="language-plaintext highlighter-rouge">_lakefs_tables/${table_src_path}</code>.</li>
  <li><code class="language-plaintext highlighter-rouge">TableType</code> = “EXTERNAL_TABLE”</li>
  <li><code class="language-plaintext highlighter-rouge">StorageDescriptor</code>: Columns usually deduced from <code class="language-plaintext highlighter-rouge">_lakefs_tables/${table_src_path}</code>.</li>
  <li><code class="language-plaintext highlighter-rouge">StorageDescriptor.Location</code> = symlink_location</li>
</ul>

<p>Example:</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">local</span> <span class="n">aws</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s2">"aws"</span><span class="p">)</span>
<span class="kd">local</span> <span class="n">exporter</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s2">"lakefs/catalogexport/glue_exporter"</span><span class="p">)</span>
<span class="kd">local</span> <span class="n">glue</span> <span class="o">=</span> <span class="n">aws</span><span class="p">.</span><span class="n">glue_client</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">aws_access_key_id</span><span class="p">,</span> <span class="n">args</span><span class="p">.</span><span class="n">aws_secret_access_key</span><span class="p">,</span> <span class="n">args</span><span class="p">.</span><span class="n">aws_region</span><span class="p">)</span>
<span class="c1">-- table_input can be passed as a simple Key-Value object in YAML as an argument from an action, this is inline example:</span>
<span class="kd">local</span> <span class="n">table_input</span> <span class="o">=</span> <span class="p">{</span>
  <span class="n">StorageDescriptor</span><span class="p">:</span> 
    <span class="n">InputFormat</span><span class="p">:</span> <span class="s2">"org.apache.hadoop.hive.ql.io.SymlinkTextInputFormat"</span>
    <span class="n">OutputFormat</span><span class="p">:</span> <span class="s2">"org.apache.hadoop.hive.ql.io.IgnoreKeyTextOutputFormat"</span>
    <span class="n">SerdeInfo</span><span class="p">:</span>
      <span class="n">SerializationLibrary</span><span class="p">:</span> <span class="s2">"org.apache.hadoop.hive.ql.io.parquet.serde.ParquetHiveSerDe"</span>
  <span class="n">Parameters</span><span class="p">:</span> 
    <span class="n">classification</span><span class="p">:</span> <span class="s2">"parquet"</span>
    <span class="n">EXTERNAL</span><span class="p">:</span> <span class="s2">"TRUE"</span>
    <span class="s2">"parquet.compression"</span><span class="p">:</span> <span class="s2">"SNAPPY"</span>
<span class="p">}</span>
<span class="n">exporter</span><span class="p">.</span><span class="n">export_glue</span><span class="p">(</span><span class="n">glue</span><span class="p">,</span> <span class="s2">"my-db"</span><span class="p">,</span> <span class="s2">"_lakefs_tables/animals.yaml"</span><span class="p">,</span> <span class="n">table_input</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="p">{</span><span class="n">debug</span><span class="o">=</span><span class="kc">true</span><span class="p">})</span>
</code></pre></div></div>
<h3 id="lakefscatalogexportglue_exporterget_full_table_namedescriptor-action_info-1">
  
  
    <a href="#lakefscatalogexportglue_exporterget_full_table_namedescriptor-action_info-1" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">lakefs/catalogexport/glue_exporter.get_full_table_name(descriptor, action_info)</code>
  
  
</h3>
    

<p>Generate glue table name.</p>

<p>Parameters:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">descriptor(Table)</code>: Object from (e.g. _lakefs_tables/my_table.yaml).</li>
  <li><code class="language-plaintext highlighter-rouge">action_info(Table)</code>: The global action object.</li>
</ul>
<h3 id="lakefscatalogexportunity_exporter">
  
  
    <a href="#lakefscatalogexportunity_exporter" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">lakefs/catalogexport/unity_exporter</code>
  
  
</h3>
    

<p>A package used to register exported Delta Lake tables to Databricks’ Unity catalog.</p>
<h3 id="lakefscatalogexportunity_exporterregister_tablesaction-table_descriptors_path-delta_table_details-databricks_client-warehouse_id">
  
  
    <a href="#lakefscatalogexportunity_exporterregister_tablesaction-table_descriptors_path-delta_table_details-databricks_client-warehouse_id" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">lakefs/catalogexport/unity_exporter.register_tables(action, table_descriptors_path, delta_table_details, databricks_client, warehouse_id)</code>
  
  
</h3>
    

<p>The function used to register exported Delta Lake tables in Databricks’ Unity Catalog.
The registration will use the following paths to register the table:
<code class="language-plaintext highlighter-rouge">&lt;catalog&gt;.&lt;branch name&gt;.&lt;table_name&gt;</code> where the branch name will be used as the schema name.
The return value is a table with mapping of table names to registration request status.</p>

<p><strong>Note: (Azure users)</strong> Databricks catalog external locations is supported only for ADLS Gen2 storage accounts.<br />
When exporting Delta tables using the <code class="language-plaintext highlighter-rouge">lakefs/catalogexport/delta_exporter.export_delta_log</code> function, the <code class="language-plaintext highlighter-rouge">path_transformer</code> must be<br />
used to convert the paths scheme to <code class="language-plaintext highlighter-rouge">abfss</code>. The built-in <code class="language-plaintext highlighter-rouge">azure</code> lua library provides this functionality with <code class="language-plaintext highlighter-rouge">transformPathToAbfss</code>.</p>

<p>Parameters:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">action(table)</code>: The global action table</li>
  <li><code class="language-plaintext highlighter-rouge">table_descriptors_path(string)</code>: The path under which the table descriptors of the provided <code class="language-plaintext highlighter-rouge">table_paths</code> reside.</li>
  <li><code class="language-plaintext highlighter-rouge">delta_table_details(table)</code>: Table names to physical paths mapping and table metadata (e.g. <code class="language-plaintext highlighter-rouge">{table1 = {path = "s3://mybucket/mytable1", metadata = {id = "table_1_id", name = "table1", ...}}, table2 = {path = "s3://mybucket/mytable2", metadata = {id = "table_2_id", name = "table2", ...}}}</code>.)</li>
  <li><code class="language-plaintext highlighter-rouge">databricks_client(table)</code>: A Databricks client that implements <code class="language-plaintext highlighter-rouge">create_or_get_schema: function(id, catalog_name)</code> and <code class="language-plaintext highlighter-rouge">register_external_table: function(table_name, physical_path, warehouse_id, catalog_name, schema_name)</code></li>
  <li><code class="language-plaintext highlighter-rouge">warehouse_id(string)</code>: Databricks warehouse ID.</li>
</ul>

<p>Example:
The following registers an exported Delta Lake table to Unity Catalog.</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">local</span> <span class="n">databricks</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s2">"databricks"</span><span class="p">)</span>
<span class="kd">local</span> <span class="n">unity_export</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s2">"lakefs/catalogexport/unity_exporter"</span><span class="p">)</span>

<span class="kd">local</span> <span class="n">delta_table_locations</span> <span class="o">=</span> <span class="p">{</span>
  <span class="p">[</span><span class="s2">"table1"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"s3://mybucket/mytable1"</span><span class="p">,</span>
<span class="p">}</span>
<span class="c1">-- Register the exported table in Unity Catalog:</span>
<span class="kd">local</span> <span class="n">action_details</span> <span class="o">=</span> <span class="p">{</span>
  <span class="n">repository_id</span> <span class="o">=</span> <span class="s2">"my-repo"</span><span class="p">,</span>
  <span class="n">commit_id</span> <span class="o">=</span> <span class="s2">"commit_id"</span><span class="p">,</span>
  <span class="n">branch_id</span> <span class="o">=</span> <span class="s2">"main"</span><span class="p">,</span>
<span class="p">}</span>
<span class="kd">local</span> <span class="n">databricks_client</span> <span class="o">=</span> <span class="n">databricks</span><span class="p">.</span><span class="n">client</span><span class="p">(</span><span class="s2">"&lt;DATABRICKS_HOST&gt;"</span><span class="p">,</span> <span class="s2">"&lt;DATABRICKS_TOKEN&gt;"</span><span class="p">)</span>
<span class="kd">local</span> <span class="n">registration_statuses</span> <span class="o">=</span> <span class="n">unity_export</span><span class="p">.</span><span class="n">register_tables</span><span class="p">(</span><span class="n">action_details</span><span class="p">,</span> <span class="s2">"_lakefs_tables"</span><span class="p">,</span> <span class="n">delta_table_locations</span><span class="p">,</span> <span class="n">databricks_client</span><span class="p">,</span> <span class="s2">"&lt;WAREHOUSE_ID&gt;"</span><span class="p">)</span>

<span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">status</span> <span class="k">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">registration_statuses</span><span class="p">)</span> <span class="k">do</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">"Unity catalog registration for table \"" .. t .. "</span><span class="err">\</span><span class="s2">" completed with status: "</span> <span class="o">..</span> <span class="n">status</span> <span class="o">..</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div></div>

<p>For the table descriptor under the <code class="language-plaintext highlighter-rouge">_lakefs_tables/delta-table-descriptor.yaml</code>:</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">---</span>
<span class="na">name</span><span class="pi">:</span> <span class="s">my_table_name</span>
<span class="na">type</span><span class="pi">:</span> <span class="s">delta</span>
<span class="na">path</span><span class="pi">:</span> <span class="s">path/to/delta/table/data</span>
<span class="na">catalog</span><span class="pi">:</span> <span class="s">my-catalog</span>
</code></pre></div></div>

<p>For detailed step-by-step guide on how to use <code class="language-plaintext highlighter-rouge">unity_exporter.register_tables</code> as a part of a lakeFS action refer to
the <a href="/integrations/unity-catalog.html">Unity Catalog docs</a>.</p>
<h3 id="pathparsepath_string">
  
  
    <a href="#pathparsepath_string" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">path/parse(path_string)</code>
  
  
</h3>
    

<p>Returns a table for the given path string with the following structure:</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> <span class="nb">require</span><span class="p">(</span><span class="s2">"path"</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="n">path</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="s2">"a/b/c.csv"</span><span class="p">)</span>
<span class="p">{</span>
    <span class="p">[</span><span class="s2">"parent"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"a/b/"</span>
    <span class="p">[</span><span class="s2">"base_name"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"c.csv"</span>
<span class="p">}</span> 
</code></pre></div></div>
<h3 id="pathjoinpath_parts">
  
  
    <a href="#pathjoinpath_parts" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">path/join(*path_parts)</code>
  
  
</h3>
    

<p>Receives a variable number of strings and returns a joined string that represents a path:</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> <span class="nb">require</span><span class="p">(</span><span class="s2">"path"</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="s2">"path/"</span><span class="p">,</span> <span class="s2">"to"</span><span class="p">,</span> <span class="s2">"a"</span><span class="p">,</span> <span class="s2">"file.data"</span><span class="p">)</span>
<span class="n">path</span><span class="o">/</span><span class="n">o</span><span class="o">/</span><span class="n">a</span><span class="o">/</span><span class="n">file</span><span class="p">.</span><span class="n">data</span>
</code></pre></div></div>
<h3 id="pathis_hiddenpath_string--seperator-prefix">
  
  
    <a href="#pathis_hiddenpath_string--seperator-prefix" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">path/is_hidden(path_string [, seperator, prefix])</code>
  
  
</h3>
    

<p>returns a boolean - <code class="language-plaintext highlighter-rouge">true</code> if the given path string is hidden (meaning it starts with <code class="language-plaintext highlighter-rouge">prefix</code>) - or if any of its parents start with <code class="language-plaintext highlighter-rouge">prefix</code>.</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> <span class="nb">require</span><span class="p">(</span><span class="s2">"path"</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="n">path</span><span class="p">.</span><span class="n">is_hidden</span><span class="p">(</span><span class="s2">"a/b/c"</span><span class="p">)</span> <span class="c1">-- false</span>
<span class="o">&gt;</span> <span class="n">path</span><span class="p">.</span><span class="n">is_hidden</span><span class="p">(</span><span class="s2">"a/b/_c"</span><span class="p">)</span> <span class="c1">-- true</span>
<span class="o">&gt;</span> <span class="n">path</span><span class="p">.</span><span class="n">is_hidden</span><span class="p">(</span><span class="s2">"a/_b/c"</span><span class="p">)</span> <span class="c1">-- true</span>
<span class="o">&gt;</span> <span class="n">path</span><span class="p">.</span><span class="n">is_hidden</span><span class="p">(</span><span class="s2">"a/b/_c/"</span><span class="p">)</span> <span class="c1">-- true</span>
</code></pre></div></div>
<h3 id="pathdefault_separator">
  
  
    <a href="#pathdefault_separator" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">path/default_separator()</code>
  
  
</h3>
    

<p>Returns a constant string (<code class="language-plaintext highlighter-rouge">/</code>)</p>
<h3 id="regexpmatchpattern-s">
  
  
    <a href="#regexpmatchpattern-s" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">regexp/match(pattern, s)</code>
  
  
</h3>
    

<p>Returns true if the string <code class="language-plaintext highlighter-rouge">s</code> matches <code class="language-plaintext highlighter-rouge">pattern</code>.
This is a thin wrapper over Go’s <a href="https://pkg.go.dev/regexp#MatchString" target="_blank">regexp.MatchString</a>.</p>
<h3 id="regexpquote_metas">
  
  
    <a href="#regexpquote_metas" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">regexp/quote_meta(s)</code>
  
  
</h3>
    

<p>Escapes any meta-characters in string <code class="language-plaintext highlighter-rouge">s</code> and returns a new string</p>
<h3 id="regexpcompilepattern">
  
  
    <a href="#regexpcompilepattern" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">regexp/compile(pattern)</code>
  
  
</h3>
    

<p>Returns a regexp match object for the given pattern</p>
<h3 id="regexpcompiled_patternfind_alls-n">
  
  
    <a href="#regexpcompiled_patternfind_alls-n" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">regexp/compiled_pattern.find_all(s, n)</code>
  
  
</h3>
    

<p>Returns a table list of all matches for the pattern, (up to <code class="language-plaintext highlighter-rouge">n</code> matches, unless <code class="language-plaintext highlighter-rouge">n == -1</code> in which case all possible matches will be returned)</p>
<h3 id="regexpcompiled_patternfind_all_submatchs-n">
  
  
    <a href="#regexpcompiled_patternfind_all_submatchs-n" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">regexp/compiled_pattern.find_all_submatch(s, n)</code>
  
  
</h3>
    

<p>Returns a table list of all sub-matches for the pattern, (up to <code class="language-plaintext highlighter-rouge">n</code> matches, unless <code class="language-plaintext highlighter-rouge">n == -1</code> in which case all possible matches will be returned).
Submatches are matches of parenthesized subexpressions (also known as capturing groups) within the regular expression,
numbered from left to right in order of opening parenthesis.
Submatch 0 is the match of the entire expression, submatch 1 is the match of the first parenthesized subexpression, and so on</p>
<h3 id="regexpcompiled_patternfinds">
  
  
    <a href="#regexpcompiled_patternfinds" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">regexp/compiled_pattern.find(s)</code>
  
  
</h3>
    

<p>Returns a string representing the left-most match for the given pattern in string <code class="language-plaintext highlighter-rouge">s</code></p>
<h3 id="regexpcompiled_patternfind_submatchs">
  
  
    <a href="#regexpcompiled_patternfind_submatchs" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">regexp/compiled_pattern.find_submatch(s)</code>
  
  
</h3>
    

<p>find_submatch returns a table of strings holding the text of the leftmost match of the regular expression in <code class="language-plaintext highlighter-rouge">s</code> and the matches, if any, of its submatches</p>
<h3 id="stringssplits-sep">
  
  
    <a href="#stringssplits-sep" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">strings/split(s, sep)</code>
  
  
</h3>
    

<p>returns a table of strings, the result of splitting <code class="language-plaintext highlighter-rouge">s</code> with <code class="language-plaintext highlighter-rouge">sep</code>.</p>
<h3 id="stringstrims">
  
  
    <a href="#stringstrims" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">strings/trim(s)</code>
  
  
</h3>
    

<p>Returns a string with all leading and trailing white space removed, as defined by Unicode</p>
<h3 id="stringsreplaces-old-new-n">
  
  
    <a href="#stringsreplaces-old-new-n" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">strings/replace(s, old, new, n)</code>
  
  
</h3>
    

<p>Returns a copy of the string s with the first n non-overlapping instances of <code class="language-plaintext highlighter-rouge">old</code> replaced by <code class="language-plaintext highlighter-rouge">new</code>.
If <code class="language-plaintext highlighter-rouge">old</code> is empty, it matches at the beginning of the string and after each UTF-8 sequence, yielding up to k+1 replacements for a k-rune string.</p>

<p>If n &lt; 0, there is no limit on the number of replacements</p>
<h3 id="stringshas_prefixs-prefix">
  
  
    <a href="#stringshas_prefixs-prefix" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">strings/has_prefix(s, prefix)</code>
  
  
</h3>
    

<p>Returns <code class="language-plaintext highlighter-rouge">true</code> if <code class="language-plaintext highlighter-rouge">s</code> begins with <code class="language-plaintext highlighter-rouge">prefix</code></p>
<h3 id="stringshas_suffixs-suffix">
  
  
    <a href="#stringshas_suffixs-suffix" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">strings/has_suffix(s, suffix)</code>
  
  
</h3>
    

<p>Returns <code class="language-plaintext highlighter-rouge">true</code> if <code class="language-plaintext highlighter-rouge">s</code> ends with <code class="language-plaintext highlighter-rouge">suffix</code></p>
<h3 id="stringscontainss-substr">
  
  
    <a href="#stringscontainss-substr" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">strings/contains(s, substr)</code>
  
  
</h3>
    

<p>Returns <code class="language-plaintext highlighter-rouge">true</code> if <code class="language-plaintext highlighter-rouge">substr</code> is contained anywhere in <code class="language-plaintext highlighter-rouge">s</code></p>
<h3 id="timenow">
  
  
    <a href="#timenow" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">time/now()</code>
  
  
</h3>
    

<p>Returns a <code class="language-plaintext highlighter-rouge">float64</code> representing the amount of nanoseconds since the unix epoch (01/01/1970 00:00:00).</p>
<h3 id="timeformatepoch_nano-layout-zone">
  
  
    <a href="#timeformatepoch_nano-layout-zone" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">time/format(epoch_nano, layout, zone)</code>
  
  
</h3>
    

<p>Returns a string representation of the given epoch_nano timestamp for the given Timezone (e.g. <code class="language-plaintext highlighter-rouge">"UTC"</code>, <code class="language-plaintext highlighter-rouge">"America/Los_Angeles"</code>, …)
The <code class="language-plaintext highlighter-rouge">layout</code> parameter should follow <a href="https://pkg.go.dev/time#pkg-constants" target="_blank">Go’s time layout format</a>.</p>
<h3 id="timeformat_isoepoch_nano-zone">
  
  
    <a href="#timeformat_isoepoch_nano-zone" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">time/format_iso(epoch_nano, zone)</code>
  
  
</h3>
    

<p>Returns a string representation of the given <code class="language-plaintext highlighter-rouge">epoch_nano</code> timestamp for the given Timezone (e.g. <code class="language-plaintext highlighter-rouge">"UTC"</code>, <code class="language-plaintext highlighter-rouge">"America/Los_Angeles"</code>, …)
The returned string will be in <a href="https://en.wikipedia.org/wiki/ISO_8601" target="_blank">ISO8601</a> format.</p>
<h3 id="timesleepduration_ns">
  
  
    <a href="#timesleepduration_ns" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">time/sleep(duration_ns)</code>
  
  
</h3>
    

<p>Sleep for <code class="language-plaintext highlighter-rouge">duration_ns</code> nanoseconds</p>
<h3 id="timesinceepoch_nano">
  
  
    <a href="#timesinceepoch_nano" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">time/since(epoch_nano)</code>
  
  
</h3>
    

<p>Returns the amount of nanoseconds elapsed since <code class="language-plaintext highlighter-rouge">epoch_nano</code></p>
<h3 id="timeaddepoch_time-duration_table">
  
  
    <a href="#timeaddepoch_time-duration_table" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">time/add(epoch_time, duration_table)</code>
  
  
</h3>
    

<p>Returns a new timestamp (in nanoseconds passed since 01/01/1970 00:00:00) for the given <code class="language-plaintext highlighter-rouge">duration</code>.
The <code class="language-plaintext highlighter-rouge">duration</code> should be a table with the following structure:</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> <span class="nb">require</span><span class="p">(</span><span class="s2">"time"</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="n">time</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">time</span><span class="p">.</span><span class="n">now</span><span class="p">(),</span> <span class="p">{</span>
    <span class="p">[</span><span class="s2">"hour"</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="p">[</span><span class="s2">"minute"</span><span class="p">]</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
    <span class="p">[</span><span class="s2">"second"</span><span class="p">]</span> <span class="o">=</span> <span class="mi">50</span>
<span class="p">})</span>
</code></pre></div></div>
<p>You may omit any of the fields from the table, resulting in a default value of <code class="language-plaintext highlighter-rouge">0</code> for omitted fields</p>
<h3 id="timeparselayout-value">
  
  
    <a href="#timeparselayout-value" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">time/parse(layout, value)</code>
  
  
</h3>
    

<p>Returns a <code class="language-plaintext highlighter-rouge">float64</code> representing the amount of nanoseconds since the unix epoch (01/01/1970 00:00:00).
This timestamp will represent date <code class="language-plaintext highlighter-rouge">value</code> parsed using the <code class="language-plaintext highlighter-rouge">layout</code> format.</p>

<p>The <code class="language-plaintext highlighter-rouge">layout</code> parameter should follow <a href="https://pkg.go.dev/time#pkg-constants" target="_blank">Go’s time layout format</a></p>
<h3 id="timeparse_isovalue">
  
  
    <a href="#timeparse_isovalue" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">time/parse_iso(value)</code>
  
  
</h3>
    

<p>Returns a <code class="language-plaintext highlighter-rouge">float64</code> representing the amount of nanoseconds since the unix epoch (01/01/1970 00:00:00 for <code class="language-plaintext highlighter-rouge">value</code>.
The <code class="language-plaintext highlighter-rouge">value</code> string should be in <a href="https://en.wikipedia.org/wiki/ISO_8601" target="_blank">ISO8601</a> format</p>
<h3 id="uuidnew">
  
  
    <a href="#uuidnew" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">uuid/new()</code>
  
  
</h3>
    

<p>Returns a new 128-bit <a href="https://www.rfc-editor.org/rfc/rfc4122" target="_blank">RFC 4122 UUID</a> in string representation.</p>
<h3 id="neturl">
  
  
    <a href="#neturl" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">net/url</code>
  
  
</h3>
    

<p>Provides a <code class="language-plaintext highlighter-rouge">parse</code> function parse a URL string into parts, returns a table with the URL’s host, path, scheme, query and fragment.</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> <span class="kd">local</span> <span class="n">url</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s2">"net/url"</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="n">url</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="s2">"https://example.com/path?p1=a#section"</span><span class="p">)</span>
<span class="p">{</span>
    <span class="p">[</span><span class="s2">"host"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"example.com"</span>
    <span class="p">[</span><span class="s2">"path"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"/path"</span>
    <span class="p">[</span><span class="s2">"scheme"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"https"</span>
    <span class="p">[</span><span class="s2">"query"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"p1=a"</span>
    <span class="p">[</span><span class="s2">"fragment"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"section"</span>
<span class="p">}</span>
</code></pre></div></div>
<h3 id="nethttp-optional">
  
  
    <a href="#nethttp-optional" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <code class="language-plaintext highlighter-rouge">net/http</code> (optional)
  
  
</h3>
    

<p>Provides a <code class="language-plaintext highlighter-rouge">request</code> function that performs an HTTP request.
For security reasons, this package is not available by default as it enables http requests to be sent out from the lakeFS instance network. The feature should be enabled under <code class="language-plaintext highlighter-rouge">actions.lua.net_http_enabled</code> <a href="/reference/configuration.html">configuration</a>.
Request will time out after 30 seconds.</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">http</span><span class="p">.</span><span class="n">request</span><span class="p">(</span><span class="n">url</span> <span class="p">[,</span> <span class="n">body</span><span class="p">])</span>
<span class="n">http</span><span class="p">.</span><span class="n">request</span><span class="p">{</span>
  <span class="n">url</span> <span class="o">=</span> <span class="n">string</span><span class="p">,</span>
  <span class="p">[</span><span class="n">method</span> <span class="o">=</span> <span class="n">string</span><span class="p">,]</span>
  <span class="p">[</span><span class="n">headers</span> <span class="o">=</span> <span class="n">header</span><span class="o">-</span><span class="n">table</span><span class="p">,]</span>
  <span class="p">[</span><span class="n">body</span> <span class="o">=</span> <span class="n">string</span><span class="p">,]</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Returns a code (number), body (string), headers (table) and status (string).</p>

<ul>
  <li>code - status code number</li>
  <li>body - string with the response body</li>
  <li>headers - table with the response request headers (key/value or table of values)</li>
  <li>status - status code text</li>
</ul>

<p>The first form of the call will perform GET requests or POST requests if the body parameter is passed.</p>

<p>The second form accepts a table and allows you to customize the request method and headers.</p>

<p>Example of a GET request</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">local</span> <span class="n">http</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s2">"net/http"</span><span class="p">)</span>
<span class="kd">local</span> <span class="n">code</span><span class="p">,</span> <span class="n">body</span> <span class="o">=</span> <span class="n">http</span><span class="p">.</span><span class="n">request</span><span class="p">(</span><span class="s2">"https://example.com"</span><span class="p">)</span>
<span class="k">if</span> <span class="n">code</span> <span class="o">==</span> <span class="mi">200</span> <span class="k">then</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
<span class="k">else</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"Failed to get example.com - status code: "</span> <span class="o">..</span> <span class="n">code</span><span class="p">)</span>
<span class="k">end</span>

</code></pre></div></div>

<p>Example of a POST request</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">local</span> <span class="n">http</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s2">"net/http"</span><span class="p">)</span>
<span class="kd">local</span> <span class="n">code</span><span class="p">,</span> <span class="n">body</span> <span class="o">=</span> <span class="n">http</span><span class="p">.</span><span class="n">request</span><span class="p">{</span>
    <span class="n">url</span><span class="o">=</span><span class="s2">"https://httpbin.org/post"</span><span class="p">,</span>
    <span class="n">method</span><span class="o">=</span><span class="s2">"POST"</span><span class="p">,</span>
    <span class="n">body</span><span class="o">=</span><span class="s2">"custname=tester"</span><span class="p">,</span>
    <span class="n">headers</span><span class="o">=</span><span class="p">{[</span><span class="s2">"Content-Type"</span><span class="p">]</span><span class="o">=</span><span class="s2">"application/x-www-form-urlencoded"</span><span class="p">},</span>
<span class="p">}</span>
<span class="k">if</span> <span class="n">code</span> <span class="o">==</span> <span class="mi">200</span> <span class="k">then</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
<span class="k">else</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"Failed to post data - status code: "</span> <span class="o">..</span> <span class="n">code</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div></div>

                

                
                

                

            </div>
        </div>

        
        

        <div class="search-overlay"></div>
        
    </div>
</div>

<footer>
    <div class="footer-sidebar"></div>
    <div class="footer-main">
        <div class="row">
            <div class="left">
                <ul class="footer-links">
                    
                    
                    <li class="aux-nav-list-item">
                        <a href="https://docs.lakefs.io/" class="site-button" >
                            Docs
                        </a>
                    </li>
                    
                    <li class="aux-nav-list-item">
                        <a href="https://lakefs.io/blog/" class="site-button" >
                            Blog
                        </a>
                    </li>
                    
                    <li class="aux-nav-list-item">
                        <a href="https://github.com/treeverse/lakeFS" class="site-button" >
                            GitHub
                        </a>
                    </li>
                    
                    <li class="aux-nav-list-item">
                        <a href="https://lakefs.io/community/" class="site-button" >
                            Community
                        </a>
                    </li>
                    
                    <li class="aux-nav-list-item">
                        <a href="https://lakefs.io/cloud-registration/" class="site-button" >
                            lakeFS Cloud
                        </a>
                    </li>
                    
                    <li class="aux-nav-list-item">
                        <a href="https://lakefs.io/contact-us/" class="site-button" >
                            Contact
                        </a>
                    </li>
                    
                    
                </ul>
            </div>
            <div class="right">
                <ul class="footer-social">
                    
                    
                    <li class="aux-nav-list-item">
                        <a href="https://lakefs.io/youtube" class="site-button" >
                            <img src="/v1.17/assets/icons/youtube.svg" class="no-hover" />
                            <img src="/v1.17/assets/icons/youtube-hover.svg" class="hover" />
                        </a>
                    </li>
                    
                    <li class="aux-nav-list-item">
                        <a href="https://www.linkedin.com/company/treeverse" class="site-button" >
                            <img src="/v1.17/assets/icons/linkedin.svg" class="no-hover" />
                            <img src="/v1.17/assets/icons/linkedin-hover.svg" class="hover" />
                        </a>
                    </li>
                    
                    <li class="aux-nav-list-item">
                        <a href="https://github.com/treeverse/lakeFS" class="site-button" >
                            <img src="/v1.17/assets/icons/github.svg" class="no-hover" />
                            <img src="/v1.17/assets/icons/github-hover.svg" class="hover" />
                        </a>
                    </li>
                    
                    <li class="aux-nav-list-item">
                        <a href="https://twitter.com/lakeFS" class="site-button" >
                            <img src="/v1.17/assets/icons/twitter.svg" class="no-hover" />
                            <img src="/v1.17/assets/icons/twitter-hover.svg" class="hover" />
                        </a>
                    </li>
                    
                    <li class="aux-nav-list-item">
                        <a href="https://data-folks.masto.host/@lakeFS" class="site-button" >
                            <img src="/v1.17/assets/icons/mastodon.svg" class="no-hover" />
                            <img src="/v1.17/assets/icons/mastodon-hover.svg" class="hover" />
                        </a>
                    </li>
                    
                    <li class="aux-nav-list-item">
                        <a href="https://lakefs.io/slack" class="site-button" >
                            <img src="/v1.17/assets/icons/slack.svg" class="no-hover" />
                            <img src="/v1.17/assets/icons/slack-hover.svg" class="hover" />
                        </a>
                    </li>
                    
                    
                </ul>
            </div>
        </div>
        <div class="row top-border">
            <div class="left">
                <a href="https://lakefs.io" class="lh-tight" style="margin-bottom: 0px;">
                    <div class="site-logo"></div>
                </a>                    
            </div>
            <div class="right">
                <ul class="bottom-footer-links">
                    
                    
                    <li class="aux-nav-list-item">
                        <a href="https://lakefs.io/terms-of-use/" class="site-button" >
                            Terms of use
                        </a>
                    </li>
                    
                    <li class="aux-nav-list-item">
                        <a href="https://lakefs.io/privacy-policy/" class="site-button" >
                            Privacy Policy
                        </a>
                    </li>
                    
                    
                </ul>
            </div>
        </div>
    </div>
</footer>


</body>

</html>

