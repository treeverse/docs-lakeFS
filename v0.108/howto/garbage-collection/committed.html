

<!DOCTYPE html>

<html lang="en-US">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge">

  <link rel="stylesheet" href="/v0.108/assets/css/just-the-docs-default.css">
  
  <style type="text/css">
.site-nav > .nav-list:nth-child(1):not(.nav-category-list) > .nav-list-item:not(.external):nth-child(3) > .nav-list > .nav-list-item:nth-child(5) > .nav-list > .nav-list-item:nth-child(3) > .nav-list-link { display: block; font-weight: 600; text-decoration: none; background-image: linear-gradient(-90deg, #ebedf5 0%, rgba(235, 237, 245, 0.8) 80%, rgba(235, 237, 245, 0) 100%); }

.site-nav > .nav-list:nth-child(1):not(.nav-category-list) > .nav-list-item:not(.passive):nth-child(3) > .nav-list-expander svg, .site-nav > .nav-list:nth-child(1):not(.nav-category-list) > .nav-list-item:not(.passive):nth-child(3) > .nav-list > .nav-list-item:not(.passive):nth-child(5) > .nav-list-expander svg { transform: rotate(-90deg); }
.site-nav > .nav-list:nth-child(1):not(.nav-category-list) > .nav-list-item:not(.passive):nth-child(3) > .nav-list, .site-nav > .nav-list:nth-child(1):not(.nav-category-list) > .nav-list-item:not(.passive):nth-child(3) > .nav-list > .nav-list-item:not(.passive):nth-child(5) > .nav-list { display: block; }

.site-nav > .nav-category-list > .nav-list-item:not(.passive) > .nav-list-expander svg { transform: rotate(-90deg); }
.site-nav > .nav-category-list > .nav-list-item:not(.passive) > .nav-list { display: block; }

</style>


  

  
    <script src="/v0.108/assets/js/vendor/lunr.min.js"></script>
  

  <script src="/v0.108/assets/js/just-the-docs.js"></script>

  <meta name="viewport" content="width=device-width, initial-scale=1">

  

  <link rel="icon" href="/v0.108/favicon.ico" type="image/x-icon">



  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>(deprecated) Committed Objects | lakeFS Documentation</title>
<meta name="generator" content="Jekyll v3.9.3" />
<meta property="og:title" content="(deprecated) Committed Objects" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Clean up unnecessary objects using the garbage collection feature in lakeFS." />
<meta property="og:description" content="Clean up unnecessary objects using the garbage collection feature in lakeFS." />
<meta property="og:site_name" content="lakeFS Documentation" />
<meta property="og:image" content="https://docs.lakefs.io/assets/img/docs_logo.png" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:image" content="https://docs.lakefs.io/assets/img/docs_logo.png" />
<meta property="twitter:title" content="(deprecated) Committed Objects" />
<meta name="twitter:site" content="@lakeFS" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"Clean up unnecessary objects using the garbage collection feature in lakeFS.","headline":"(deprecated) Committed Objects","image":"https://docs.lakefs.io/assets/img/docs_logo.png","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"/v0.108/assets/logo.svg"}},"url":"/v0.108/howto/garbage-collection/committed.html"}</script>
<!-- End Jekyll SEO tag -->


  <!-- Google Tag Manager Head -->
<!-- type="text/plain" is intentional for cookie consent support -->
<script type="text/plain" data-cookiecategory="analytics">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
            new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KTZBZW9');</script>
<!-- End Google Tag Manager Head -->
<meta property="og:image" content="/v0.108/assets/img/lakefs-logo-with-text.png">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/fontawesome.min.css" integrity="sha512-giQeaPns4lQTBMRpOOHsYnGw1tGVzbAIHUyHRgn7+6FmiEgGGjaG0T2LZJmAPMzRCl+Cug0ItQ2xDZpTmEc+CQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" integrity="sha512-MV7K8+y+gLIBoVD59lQIYicR65iaqukzvf/nwasF0nqhPay5w/9lJmVM2hMDcnK1OnMGCdVK+iQrJ7lzPJQd1w==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<link rel="stylesheet" href="/v0.108/assets/css/cookieconsent.css" media="print" onload="this.media = 'all'" />
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js" crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.13.2/themes/smoothness/jquery-ui.css">
<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.13.2/jquery-ui.min.js"></script>
<script src="/v0.108/assets/js/copy-code.js"></script>
<script>
    $(function () {
        $(".tabs").tabs();
    });
</script>
<script src="/v0.108/assets/js/feedback.js"></script>
<link href="https://data-folks.masto.host/@lakeFS" rel="me">
<script defer src="/v0.108/assets/js/cookieconsent.js"></script>
<script defer src="/v0.108/assets/js/cookieconsent-init.js"></script>

</head>

<script src="https://unpkg.com/mermaid@9.3.0/dist/mermaid.min.js"></script>
<script>
    $(document).ready(function () {
        mermaid.initialize({
            startOnLoad:true,
            theme: "default",
        });
        window.mermaid.init(undefined, document.querySelectorAll('.language-mermaid'));
    });
</script>
<body>
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KTZBZW9"
                  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
    <symbol id="svg-link" viewBox="0 0 24 24">
        <title>Link</title>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
             stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
             class="feather feather-link">
            <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
            <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
        </svg>
    </symbol>
    <symbol id="svg-search" viewBox="0 0 24 24">
        <title>Search</title>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
             stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
             class="feather feather-search">
            <circle cx="11" cy="11" r="8"></circle>
            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
        </svg>
    </symbol>
    <symbol id="svg-menu" viewBox="0 0 24 24">
        <title>Menu</title>
        <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="16px" viewBox="0 0 20 16" version="1.1"
             class="feather feather-menu">
            <g id="Symbols" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                <g id="header-/-mobile" transform="translate(-30.000000, -32.000000)" fill="#279890">
                    <g id="Group" transform="translate(30.000000, 32.000000)">
                        <path
                                d="M20,14 L20,16 L0,16 L0,14 L20,14 Z M20,7 L20,9 L0,9 L0,7 L20,7 Z M20,0 L20,2 L0,2 L0,0 L20,0 Z"
                                id="mobile-menu" />
                    </g>
                </g>
            </g>
        </svg>
    </symbol>
    <symbol id="svg-arrow-right" viewBox="0 0 24 24">
        <title>Expand</title>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
             stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
             class="feather feather-chevron-right">
            <polyline points="9 18 15 12 9 6"></polyline>
        </svg>
    </symbol>
    <symbol id="svg-doc" viewBox="0 0 24 24">
        <title>Document</title>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
             stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
             class="feather feather-file">
            <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path>
            <polyline points="13 2 13 9 20 9"></polyline>
        </svg>
    </symbol>
</svg>
<div class="body-wrapper">
    <div class="side-bar">
        <div class="site-header">
            <a href="https://lakefs.io" class="site-title lh-tight">
  <div class="site-logo" role="img" aria-label="lakeFS Documentation"></div>

</a>
            <a href="#" id="menu-button" class="site-button">
                <svg viewBox="0 0 24 24" class="icon">
                    <use xlink:href="#svg-menu"></use>
                </svg>
            </a>
        </div>
        <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav">
            
            <div class="search">
                <div class="search-input-wrap">
                    <input type="text" id="search-input" class="search-input" tabindex="0"
                           placeholder="Search lakeFS Documentation" aria-label="Search lakeFS Documentation"
                           autocomplete="off">
                    <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon">
                            <use xlink:href="#svg-search"></use>
                        </svg></label>
                </div>
                <div id="search-results" class="search-results"></div>
            </div>
            

            <div class="nav-category nav-version">
                <label for="selectversion">Version:</label>
                <select id="selectversion" name="version" onchange="javascript:location.href = '/' + encodeURI(this.value);">
                    <option value="" selected>Latest</option>
                </select>
            </div>
            <script async>
                window.addEventListener("load",  async () => {
                    const pathFirstLevel = location.pathname.split('/')[1];
                    const selectedVersion = pathFirstLevel.startsWith('v') && pathFirstLevel || '';
                    const selectVersionElmFirst = document.getElementById('selectversion').firstElementChild;
                    const response = await fetch('/versions.json');
                    if (!response.ok) {
                        return
                    }
                    const versions = await response.json();
                    for (let [key, value] of Object.entries(versions)) {
                        const el = document.createElement("option");
                        el.value = key;
                        el.textContent = value;
                        if (key === selectedVersion) {
                            el.selected = true;
                        }
                        selectVersionElmFirst.after(el);
                    }
                });
            </script>

            <ul class="nav-list"><li
            class="nav-list-item"><a href="/v0.108/"
           class="nav-list-link">Welcome to lakeFS üëãüèª</a></li><li
            class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24">
                <use xlink:href="#svg-arrow-right"></use>
            </svg></a><a href="/v0.108/quickstart/"
           class="nav-list-link">‚≠ê Quickstart ‚≠ê</a><ul class="nav-list "><li class="nav-list-item "><a href="/v0.108/quickstart/launch.html"
                   class="nav-list-link">1Ô∏è‚É£ Run lakeFS</a></li><li class="nav-list-item "><a href="/v0.108/quickstart/query.html"
                   class="nav-list-link">2Ô∏è‚É£ Query the data</a></li><li class="nav-list-item "><a href="/v0.108/quickstart/branch.html"
                   class="nav-list-link">3Ô∏è‚É£ Create a branch</a></li><li class="nav-list-item "><a href="/v0.108/quickstart/commit-and-merge.html"
                   class="nav-list-link">4Ô∏è‚É£ Commit and Merge</a></li><li class="nav-list-item "><a href="/v0.108/quickstart/rollback.html"
                   class="nav-list-link">5Ô∏è‚É£ Roll back Changes</a></li><li class="nav-list-item "><a href="/v0.108/quickstart/actions-and-hooks.html"
                   class="nav-list-link">6Ô∏è‚É£ Using Actions and Hooks in lakeFS</a></li><li class="nav-list-item "><a href="/v0.108/quickstart/learning-more-lakefs.html"
                   class="nav-list-link">üßëüèª‚Äçüéì Learn more about lakeFS</a></li></ul></li><li
            class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24">
                <use xlink:href="#svg-arrow-right"></use>
            </svg></a><a href="/v0.108/howto/"
           class="nav-list-link">How-To</a><ul class="nav-list "><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24">
                        <use xlink:href="#svg-arrow-right"></use>
                    </svg></a><a href="/v0.108/howto/deploy/"
                   class="nav-list-link">Install lakeFS</a><ul class="nav-list"><li class="nav-list-item ">
                        <a href="/v0.108/howto/deploy/aws.html"
                           class="nav-list-link">AWS</a>
                    </li><li class="nav-list-item ">
                        <a href="/v0.108/howto/deploy/azure.html"
                           class="nav-list-link">Azure</a>
                    </li><li class="nav-list-item ">
                        <a href="/v0.108/howto/deploy/gcp.html"
                           class="nav-list-link">GCP</a>
                    </li><li class="nav-list-item ">
                        <a href="/v0.108/howto/deploy/onprem.html"
                           class="nav-list-link">On-Premises</a>
                    </li><li class="nav-list-item ">
                        <a href="/v0.108/howto/deploy/upgrade.html"
                           class="nav-list-link">Upgrade lakeFS</a>
                    </li></ul></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24">
                        <use xlink:href="#svg-arrow-right"></use>
                    </svg></a><a href="/v0.108/howto/hooks/"
                   class="nav-list-link">Actions and Hooks</a><ul class="nav-list"><li class="nav-list-item ">
                        <a href="/v0.108/howto/hooks/airflow.html"
                           class="nav-list-link">Airflow Hooks</a>
                    </li><li class="nav-list-item ">
                        <a href="/v0.108/howto/hooks/lua.html"
                           class="nav-list-link">Lua Hooks</a>
                    </li><li class="nav-list-item ">
                        <a href="/v0.108/howto/hooks/webhooks.html"
                           class="nav-list-link">Webhooks</a>
                    </li></ul></li><li class="nav-list-item "><a href="/v0.108/howto/copying.html"
                   class="nav-list-link">Copying data to/from lakeFS</a></li><li class="nav-list-item "><a href="/v0.108/howto/export.html"
                   class="nav-list-link">Export Data</a></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24">
                        <use xlink:href="#svg-arrow-right"></use>
                    </svg></a><a href="/v0.108/howto/garbage-collection/"
                   class="nav-list-link">Garbage Collection</a><ul class="nav-list"><li class="nav-list-item ">
                        <a href="/v0.108/howto/garbage-collection/managed-gc.html"
                           class="nav-list-link">Managed Garbage Collection</a>
                    </li><li class="nav-list-item ">
                        <a href="/v0.108/howto/garbage-collection/internals.html"
                           class="nav-list-link">Internals</a>
                    </li><li class="nav-list-item ">
                        <a href="/v0.108/howto/garbage-collection/committed.html"
                           class="nav-list-link">(deprecated) Committed Objects</a>
                    </li><li class="nav-list-item ">
                        <a href="/v0.108/howto/garbage-collection/uncommitted.html"
                           class="nav-list-link">(deprecated) Uncommitted Objects</a>
                    </li></ul></li><li class="nav-list-item "><a href="/v0.108/howto/import.html"
                   class="nav-list-link">Import Data</a></li><li class="nav-list-item "><a href="/v0.108/howto/migrate-away.html"
                   class="nav-list-link">Migrating away from lakeFS</a></li><li class="nav-list-item "><a href="/v0.108/howto/private-link.html"
                   class="nav-list-link">Private Link</a></li><li class="nav-list-item "><a href="/v0.108/howto/protect-branches.html"
                   class="nav-list-link">Protect Branches</a></li><li class="nav-list-item "><a href="/v0.108/howto/sizing-guide.html"
                   class="nav-list-link">Sizing Guide</a></li></ul></li><li
            class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24">
                <use xlink:href="#svg-arrow-right"></use>
            </svg></a><a href="/v0.108/integrations/"
           class="nav-list-link">Integrations</a><ul class="nav-list "><li class="nav-list-item "><a href="/v0.108/integrations/aws_cli.html"
                   class="nav-list-link">AWS CLI</a></li><li class="nav-list-item "><a href="/v0.108/integrations/airbyte.html"
                   class="nav-list-link">Airbyte</a></li><li class="nav-list-item "><a href="/v0.108/integrations/athena.html"
                   class="nav-list-link">Amazon Athena</a></li><li class="nav-list-item "><a href="/v0.108/integrations/sagemaker.html"
                   class="nav-list-link">Amazon SageMaker</a></li><li class="nav-list-item "><a href="/v0.108/integrations/airflow.html"
                   class="nav-list-link">Apache Airflow</a></li><li class="nav-list-item "><a href="/v0.108/integrations/hive.html"
                   class="nav-list-link">Apache Hive</a></li><li class="nav-list-item "><a href="/v0.108/integrations/iceberg.html"
                   class="nav-list-link">Apache Iceberg</a></li><li class="nav-list-item "><a href="/v0.108/integrations/kafka.html"
                   class="nav-list-link">Apache Kafka</a></li><li class="nav-list-item "><a href="/v0.108/integrations/spark.html"
                   class="nav-list-link">Apache Spark</a></li><li class="nav-list-item "><a href="/v0.108/integrations/cloudera.html"
                   class="nav-list-link">Cloudera</a></li><li class="nav-list-item "><a href="/v0.108/integrations/delta.html"
                   class="nav-list-link">Delta Lake</a></li><li class="nav-list-item "><a href="/v0.108/integrations/dremio.html"
                   class="nav-list-link">Dremio</a></li><li class="nav-list-item "><a href="/v0.108/integrations/duckdb.html"
                   class="nav-list-link">DuckDB</a></li><li class="nav-list-item "><a href="/v0.108/integrations/glue_hive_metastore.html"
                   class="nav-list-link">Glue / Hive metastore</a></li><li class="nav-list-item "><a href="/v0.108/integrations/kubeflow.html"
                   class="nav-list-link">Kubeflow</a></li><li class="nav-list-item "><a href="/v0.108/integrations/presto_trino.html"
                   class="nav-list-link">Presto / Trino</a></li><li class="nav-list-item "><a href="/v0.108/integrations/python.html"
                   class="nav-list-link">Python</a></li><li class="nav-list-item "><a href="/v0.108/integrations/r.html"
                   class="nav-list-link">R</a></li><li class="nav-list-item "><a href="/v0.108/integrations/vertex_ai.html"
                   class="nav-list-link">Vertex AI</a></li><li class="nav-list-item "><a href="/v0.108/integrations/dbt.html"
                   class="nav-list-link">dbt</a></li></ul></li><li
            class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24">
                <use xlink:href="#svg-arrow-right"></use>
            </svg></a><a href="/v0.108/understand/"
           class="nav-list-link">Understanding lakeFS</a><ul class="nav-list "><li class="nav-list-item "><a href="/v0.108/understand/architecture.html"
                   class="nav-list-link">Architecture</a></li><li class="nav-list-item "><a href="/v0.108/understand/model.html"
                   class="nav-list-link">Concepts and  Model</a></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24">
                        <use xlink:href="#svg-arrow-right"></use>
                    </svg></a><a href="/v0.108/understand/data_lifecycle_management/"
                   class="nav-list-link">Data Lifecycle Management</a><ul class="nav-list"><li class="nav-list-item ">
                        <a href="/v0.108/understand/data_lifecycle_management/ci.html"
                           class="nav-list-link">During Deployment</a>
                    </li><li class="nav-list-item ">
                        <a href="/v0.108/understand/data_lifecycle_management/production.html"
                           class="nav-list-link">In Production</a>
                    </li><li class="nav-list-item ">
                        <a href="/v0.108/understand/data_lifecycle_management/data-devenv.html"
                           class="nav-list-link">In Test</a>
                    </li></ul></li><li class="nav-list-item "><a href="/v0.108/understand/faq.html"
                   class="nav-list-link">FAQ</a></li><li class="nav-list-item "><a href="/v0.108/understand/glossary.html"
                   class="nav-list-link">Glossary</a></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24">
                        <use xlink:href="#svg-arrow-right"></use>
                    </svg></a><a href="/v0.108/understand/how/"
                   class="nav-list-link">How lakeFS Works</a><ul class="nav-list"><li class="nav-list-item ">
                        <a href="/v0.108/understand/how/kv.html"
                           class="nav-list-link">Internal database structure</a>
                    </li><li class="nav-list-item ">
                        <a href="/v0.108/understand/how/merge.html"
                           class="nav-list-link">Merge</a>
                    </li><li class="nav-list-item ">
                        <a href="/v0.108/understand/how/versioning-internals.html"
                           class="nav-list-link">Versioning Internals</a>
                    </li></ul></li><li class="nav-list-item "><a href="/v0.108/understand/performance-best-practices.html"
                   class="nav-list-link">Performance Best Practices</a></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24">
                        <use xlink:href="#svg-arrow-right"></use>
                    </svg></a><a href="/v0.108/understand/use_cases/"
                   class="nav-list-link">Use Cases</a><ul class="nav-list"><li class="nav-list-item ">
                        <a href="/v0.108/understand/use_cases/cicd_for_data.html"
                           class="nav-list-link">CI/CD for Data Lakes</a>
                    </li><li class="nav-list-item ">
                        <a href="/v0.108/understand/use_cases/etl_testing.html"
                           class="nav-list-link">ETL Testing Environment</a>
                    </li><li class="nav-list-item ">
                        <a href="/v0.108/understand/use_cases/reproducibility.html"
                           class="nav-list-link">Reproducibility</a>
                    </li><li class="nav-list-item ">
                        <a href="/v0.108/understand/use_cases/rollback.html"
                           class="nav-list-link">Rollback</a>
                    </li></ul></li><li class="nav-list-item "><a href="/v0.108/understand/lakefs-cloud.html"
                   class="nav-list-link">lakeFS Cloud</a></li><li class="nav-list-item "><a href="/v0.108/understand/lakefs-enterprise.html"
                   class="nav-list-link">lakeFS Enterprise</a></li></ul></li><li
            class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24">
                <use xlink:href="#svg-arrow-right"></use>
            </svg></a><a href="/v0.108/reference/"
           class="nav-list-link">Reference</a><ul class="nav-list "><li class="nav-list-item "><a href="/v0.108/reference/auditing.html"
                   class="nav-list-link">Auditing</a></li><li class="nav-list-item "><a href="/v0.108/reference/monitor.html"
                   class="nav-list-link">Monitoring using Prometheus</a></li><li class="nav-list-item "><a href="/v0.108/reference/s3.html"
                   class="nav-list-link">S3 Gateway API</a></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24">
                        <use xlink:href="#svg-arrow-right"></use>
                    </svg></a><a href="/v0.108/reference/security/"
                   class="nav-list-link">Security</a><ul class="nav-list"><li class="nav-list-item ">
                        <a href="/v0.108/reference/security/access-control-lists.html"
                           class="nav-list-link">Access Control Lists (ACLs)</a>
                    </li><li class="nav-list-item ">
                        <a href="/v0.108/reference/security/authentication.html"
                           class="nav-list-link">Authentication</a>
                    </li><li class="nav-list-item ">
                        <a href="/v0.108/reference/security/presigned-url.html"
                           class="nav-list-link">Presigned URL</a>
                    </li><li class="nav-list-item ">
                        <a href="/v0.108/reference/security/remote-authenticator.html"
                           class="nav-list-link">Remote Authenticator</a>
                    </li><li class="nav-list-item ">
                        <a href="/v0.108/reference/security/rbac.html"
                           class="nav-list-link">Role-Based Access Control (RBAC)</a>
                    </li></ul></li><li class="nav-list-item "><a href="/v0.108/reference/spark-client.html"
                   class="nav-list-link">Spark Client</a></li><li class="nav-list-item "><a href="/v0.108/reference/api.html"
                   class="nav-list-link">lakeFS API</a></li><li class="nav-list-item "><a href="/v0.108/reference/configuration.html"
                   class="nav-list-link">lakeFS Server Configuration</a></li><li class="nav-list-item "><a href="/v0.108/reference/cli.html"
                   class="nav-list-link">lakectl (lakeFS command-line tool)</a></li></ul></li><li
            class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24">
                <use xlink:href="#svg-arrow-right"></use>
            </svg></a><a href="/v0.108/project/"
           class="nav-list-link">The lakeFS Project</a><ul class="nav-list "><li class="nav-list-item "><a href="/v0.108/project/contributing.html"
                   class="nav-list-link">Contributing to lakeFS</a></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24">
                        <use xlink:href="#svg-arrow-right"></use>
                    </svg></a><a href="/v0.108/project/docs/"
                   class="nav-list-link">Documentation</a><ul class="nav-list"><li class="nav-list-item ">
                        <a href="/v0.108/project/docs/callouts.html"
                           class="nav-list-link">Callouts</a>
                    </li></ul></li></ul></li></ul>
            <div class="mobile-menu">
                
<nav aria-label="Auxiliary" class="aux-nav">
    <ul class="aux-nav-list">
        
        
        <li class="aux-nav-list-item">
            <a href="https://docs.lakefs.io/" class="site-button" >
                Docs
            </a>
        </li>
        
        <li class="aux-nav-list-item">
            <a href="https://lakefs.io/blog/" class="site-button" >
                Blog
            </a>
        </li>
        
        <li class="aux-nav-list-item">
            <a href="https://lakefs.io/community/" class="site-button" >
                Community
            </a>
        </li>
        
        <li class="aux-nav-list-item">
            <a href="https://github.com/treeverse/lakeFS" class="site-button" >
                GitHub
            </a>
        </li>
        
        
        
        
        <li class="aux-nav-list-item button">
            <a href="https://lakefs.io/slack" class="site-button" >
                Join us on Slack
            </a>
        </li>
        
        
    </ul>
</nav>

            </div>
        </nav>

    </div>
    <div class="main" id="top">
         <div class="feedback-container">
            <div id="is-helpful-ty">
                <div class="text-epsilon">Thank you for your feedback.</div>
                <div class="mt-2 text-epsilon">
                    <a href="https://lakefs.io/slack" target="_blank">Join the community</a> to get more help.
                </div>
            </div>
            <div class="feedback-buttons">
                <span class="tooltip">
                    <button class="page-helpful-btn far fa-lg fa-thumbs-up" id="page-helpful-yes"></button>
                    <span class="tooltiptext">
                        This page is <b>helpful</b>
                    </span>
                </span>
                <span class="tooltip">
                    <button class="page-helpful-btn far fa-lg fa-thumbs-down" id="page-helpful-no"></button>
                    <span class="tooltiptext">
                        This page is <b>not helpful</b>
                    </span>
                </span>
            </div>
        </div>
        <div id="main-header" class="main-header">
            
<nav aria-label="Auxiliary" class="aux-nav">
    <ul class="aux-nav-list">
        
        
        <li class="aux-nav-list-item">
            <a href="https://docs.lakefs.io/" class="site-button" >
                Docs
            </a>
        </li>
        
        <li class="aux-nav-list-item">
            <a href="https://lakefs.io/blog/" class="site-button" >
                Blog
            </a>
        </li>
        
        <li class="aux-nav-list-item">
            <a href="https://lakefs.io/community/" class="site-button" >
                Community
            </a>
        </li>
        
        <li class="aux-nav-list-item">
            <a href="https://github.com/treeverse/lakeFS" class="site-button" >
                GitHub
            </a>
        </li>
        
        
        
        
        <li class="aux-nav-list-item button">
            <a href="https://lakefs.io/slack" class="site-button" >
                Join us on Slack
            </a>
        </li>
        
        
    </ul>
</nav>

        </div>
        <div id="main-content-wrap" class="main-content-wrap">
            
            
            <nav aria-label="Breadcrumb" class="breadcrumb-nav">
                <ol class="breadcrumb-nav-list">
                    
                    <li class="breadcrumb-nav-list-item"><a
                                href="">How-To</a>
                    </li>
                    <li class="breadcrumb-nav-list-item"><a href="">Garbage Collection</a>
                    </li>
                    
                    <li class="breadcrumb-nav-list-item"><span>(deprecated) Committed Objects</span></li>
                </ol>
            </nav>
            
            
            <div id="main-content" class="main-content" role="main">
                
                    <h1 id="garbage-collection-committed-objects">
  
  
    <a href="#garbage-collection-committed-objects" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Garbage Collection: committed objects
  
  
</h1>
    

<blockquote class="warning-title">
  <p>Deprecation notice</p>

  <p>This feature will be available up to version 0.9.1 of the lakeFS metadata client. It will be discontinued in subsequent versions.
Please visit the new <a href="/v0.108/howto/garbage-collection/">garbage collection documentation</a>.</p>
</blockquote>

<p>By default, lakeFS keeps all your objects forever. This allows you to travel back in time to previous versions of your data.
However, sometimes you may want to hard-delete your objects - namely, delete them from the underlying storage. 
Reasons for this include cost-reduction and privacy policies.</p>

<p>Garbage collection rules in lakeFS define for how long to retain objects after they have been deleted.
lakeFS provides a Spark program to hard-delete objects whose retention period has ended according to the GC rules.</p>

<p class="note">This program does not remove any commits: you will still be able to use commits containing hard-deleted objects,
but trying to read these objects from lakeFS will result in a <code class="language-plaintext highlighter-rouge">410 Gone</code> HTTP status.</p>

<p class="note"><a href="https://lakefs.cloud">lakeFS Cloud</a> users enjoy a managed Garbage Collection service, and do not need to run this Spark program.</p>

<div class="toc-block">
<h2 class="no_toc text-delta" id="table-of-contents">
  
  
    <a href="#table-of-contents" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Table of contents
  
  
</h2>
    

<ol id="markdown-toc">
  <li><a href="#understanding-garbage-collection" id="markdown-toc-understanding-garbage-collection">Understanding Garbage Collection</a></li>
  <li><a href="#configuring-gc-rules" id="markdown-toc-configuring-gc-rules">Configuring GC rules</a></li>
  <li><a href="#running-the-gc-job" id="markdown-toc-running-the-gc-job">Running the GC job</a></li>
  <li><a href="#considerations" id="markdown-toc-considerations">Considerations</a></li>
  <li><a href="#backup-and-restore" id="markdown-toc-backup-and-restore">Backup and restore</a></li>
</ol>

</div>
<h2 id="understanding-garbage-collection">
  
  
    <a href="#understanding-garbage-collection" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Understanding Garbage Collection
  
  
</h2>
    

<p>For every branch, the GC job retains deleted objects for the number of days defined for the branch.
In the absence of a branch-specific rule, the default rule for the repository is used.
If an object is present in more than one branch ancestry, it‚Äôs retained according to the rule with the largest number of days between those branches.
That is, it‚Äôs hard-deleted only after the retention period has ended for all relevant branches.</p>

<p>Example GC rules for a repository:</p>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"default_retention_days"</span><span class="p">:</span><span class="w"> </span><span class="mi">14</span><span class="p">,</span><span class="w">
  </span><span class="nl">"branches"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="nl">"branch_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"main"</span><span class="p">,</span><span class="w"> </span><span class="nl">"retention_days"</span><span class="p">:</span><span class="w"> </span><span class="mi">21</span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="nl">"branch_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"dev"</span><span class="p">,</span><span class="w"> </span><span class="nl">"retention_days"</span><span class="p">:</span><span class="w"> </span><span class="mi">7</span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>In the above example, objects are retained for 14 days after deletion by default. However, if they are present in the branch <code class="language-plaintext highlighter-rouge">main</code>, they are retained for 21 days.
Objects present in the <code class="language-plaintext highlighter-rouge">dev</code> branch (but not in any other branch) are retained for 7 days after they are deleted.</p>
<h2 id="configuring-gc-rules">
  
  
    <a href="#configuring-gc-rules" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Configuring GC rules
  
  
</h2>
    

<p>To define garbage collection rules, either use the <code class="language-plaintext highlighter-rouge">lakectl</code> command or the lakeFS web UI:</p>

<div class="tabs">
  <ul>
    <li><a href="#lakectl-option">CLI</a></li>
    <li><a href="#ui-option">Web UI</a></li>
  </ul>
  <div id="lakectl-option">

    <p>Create a JSON file with your GC rules:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cat</span> <span class="o">&lt;&lt;</span><span class="no">EOT</span><span class="sh"> &gt;&gt; example_repo_gc_rules.json
{
  "default_retention_days": 14,
  "branches": [
    {"branch_id": "main", "retention_days": 21},
    {"branch_id": "dev", "retention_days": 7}
  ]
}
</span><span class="no">EOT
</span></code></pre></div>    </div>

    <p>Set the GC rules using <code class="language-plaintext highlighter-rouge">lakectl</code>:</p>
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>lakectl gc set-config lakefs://example-repo <span class="nt">-f</span> example_repo_gc_rules.json 
</code></pre></div>    </div>

  </div>
  <div id="ui-option">
    <p>From the lakeFS web UI:</p>

    <ol>
      <li>Navigate to the main page of your repository.</li>
      <li>Go to <em>Settings</em> -&gt; <em>Retention</em>.</li>
      <li>Click <em>Edit policy</em> and paste your GC rule into the text box as a JSON.</li>
      <li>Save your changes.</li>
    </ol>

    <p><img src="/v0.108/assets/img/gc_rules_from_ui.png" alt="GC Rules From UI" /></p>
  </div>
</div>
<h2 id="running-the-gc-job">
  
  
    <a href="#running-the-gc-job" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Running the GC job
  
  
</h2>
    

<p>To run the job, use the following <code class="language-plaintext highlighter-rouge">spark-submit</code> command (or using your preferred method of running Spark programs).
The job will hard-delete objects that were deleted and whose retention period has ended according to the GC rules.</p>

<div class="tabs">
  <ul>
    <li><a href="#aws-option">On AWS (Spark 3.1.2 and higher)</a></li>
    <li><a href="#aws-301-option">On AWS (Spark 3.0.1)</a></li>
    <li><a href="#azure-option">On Azure</a></li>
    <li><a href="#gcp-option">On GCP</a></li>
  </ul>
  <div id="aws-option">
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>spark-submit <span class="nt">--class</span> io.treeverse.clients.GarbageCollector <span class="se">\</span>
  <span class="nt">--packages</span> org.apache.hadoop:hadoop-aws:2.7.7 <span class="se">\</span>
  <span class="nt">-c</span> spark.hadoop.lakefs.api.url<span class="o">=</span>https://lakefs.example.com:8000/api/v1  <span class="se">\</span>
  <span class="nt">-c</span> spark.hadoop.lakefs.api.access_key<span class="o">=</span>&lt;LAKEFS_ACCESS_KEY&gt; <span class="se">\</span>
  <span class="nt">-c</span> spark.hadoop.lakefs.api.secret_key<span class="o">=</span>&lt;LAKEFS_SECRET_KEY&gt; <span class="se">\</span>
  <span class="nt">-c</span> spark.hadoop.fs.s3a.access.key<span class="o">=</span>&lt;S3_ACCESS_KEY&gt; <span class="se">\</span>
  <span class="nt">-c</span> spark.hadoop.fs.s3a.secret.key<span class="o">=</span>&lt;S3_SECRET_KEY&gt; <span class="se">\</span>
  http://treeverse-clients-us-east.s3-website-us-east-1.amazonaws.com/lakefs-spark-client-312-hadoop3/0.9.1/lakefs-spark-client-312-hadoop3-assembly-0.9.1.jar <span class="se">\</span>
  example-repo us-east-1
</code></pre></div>    </div>
  </div>
  <div id="aws-301-option">
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>spark-submit <span class="nt">--class</span> io.treeverse.clients.GarbageCollector <span class="se">\</span>
  <span class="nt">--packages</span> org.apache.hadoop:hadoop-aws:2.7.7 <span class="se">\</span>
  <span class="nt">-c</span> spark.hadoop.lakefs.api.url<span class="o">=</span>https://lakefs.example.com:8000/api/v1  <span class="se">\</span>
  <span class="nt">-c</span> spark.hadoop.lakefs.api.access_key<span class="o">=</span>&lt;LAKEFS_ACCESS_KEY&gt; <span class="se">\</span>
  <span class="nt">-c</span> spark.hadoop.lakefs.api.secret_key<span class="o">=</span>&lt;LAKEFS_SECRET_KEY&gt; <span class="se">\</span>
  <span class="nt">-c</span> spark.hadoop.fs.s3a.access.key<span class="o">=</span>&lt;S3_ACCESS_KEY&gt; <span class="se">\</span>
  <span class="nt">-c</span> spark.hadoop.fs.s3a.secret.key<span class="o">=</span>&lt;S3_SECRET_KEY&gt; <span class="se">\</span>
  http://treeverse-clients-us-east.s3-website-us-east-1.amazonaws.com/lakefs-spark-client-301/0.9.1/lakefs-spark-client-301-assembly-0.9.1.jar <span class="se">\</span>
  example-repo us-east-1
</code></pre></div>    </div>
  </div>

  <div id="azure-option">

    <p>If you want to access your storage using the account key:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>spark-submit <span class="nt">--class</span> io.treeverse.clients.GarbageCollector <span class="se">\</span>
  <span class="nt">--packages</span> org.apache.hadoop:hadoop-aws:3.2.1 <span class="se">\</span>
  <span class="nt">-c</span> spark.hadoop.lakefs.api.url<span class="o">=</span>https://lakefs.example.com:8000/api/v1  <span class="se">\</span>
  <span class="nt">-c</span> spark.hadoop.lakefs.api.access_key<span class="o">=</span>&lt;LAKEFS_ACCESS_KEY&gt; <span class="se">\</span>
  <span class="nt">-c</span> spark.hadoop.lakefs.api.secret_key<span class="o">=</span>&lt;LAKEFS_SECRET_KEY&gt; <span class="se">\</span>
  <span class="nt">-c</span> spark.hadoop.fs.azure.account.key.&lt;AZURE_STORAGE_ACCOUNT&gt;.dfs.core.windows.net<span class="o">=</span>&lt;AZURE_STORAGE_ACCESS_KEY&gt; <span class="se">\</span>
  http://treeverse-clients-us-east.s3-website-us-east-1.amazonaws.com/lakefs-spark-client-312-hadoop3/0.9.1/lakefs-spark-client-312-hadoop3-assembly-0.9.1.jar <span class="se">\</span>
  example-repo
</code></pre></div>    </div>

    <p>Or, if you want to access your storage using an Azure service principal:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>spark-submit <span class="nt">--class</span> io.treeverse.clients.GarbageCollector <span class="se">\</span>
  <span class="nt">--packages</span> org.apache.hadoop:hadoop-aws:3.2.1 <span class="se">\</span>
  <span class="nt">-c</span> spark.hadoop.lakefs.api.url<span class="o">=</span>https://lakefs.example.com:8000/api/v1  <span class="se">\</span>
  <span class="nt">-c</span> spark.hadoop.lakefs.api.access_key<span class="o">=</span>&lt;LAKEFS_ACCESS_KEY&gt; <span class="se">\</span>
  <span class="nt">-c</span> spark.hadoop.lakefs.api.secret_key<span class="o">=</span>&lt;LAKEFS_SECRET_KEY&gt; <span class="se">\</span>
  <span class="nt">-c</span> spark.hadoop.fs.azure.account.auth.type.&lt;AZURE_STORAGE_ACCOUNT&gt;.dfs.core.windows.net<span class="o">=</span>OAuth <span class="se">\</span>
  <span class="nt">-c</span> spark.hadoop.fs.azure.account.oauth.provider.type.&lt;AZURE_STORAGE_ACCOUNT&gt;.dfs.core.windows.net<span class="o">=</span>org.apache.hadoop.fs.azurebfs.oauth2.ClientCredsTokenProvider <span class="se">\</span>
  <span class="nt">-c</span> spark.hadoop.fs.azure.account.oauth2.client.id.&lt;AZURE_STORAGE_ACCOUNT&gt;.dfs.core.windows.net<span class="o">=</span>&lt;application-id&gt; <span class="se">\</span>
  <span class="nt">-c</span> spark.hadoop.fs.azure.account.oauth2.client.secret.&lt;AZURE_STORAGE_ACCOUNT&gt;.dfs.core.windows.net<span class="o">=</span>&lt;service-credential-key&gt; <span class="se">\</span>
  <span class="nt">-c</span> spark.hadoop.fs.azure.account.oauth2.client.endpoint.&lt;AZURE_STORAGE_ACCOUNT&gt;.dfs.core.windows.net<span class="o">=</span>https://login.microsoftonline.com/&lt;directory-id&gt;/oauth2/token <span class="se">\</span>
  http://treeverse-clients-us-east.s3-website-us-east-1.amazonaws.com/lakefs-spark-client-312-hadoop3/0.9.1/lakefs-spark-client-312-hadoop3-assembly-0.9.1.jar <span class="se">\</span>
  example-repo
</code></pre></div>    </div>

    <p><strong>Notes:</strong></p>
    <ul>
      <li>On Azure, GC was tested only on Spark 3.3.0, but may work with other Spark and Hadoop versions.</li>
      <li>In case you don‚Äôt have <code class="language-plaintext highlighter-rouge">hadoop-azure</code> package as part of your environment, you should add the package to your spark-submit with <code class="language-plaintext highlighter-rouge">--packages org.apache.hadoop:hadoop-azure:3.2.1</code></li>
      <li>For GC to work on Azure blob, <a href="https://docs.microsoft.com/en-us/azure/storage/blobs/soft-delete-blob-overview">soft delete</a> should be disabled.</li>
    </ul>
  </div>

  <div id="gcp-option">
    <p class="note note-warning">‚ö†Ô∏è At the moment, only the ‚Äúmark‚Äù phase of the Garbage Collection is supported for GCP.
That is, this program will output a list of expired objects, and you will have to delete them manually.
We have <a href="https://github.com/treeverse/lakeFS/issues/3626">concrete plans</a> to extend this support to actually delete the objects.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>spark-submit <span class="nt">--class</span> io.treeverse.clients.GarbageCollector <span class="se">\</span>
  <span class="nt">--jars</span> https://storage.googleapis.com/hadoop-lib/gcs/gcs-connector-hadoop3-latest.jar <span class="se">\</span>
  <span class="nt">-c</span> spark.hadoop.lakefs.api.url<span class="o">=</span>https://lakefs.example.com:8000/api/v1  <span class="se">\</span>
  <span class="nt">-c</span> spark.hadoop.lakefs.api.access_key<span class="o">=</span>&lt;LAKEFS_ACCESS_KEY&gt; <span class="se">\</span>
  <span class="nt">-c</span> spark.hadoop.lakefs.api.secret_key<span class="o">=</span>&lt;LAKEFS_SECRET_KEY&gt; <span class="se">\</span>
  <span class="nt">-c</span> spark.hadoop.google.cloud.auth.service.account.enable<span class="o">=</span><span class="nb">true</span> <span class="se">\</span>
  <span class="nt">-c</span> spark.hadoop.google.cloud.auth.service.account.json.keyfile<span class="o">=</span>&lt;PATH_TO_JSON_KEYFILE&gt; <span class="se">\</span>
  <span class="nt">-c</span> spark.hadoop.fs.gs.project.id<span class="o">=</span>&lt;GCP_PROJECT_ID&gt; <span class="se">\</span>
  <span class="nt">-c</span> spark.hadoop.fs.gs.impl<span class="o">=</span>com.google.cloud.hadoop.fs.gcs.GoogleHadoopFileSystem <span class="se">\</span>
  <span class="nt">-c</span> spark.hadoop.fs.AbstractFileSystem.gs.impl<span class="o">=</span>com.google.cloud.hadoop.fs.gcs.GoogleHadoopFS <span class="se">\</span>
  <span class="nt">-c</span> spark.hadoop.lakefs.gc.do_sweep<span class="o">=</span><span class="nb">false</span>  <span class="se">\</span>
  http://treeverse-clients-us-east.s3-website-us-east-1.amazonaws.com/lakefs-spark-client-312-hadoop3/0.9.1/lakefs-spark-client-312-hadoop3-assembly-0.9.1.jar <span class="se">\</span>
  example-repo
</code></pre></div>    </div>

    <p>This program will not delete anything.
Instead, it will find all the objects that are safe to delete and save a list containing all their keys, in Parquet format.
The list will then be found under the path:</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gs://&lt;STORAGE_NAMESPACE&gt;/_lakefs/logs/gc/expired_addresses/
</code></pre></div>    </div>

    <p>Note that this is a path in your Google Storage bucket, and not in your lakeFS repository.
For example, if your repository‚Äôs underlying storage is <code class="language-plaintext highlighter-rouge">gs://example-bucket/example-path</code>, you will find the list in:</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gs://example-bucket/example-path/_lakefs/logs/gc/expired_addresses/dt=&lt;TIMESTAMP&gt;/
</code></pre></div>    </div>

    <p>You can now delete the objects appearing in the list from your Google Storage bucket.</p>
  </div>
</div>

<p>You will find the list of objects hard-deleted by the job in the storage
namespace of the repository. It is saved in Parquet format under <code class="language-plaintext highlighter-rouge">_lakefs/logs/gc/deleted_objects</code>.</p>
<h3 id="gc-job-options">
  
  
    <a href="#gc-job-options" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> GC job options
  
  
</h3>
    

<p>By default, GC first creates a list of expired objects according to your retention rules and then hard-deletes those objects. 
However, you can use GC options to break the GC job down into two stages:</p>
<ol>
  <li>Mark stage: GC will mark the expired objects to hard-delete, <strong>without</strong> deleting them.</li>
  <li>Sweep stage: GC will hard-delete objects marked by a previous mark-only GC run.</li>
</ol>

<p>By breaking GC into these stages, you can pause and create a backup of the objects that GC is about to sweep and later 
restore them. You can use the <a href="#backup-and-restore">GC backup and restore</a> utility to do that.</p>
<h4 id="mark-only-mode">
  
  
    <a href="#mark-only-mode" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Mark only mode
  
  
</h4>
    

<p>To make GC run the mark stage only, add the following properties to your spark-submit command:</p>
<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">spark.hadoop.lakefs.gc.do_sweep</span><span class="p">=</span><span class="s">false</span>
<span class="py">spark.hadoop.lakefs.gc.mark_id</span><span class="p">=</span><span class="s">&lt;MARK_ID&gt; # Replace &lt;MARK_ID&gt; with your own identification string. This MARK_ID will enable you to start a sweep (actual deletion) run later</span>
</code></pre></div></div>
<p>Running in mark only mode, GC will write the addresses of the expired objects to delete to the following location: <code class="language-plaintext highlighter-rouge">STORAGE_NAMESPACE/_lakefs/retention/gc/addresses/mark_id=&lt;MARK_ID&gt;/</code> as a parquet.</p>

<p><strong>Notes:</strong></p>
<ul>
  <li>Mark only mode is only available from v0.4.0 of lakeFS Spark client.</li>
  <li>The <code class="language-plaintext highlighter-rouge">spark.hadoop.lakefs.debug.gc.no_delete</code> property has been deprecated with v0.4.0.</li>
</ul>
<h4 id="sweep-only-mode">
  
  
    <a href="#sweep-only-mode" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Sweep only mode
  
  
</h4>
    

<p>To make GC run the sweep stage only, add the following properties to your spark-submit command:</p>
<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">spark.hadoop.lakefs.gc.do_mark</span><span class="p">=</span><span class="s">false</span>
<span class="py">spark.hadoop.lakefs.gc.mark_id</span><span class="p">=</span><span class="s">&lt;MARK_ID&gt; # Replace &lt;MARK_ID&gt; with the identifier you used on a previous mark-only run</span>
</code></pre></div></div>
<p>Running in sweep only mode, GC will hard-delete the expired objects marked by a mark-only run and listed in: <code class="language-plaintext highlighter-rouge">STORAGE_NAMESPACE/_lakefs/retention/gc/addresses/mark_id=&lt;MARK_ID&gt;/</code>.</p>

<p><strong>Note:</strong> Mark only mode is only available from v0.4.0 of lakeFS Spark client.</p>
<h2 id="considerations">
  
  
    <a href="#considerations" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Considerations
  
  
</h2>
    

<ol>
  <li>
    <p>In order for an object to be hard-deleted, it must be deleted from all branches.
You should remove stale branches to prevent them from retaining old objects.
For example, consider a branch that has been merged to <code class="language-plaintext highlighter-rouge">main</code> and has become stale.
An object which is later deleted from <code class="language-plaintext highlighter-rouge">main</code> will always be present in the stale branch, preventing it from being hard-deleted.</p>
  </li>
  <li>
    <p>lakeFS will never delete objects outside your repository‚Äôs storage namespace.
In particular, objects that were imported using <code class="language-plaintext highlighter-rouge">lakectl ingest</code> or the UI import wizard will not be affected by GC jobs.</p>
  </li>
  <li>
    <p>In cases where deleted objects are brought back to life while a GC job is running, said objects may or may not be
deleted. Such actions include:</p>
    <ol>
      <li>Reverting a commit in which a file was deleted.</li>
      <li>Branching out from an old commit.</li>
      <li>Expanding the retention period of a branch.</li>
      <li>Creating a branch from an existing branch, where the new branch has a longer retention period.</li>
    </ol>
  </li>
</ol>
<h2 id="backup-and-restore">
  
  
    <a href="#backup-and-restore" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Backup and restore
  
  
</h2>
    

<p>GC was created to hard-delete objects from your underlying objects store according to your retention rules. However, when you start
using the feature you may want to first gain confidence in the decisions GC makes. The GC backup and restore utility helps you do that.</p>

<p><strong>Use-cases:</strong></p>
<ul>
  <li>Backup: copy expired objects from your repository‚Äôs storage namespace to an external location before running GC in <a href="#sweep-only-mode">sweep only mode</a>.</li>
  <li>Restore: copy objects that were hard-deleted by GC from an external location you used for saving your backup into your repository‚Äôs storage namespace.</li>
</ul>

<p>Follow <a href="https://rclone.org/docs/">rclone documentation</a> to configure remote access to the underlying storage used by lakeFS.
Replace <code class="language-plaintext highlighter-rouge">LAKEFS_STORAGE_NAMESPACE</code> with remote:bucket/path which points to the lakeFS repository storage namespace.
The <code class="language-plaintext highlighter-rouge">BACKUP_STORAGE_LOCATION</code> attribute points to a storage location outside your lakeFS storage namespace into which you want to save the backup.</p>
<h3 id="backup-command">
  
  
    <a href="#backup-command" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Backup command
  
  
</h3>
    

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rclone <span class="nt">--include</span> <span class="s2">"*.txt"</span> <span class="nb">cat</span> <span class="s2">"&lt;LAKEFS_STORAGE_NAMESPACE&gt;/_lakefs/retention/gc/addresses.text/mark_id=&lt;MARK_ID&gt;/"</span> | <span class="se">\</span>
  rclone <span class="nt">-P</span> <span class="nt">--no-traverse</span> <span class="nt">--files-from</span> - copy &lt;LAKEFS_STORAGE_NAMESPACE&gt; &lt;BACKUP_STORAGE_LOCATION&gt;
</code></pre></div></div>
<h3 id="restore-command">
  
  
    <a href="#restore-command" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Restore command
  
  
</h3>
    

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rclone <span class="nt">--include</span> <span class="s2">"*.txt"</span> <span class="nb">cat</span> <span class="s2">"&lt;LAKEFS_STORAGE_NAMESPACE&gt;/_lakefs/retention/gc/addresses.text/mark_id=&lt;MARK_ID&gt;/"</span> | <span class="se">\</span>
  rclone <span class="nt">-P</span> <span class="nt">--no-traverse</span> <span class="nt">--files-from</span> - copy &lt;BACKUP_STORAGE_LOCATION&gt; &lt;LAKEFS_STORAGE_NAMESPACE&gt;
</code></pre></div></div>
<h3 id="example">
  
  
    <a href="#example" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Example
  
  
</h3>
    

<p>The following of commands used to backup/resource a configured remote ‚Äòazure‚Äô (Azure blob storage) to access example repository storage namespace <code class="language-plaintext highlighter-rouge">https://lakefs.blob.core.windows.net/repo/example/</code>:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Backup</span>
rclone <span class="nt">--include</span> <span class="s2">"*.txt"</span> <span class="nb">cat</span> <span class="s2">"azure://repo/example/_lakefs/retention/gc/addresses.text/mark_id=a64d1885-6202-431f-a0a3-8832e4a5865a/"</span> | <span class="se">\</span>
  rclone <span class="nt">-P</span> <span class="nt">--no-traverse</span> <span class="nt">--files-from</span> - copy azure://repo/example/ azure://backup/repo-example/

<span class="c"># Restore</span>
rclone <span class="nt">--include</span> <span class="s2">"*.txt"</span> <span class="nb">cat</span> <span class="s2">"azure://tal/azure-br/_lakefs/retention/gc/addresses.text/mark_id=a64d1885-6202-431f-a0a3-8832e4a5865a/"</span> | <span class="se">\</span>
  rclone <span class="nt">-P</span> <span class="nt">--no-traverse</span> <span class="nt">--files-from</span> - copy azure://backup/repo-example/ azure://repo/example/
</code></pre></div></div>

                

                
                

                

            </div>
        </div>

        
        

        <div class="search-overlay"></div>
        
    </div>
</div>

<footer>
    <div class="footer-sidebar"></div>
    <div class="footer-main">
        <div class="row">
            <div class="left">
                <ul class="footer-links">
                    
                    
                    <li class="aux-nav-list-item">
                        <a href="https://docs.lakefs.io/" class="site-button" >
                            Docs
                        </a>
                    </li>
                    
                    <li class="aux-nav-list-item">
                        <a href="https://lakefs.io/blog/" class="site-button" >
                            Blog
                        </a>
                    </li>
                    
                    <li class="aux-nav-list-item">
                        <a href="https://github.com/treeverse/lakeFS" class="site-button" >
                            GitHub
                        </a>
                    </li>
                    
                    <li class="aux-nav-list-item">
                        <a href="https://lakefs.io/community/" class="site-button" >
                            Community
                        </a>
                    </li>
                    
                    <li class="aux-nav-list-item">
                        <a href="https://lakefs.io/cloud-registration/" class="site-button" >
                            lakeFS Cloud
                        </a>
                    </li>
                    
                    <li class="aux-nav-list-item">
                        <a href="https://lakefs.io/contact-us/" class="site-button" >
                            Contact
                        </a>
                    </li>
                    
                    
                </ul>
            </div>
            <div class="right">
                <ul class="footer-social">
                    
                    
                    <li class="aux-nav-list-item">
                        <a href="https://lakefs.io/youtube" class="site-button" >
                            <img src="/v0.108/assets/icons/youtube.svg" class="no-hover" />
                            <img src="/v0.108/assets/icons/youtube-hover.svg" class="hover" />
                        </a>
                    </li>
                    
                    <li class="aux-nav-list-item">
                        <a href="https://www.linkedin.com/company/treeverse" class="site-button" >
                            <img src="/v0.108/assets/icons/linkedin.svg" class="no-hover" />
                            <img src="/v0.108/assets/icons/linkedin-hover.svg" class="hover" />
                        </a>
                    </li>
                    
                    <li class="aux-nav-list-item">
                        <a href="https://github.com/treeverse/lakeFS" class="site-button" >
                            <img src="/v0.108/assets/icons/github.svg" class="no-hover" />
                            <img src="/v0.108/assets/icons/github-hover.svg" class="hover" />
                        </a>
                    </li>
                    
                    <li class="aux-nav-list-item">
                        <a href="https://twitter.com/lakeFS" class="site-button" >
                            <img src="/v0.108/assets/icons/twitter.svg" class="no-hover" />
                            <img src="/v0.108/assets/icons/twitter-hover.svg" class="hover" />
                        </a>
                    </li>
                    
                    <li class="aux-nav-list-item">
                        <a href="https://data-folks.masto.host/@lakeFS" class="site-button" >
                            <img src="/v0.108/assets/icons/mastodon.svg" class="no-hover" />
                            <img src="/v0.108/assets/icons/mastodon-hover.svg" class="hover" />
                        </a>
                    </li>
                    
                    <li class="aux-nav-list-item">
                        <a href="https://lakefs.io/slack" class="site-button" >
                            <img src="/v0.108/assets/icons/slack.svg" class="no-hover" />
                            <img src="/v0.108/assets/icons/slack-hover.svg" class="hover" />
                        </a>
                    </li>
                    
                    
                </ul>
            </div>
        </div>
        <div class="row top-border">
            <div class="left">
                <a href="https://lakefs.io" class="lh-tight" style="margin-bottom: 0px;">
                    <div class="site-logo"></div>
                </a>                    
            </div>
            <div class="right">
                <ul class="bottom-footer-links">
                    
                    
                    <li class="aux-nav-list-item">
                        <a href="https://lakefs.io/terms-of-use/" class="site-button" >
                            Terms of use
                        </a>
                    </li>
                    
                    <li class="aux-nav-list-item">
                        <a href="https://lakefs.io/privacy-policy/" class="site-button" >
                            Privacy Policy
                        </a>
                    </li>
                    
                    
                </ul>
            </div>
        </div>
    </div>
</footer>


</body>

</html>

